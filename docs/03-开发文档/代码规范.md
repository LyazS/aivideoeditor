# ä»£ç è§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†AIè§†é¢‘ç¼–è¾‘å™¨é¡¹ç›®çš„ç¼–ç æ ‡å‡†å’Œæœ€ä½³å®è·µï¼Œç¡®ä¿ä»£ç è´¨é‡ã€å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **ä¸€è‡´æ€§**: ä¿æŒä»£ç é£æ ¼çš„ä¸€è‡´æ€§
2. **å¯è¯»æ€§**: ä»£ç åº”è¯¥æ˜“äºç†è§£å’Œç»´æŠ¤
3. **ç±»å‹å®‰å…¨**: å……åˆ†åˆ©ç”¨TypeScriptçš„ç±»å‹ç³»ç»Ÿ
4. **æ€§èƒ½ä¼˜å…ˆ**: è€ƒè™‘æ€§èƒ½å½±å“çš„ç¼–ç å®è·µ
5. **æ¨¡å—åŒ–**: ä¿æŒæ¨¡å—çš„å•ä¸€èŒè´£å’Œä½è€¦åˆ

## ğŸ“ TypeScriptè§„èŒƒ

### ç±»å‹å®šä¹‰

#### âœ… æ­£ç¡®çš„ç±»å‹å®šä¹‰
```typescript
// æ˜ç¡®çš„æ¥å£å®šä¹‰
interface MediaItem {
  id: string
  name: string
  duration: number
  mediaType: 'video' | 'image'
  isReady: boolean
}

// ä½¿ç”¨æ³›å‹
function processItems<T extends { id: string }>(items: T[]): T[] {
  return items.filter(item => item.id !== '')
}

// è”åˆç±»å‹
type EventType = 'play' | 'pause' | 'seek' | 'stop'

// å·¥å…·ç±»å‹
type PartialMediaItem = Partial<MediaItem>
type RequiredFields = Pick<MediaItem, 'id' | 'name'>
```

#### âŒ é¿å…çš„åšæ³•
```typescript
// é¿å…ä½¿ç”¨anyç±»å‹
function processData(data: any): any {
  return data
}

// é¿å…éšå¼any
function handleEvent(event) { // ç¼ºå°‘ç±»å‹æ³¨è§£
  console.log(event)
}

// é¿å…è¿‡äºå®½æ³›çš„ç±»å‹
function updateItem(item: object): void { // åº”è¯¥ä½¿ç”¨å…·ä½“æ¥å£
  // ...
}
```

### å‡½æ•°å®šä¹‰

#### âœ… æ¨èçš„å‡½æ•°é£æ ¼
```typescript
// ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼ˆç®€çŸ­å‡½æ•°ï¼‰
const formatTime = (seconds: number): string => {
  const minutes = Math.floor(seconds / 60)
  const secs = Math.floor(seconds % 60)
  return `${minutes}:${secs.toString().padStart(2, '0')}`
}

// ä½¿ç”¨functionå£°æ˜ï¼ˆå¤æ‚å‡½æ•°ï¼‰
function createTimelineItem(
  mediaItemId: string,
  trackId: number,
  timeRange: TimeRange
): TimelineItem {
  // å¤æ‚çš„åˆ›å»ºé€»è¾‘
  return {
    id: generateId(),
    mediaItemId,
    trackId,
    timeRange,
    // ...å…¶ä»–å±æ€§
  }
}

// å¼‚æ­¥å‡½æ•°
async function loadMediaFile(file: File): Promise<MediaItem> {
  try {
    const mp4Clip = await createMP4Clip(file)
    return createMediaItem(file, mp4Clip)
  } catch (error) {
    throw new Error(`Failed to load media file: ${error.message}`)
  }
}
```

### å˜é‡å‘½å

#### âœ… æ¨èçš„å‘½åè§„èŒƒ
```typescript
// ä½¿ç”¨camelCase
const currentTime = 0
const isPlaying = false
const selectedItemIds = new Set<string>()

// å¸¸é‡ä½¿ç”¨UPPER_SNAKE_CASE
const DEFAULT_FRAME_RATE = 30
const MAX_ZOOM_LEVEL = 10

// ç±»å‹ä½¿ç”¨PascalCase
interface VideoResolution {
  width: number
  height: number
}

// æšä¸¾ä½¿ç”¨PascalCase
enum PlaybackState {
  Playing = 'playing',
  Paused = 'paused',
  Stopped = 'stopped'
}
```

## ğŸ¨ Vueç»„ä»¶è§„èŒƒ

### ç»„ä»¶ç»“æ„

#### âœ… æ¨èçš„ç»„ä»¶ç»“æ„
```vue
<script setup lang="ts">
// 1. å¯¼å…¥ï¼ˆæŒ‰ç±»å‹åˆ†ç»„ï¼‰
import { ref, computed, onMounted, watch } from 'vue'
import { useVideoStore } from '../stores/videoStore'
import ChildComponent from './ChildComponent.vue'

// 2. ç±»å‹å®šä¹‰
interface Props {
  title: string
  items: MediaItem[]
  isVisible?: boolean
}

interface Emits {
  itemSelected: [item: MediaItem]
  visibilityChanged: [visible: boolean]
}

// 3. Propså’ŒEmits
const props = withDefaults(defineProps<Props>(), {
  isVisible: true
})

const emit = defineEmits<Emits>()

// 4. ç»„åˆå¼å‡½æ•°
const videoStore = useVideoStore()

// 5. å“åº”å¼æ•°æ®
const isLoading = ref(false)
const selectedItem = ref<MediaItem | null>(null)

// 6. è®¡ç®—å±æ€§
const filteredItems = computed(() => {
  return props.items.filter(item => item.isReady)
})

// 7. æ–¹æ³•
const handleItemClick = (item: MediaItem) => {
  selectedItem.value = item
  emit('itemSelected', item)
}

// 8. ç›‘å¬å™¨
watch(() => props.isVisible, (visible) => {
  emit('visibilityChanged', visible)
})

// 9. ç”Ÿå‘½å‘¨æœŸé’©å­
onMounted(() => {
  // åˆå§‹åŒ–é€»è¾‘
})
</script>

<template>
  <div class="component-container">
    <header class="component-header">
      <h2 class="component-title">{{ title }}</h2>
    </header>
    
    <main class="component-content">
      <div
        v-for="item in filteredItems"
        :key="item.id"
        class="item"
        :class="{ 'item--selected': selectedItem?.id === item.id }"
        @click="handleItemClick(item)"
      >
        {{ item.name }}
      </div>
    </main>
  </div>
</template>

<style scoped>
.component-container {
  display: flex;
  flex-direction: column;
  background-color: var(--color-bg-primary);
}

.component-header {
  padding: var(--spacing-medium);
  border-bottom: 1px solid var(--color-border);
}

.component-title {
  margin: 0;
  color: var(--color-text-primary);
  font-size: var(--font-size-large);
}

.component-content {
  flex: 1;
  padding: var(--spacing-medium);
}

.item {
  padding: var(--spacing-small);
  cursor: pointer;
  border-radius: var(--border-radius);
  transition: background-color 0.2s ease;
}

.item:hover {
  background-color: var(--color-bg-hover);
}

.item--selected {
  background-color: var(--color-bg-selected);
  color: var(--color-text-selected);
}
</style>
```

### ç»„ä»¶å‘½å

#### âœ… æ¨èçš„å‘½åè§„èŒƒ
```typescript
// ç»„ä»¶æ–‡ä»¶åä½¿ç”¨PascalCase
VideoPreviewEngine.vue
MediaLibrary.vue
TimelineItem.vue

// ç»„ä»¶å†…éƒ¨ä½¿ç”¨kebab-case
<template>
  <video-preview-engine>
    <media-library />
    <timeline-item />
  </video-preview-engine>
</template>
```

## ğŸ¨ CSSè§„èŒƒ

### å‘½åè§„èŒƒ

#### âœ… ä½¿ç”¨BEMå‘½åè§„èŒƒ
```css
/* å—ï¼ˆBlockï¼‰ */
.video-clip {
  position: relative;
  background-color: var(--color-bg-secondary);
}

/* å…ƒç´ ï¼ˆElementï¼‰ */
.video-clip__header {
  padding: var(--spacing-small);
  border-bottom: 1px solid var(--color-border);
}

.video-clip__content {
  padding: var(--spacing-medium);
}

.video-clip__title {
  font-size: var(--font-size-medium);
  font-weight: var(--font-weight-semibold);
}

/* ä¿®é¥°ç¬¦ï¼ˆModifierï¼‰ */
.video-clip--selected {
  border: 2px solid var(--color-primary);
  box-shadow: 0 0 0 2px var(--color-primary-alpha);
}

.video-clip--disabled {
  opacity: 0.5;
  pointer-events: none;
}

.video-clip__title--large {
  font-size: var(--font-size-large);
}
```

### CSSå˜é‡

#### âœ… ä½¿ç”¨CSSå˜é‡ç³»ç»Ÿ
```css
:root {
  /* é¢œè‰²ç³»ç»Ÿ */
  --color-primary: #007acc;
  --color-primary-hover: #005a9e;
  --color-primary-alpha: rgba(0, 122, 204, 0.2);
  
  --color-bg-primary: #1e1e1e;
  --color-bg-secondary: #2d2d2d;
  --color-bg-hover: #3e3e3e;
  --color-bg-selected: #094771;
  
  --color-text-primary: #ffffff;
  --color-text-secondary: #cccccc;
  --color-text-muted: #999999;
  
  --color-border: #404040;
  --color-border-hover: #505050;
  
  /* é—´è·ç³»ç»Ÿ */
  --spacing-xs: 4px;
  --spacing-small: 8px;
  --spacing-medium: 16px;
  --spacing-large: 24px;
  --spacing-xl: 32px;
  
  /* å­—ä½“ç³»ç»Ÿ */
  --font-size-small: 12px;
  --font-size-medium: 14px;
  --font-size-large: 16px;
  --font-size-xl: 18px;
  
  --font-weight-normal: 400;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  
  /* å…¶ä»– */
  --border-radius: 4px;
  --border-radius-large: 8px;
  --transition-fast: 0.15s ease;
  --transition-normal: 0.2s ease;
  --shadow-small: 0 2px 4px rgba(0, 0, 0, 0.1);
  --shadow-medium: 0 4px 8px rgba(0, 0, 0, 0.15);
}
```

### å“åº”å¼è®¾è®¡

#### âœ… ç§»åŠ¨ç«¯ä¼˜å…ˆçš„å“åº”å¼è®¾è®¡
```css
/* ç§»åŠ¨ç«¯ä¼˜å…ˆ */
.timeline {
  padding: var(--spacing-small);
  font-size: var(--font-size-small);
}

/* å¹³æ¿ç«¯ */
@media (min-width: 768px) {
  .timeline {
    padding: var(--spacing-medium);
    font-size: var(--font-size-medium);
  }
}

/* æ¡Œé¢ç«¯ */
@media (min-width: 1024px) {
  .timeline {
    padding: var(--spacing-large);
    font-size: var(--font-size-large);
  }
}
```

## ğŸ”§ å·¥å…·å‡½æ•°è§„èŒƒ

### å‡½æ•°ç»„ç»‡

#### âœ… æ¨¡å—åŒ–å·¥å…·å‡½æ•°
```typescript
// timeUtils.ts - æ—¶é—´ç›¸å…³å·¥å…·
export function formatTime(seconds: number): string {
  // å®ç°
}

export function alignTimeToFrame(time: number, frameRate: number): number {
  // å®ç°
}

// coordinateUtils.ts - åæ ‡è½¬æ¢å·¥å…·
export function timeToPixel(
  time: number, 
  zoomLevel: number, 
  scrollOffset: number
): number {
  // å®ç°
}

export function pixelToTime(
  pixel: number, 
  zoomLevel: number, 
  scrollOffset: number
): number {
  // å®ç°
}
```

### é”™è¯¯å¤„ç†

#### âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
```typescript
// è‡ªå®šä¹‰é”™è¯¯ç±»å‹
class WebAVError extends Error {
  constructor(message: string, public code: string) {
    super(message)
    this.name = 'WebAVError'
  }
}

// é”™è¯¯å¤„ç†å‡½æ•°
function handleWebAVError(error: unknown): void {
  if (error instanceof WebAVError) {
    console.error(`WebAVé”™è¯¯ [${error.code}]:`, error.message)
    videoStore.setWebAVError(error.message)
  } else if (error instanceof Error) {
    console.error('æœªçŸ¥é”™è¯¯:', error.message)
    videoStore.setWebAVError('å‘ç”ŸæœªçŸ¥é”™è¯¯')
  } else {
    console.error('æœªçŸ¥é”™è¯¯:', error)
    videoStore.setWebAVError('å‘ç”ŸæœªçŸ¥é”™è¯¯')
  }
}

// å¼‚æ­¥æ“ä½œçš„é”™è¯¯å¤„ç†
async function safeAsyncOperation<T>(
  operation: () => Promise<T>,
  errorMessage: string
): Promise<T | null> {
  try {
    return await operation()
  } catch (error) {
    console.error(errorMessage, error)
    handleWebAVError(error)
    return null
  }
}
```

## ğŸ“š æ³¨é‡Šè§„èŒƒ

### JSDocæ³¨é‡Š

#### âœ… å®Œæ•´çš„JSDocæ³¨é‡Š
```typescript
/**
 * åˆ›å»ºæ—¶é—´è½´é¡¹ç›®
 * @param mediaItemId - åª’ä½“é¡¹ç›®ID
 * @param trackId - è½¨é“ID
 * @param timeRange - æ—¶é—´èŒƒå›´
 * @param options - å¯é€‰é…ç½®
 * @returns åˆ›å»ºçš„æ—¶é—´è½´é¡¹ç›®
 * @throws {Error} å½“åª’ä½“é¡¹ç›®ä¸å­˜åœ¨æ—¶æŠ›å‡ºé”™è¯¯
 * @example
 * ```typescript
 * const item = createTimelineItem('media-1', 'track-1', { start: 0, end: 10 })
 * ```
 */
function createTimelineItem(
  mediaItemId: string,
  trackId: string,
  timeRange: TimeRange,
  options?: CreateItemOptions
): TimelineItem {
  // å®ç°
}

/**
 * è§†é¢‘ç¼–è¾‘å™¨çš„ä¸»è¦é…ç½®æ¥å£
 * @interface
 */
interface EditorConfig {
  /** è§†é¢‘åˆ†è¾¨ç‡ */
  resolution: VideoResolution
  /** å¸§ç‡ */
  frameRate: number
  /** æ˜¯å¦å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ */
  enableHardwareAcceleration: boolean
}
```

### ä»£ç æ³¨é‡Š

#### âœ… æœ‰æ„ä¹‰çš„ä»£ç æ³¨é‡Š
```typescript
// è®¡ç®—è§†é¢‘åœ¨ç”»å¸ƒä¸­çš„å®é™…æ˜¾ç¤ºå°ºå¯¸
// è€ƒè™‘ç”»å¸ƒç¼©æ”¾å’Œè§†é¢‘åŸå§‹æ¯”ä¾‹
function calculateDisplaySize(
  originalWidth: number,
  originalHeight: number,
  canvasScale: number
): { width: number; height: number } {
  // ä¿æŒåŸå§‹å®½é«˜æ¯”
  const aspectRatio = originalWidth / originalHeight
  
  // æ ¹æ®ç”»å¸ƒç¼©æ”¾è°ƒæ•´å°ºå¯¸
  const scaledWidth = originalWidth * canvasScale
  const scaledHeight = scaledWidth / aspectRatio
  
  return { width: scaledWidth, height: scaledHeight }
}

// TODO: ä¼˜åŒ–å¤§æ–‡ä»¶çš„åŠ è½½æ€§èƒ½
// FIXME: ä¿®å¤åœ¨æŸäº›æµè§ˆå™¨ä¸­çš„å…¼å®¹æ€§é—®é¢˜
// NOTE: è¿™ä¸ªå‡½æ•°ä¾èµ–äºWebAVçš„å†…éƒ¨å®ç°
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### Vueæ€§èƒ½ä¼˜åŒ–

#### âœ… æ¨èçš„æ€§èƒ½ä¼˜åŒ–
```typescript
// ä½¿ç”¨shallowRefé¿å…æ·±åº¦å“åº”å¼
const webAVObjects = shallowRef(new Map<string, WebAVObject>())

// ä½¿ç”¨markRawé¿å…å“åº”å¼åŒ…è£…
const mp4Clip = markRaw(await createMP4Clip(file))

// ä½¿ç”¨computedç¼“å­˜è®¡ç®—ç»“æœ
const expensiveComputation = computed(() => {
  return heavyCalculation(props.data)
})

// ä½¿ç”¨v-memoä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“
const memoizedItems = computed(() => {
  return items.value.map(item => ({
    ...item,
    memoKey: [item.id, item.name, item.isSelected]
  }))
})
```

### WebAVæ€§èƒ½ä¼˜åŒ–

#### âœ… WebAVæœ€ä½³å®è·µ
```typescript
// å¤ç”¨MP4Clipå®ä¾‹è€Œä¸æ˜¯é‡æ–°åˆ›å»º
const clonedClip = await cloneMP4Clip(originalClip)

// åŠæ—¶æ¸…ç†èµ„æº
onUnmounted(() => {
  sprite?.destroy()
  mp4Clip?.destroy()
})

// é¿å…é¢‘ç¹çš„WebAVæ“ä½œ
const debouncedSeek = debounce((time: number) => {
  webAVControls.seekTo(time)
}, 100)
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ¶æ„è®¾è®¡](æ¶æ„è®¾è®¡.md) - ç³»ç»Ÿæ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹
- [å¼€å‘ç¯å¢ƒ](å¼€å‘ç¯å¢ƒ.md) - å¼€å‘ç¯å¢ƒè®¾ç½®å’Œå·¥ä½œæµç¨‹
- [APIæ–‡æ¡£](APIæ–‡æ¡£.md) - è¯¦ç»†çš„APIæ¥å£æ–‡æ¡£
- [ESLinté…ç½®](../../../frontend/eslint.config.ts) - ä»£ç æ£€æŸ¥é…ç½®

---

**æç¤º**ï¼šä»£ç è§„èŒƒæ˜¯å›¢é˜Ÿåä½œçš„åŸºç¡€ï¼Œè¯·ä¸¥æ ¼éµå¾ªè¿™äº›è§„èŒƒï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œä¸€è‡´æ€§ã€‚
