# 开发环境

## 🔧 环境要求

### 系统要求
- **Node.js**: >= 18.0.0
- **npm**: >= 8.0.0 (或 yarn >= 1.22.0, pnpm >= 7.0.0)
- **操作系统**: Windows 10/11, macOS 10.15+, Linux (Ubuntu 18.04+)
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

### 硬件要求
- **内存**: 最低 4GB RAM，推荐 8GB+
- **存储**: 至少 2GB 可用空间
- **显卡**: 支持 WebGL 2.0 的显卡（用于硬件加速）

## 📦 项目设置

### 克隆和安装
```bash
# 克隆项目
git clone <repository-url>
cd aivideoeditor

# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 验证安装
```bash
# 检查Node.js版本
node --version    # 应该 >= 18.0.0

# 检查npm版本
npm --version     # 应该 >= 8.0.0

# 检查项目依赖
npm list --depth=0
```

## 🛠️ 开发工具配置

### VSCode推荐配置

#### 推荐插件
```json
{
  "recommendations": [
    "Vue.volar",
    "Vue.vscode-typescript-vue-plugin",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "dbaeumer.vscode-eslint",
    "formulahendry.auto-rename-tag",
    "CoenraadS.bracket-pair-colorizer-2"
  ]
}
```

#### 工作区设置
```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "eslint.validate": ["javascript", "typescript", "vue"],
  "typescript.preferences.importModuleSpecifier": "relative",
  "vue.codeActions.enabled": true,
  "vue.complete.casing.tags": "kebab",
  "vue.complete.casing.props": "camel"
}
```

### 浏览器开发工具

#### Chrome DevTools
- **Vue DevTools**: 用于Vue组件调试
- **Performance面板**: 性能分析和优化
- **Memory面板**: 内存使用监控
- **Network面板**: 网络请求分析

#### WebAV调试
- **WebGL Inspector**: WebGL渲染调试
- **Canvas Inspector**: Canvas操作监控
- **Console**: WebAV日志输出

## 🏗️ 项目架构理解

### 目录结构
```
frontend/
├── src/
│   ├── components/          # Vue组件
│   │   ├── VideoPreviewEngine.vue    # 主编辑器界面
│   │   ├── PreviewWindow.vue         # 视频预览窗口
│   │   ├── Timeline.vue              # 时间轴组件
│   │   ├── MediaLibrary.vue          # 素材库
│   │   ├── PlaybackControls.vue      # 播放控制
│   │   ├── PropertiesPanel.vue       # 属性面板
│   │   └── WebAVRenderer.vue         # WebAV渲染器
│   ├── stores/              # 状态管理
│   │   ├── videoStore.ts             # 主状态存储
│   │   ├── modules/                  # 模块化状态管理
│   │   └── utils/                    # 工具函数模块
│   ├── composables/         # 组合式函数
│   │   ├── useWebAVControls.ts       # WebAV控制器
│   │   ├── usePlaybackControls.ts    # 播放控制
│   │   └── useDragUtils.ts           # 拖拽工具
│   ├── utils/               # 工具类
│   │   ├── VideoVisibleSprite.ts     # 自定义视频精灵
│   │   ├── coordinateTransform.ts    # 坐标转换
│   │   └── webavDebug.ts             # WebAV调试工具
│   ├── types/               # TypeScript类型定义
│   │   └── videoTypes.ts             # 视频相关类型
│   └── styles/              # 样式文件
│       └── common.css                # 通用样式
├── docs/                    # 项目文档
├── public/                  # 静态资源
├── package.json            # 项目依赖配置
├── vite.config.ts          # Vite配置
├── tsconfig.json           # TypeScript配置
└── eslint.config.ts        # ESLint配置
```

### 模块化设计原则
项目采用模块化架构，每个模块负责特定功能：

```
stores/modules/
├── webavModule.ts      # WebAV引擎集成
├── mediaModule.ts      # 素材管理
├── playbackModule.ts   # 播放控制
├── configModule.ts     # 配置管理
├── trackModule.ts      # 轨道管理
├── timelineModule.ts   # 时间轴核心
├── viewportModule.ts   # 视口管理
├── selectionModule.ts  # 选择管理
└── clipOperationsModule.ts # 片段操作
```

### 数据流向
```
用户操作 → UI组件 → VideoStore → 模块状态 → WebAV引擎
                                              ↓
UI更新 ← 状态变化 ← 事件监听 ← WebAV事件 ← 渲染更新
```

## 🔄 开发工作流

### 添加新功能

#### 1. 分析需求
- 确定功能属于哪个模块
- 分析数据流和状态变化
- 确定需要的UI组件

#### 2. 创建或修改模块
```typescript
// 示例：添加新的配置选项
export function createConfigModule() {
  const newOption = ref(defaultValue)
  
  function setNewOption(value: any) {
    newOption.value = value
    console.log('新选项已设置:', value)
  }
  
  return {
    newOption,
    setNewOption
  }
}
```

#### 3. 更新VideoStore
```typescript
// 在videoStore.ts中集成新模块
const configModule = createConfigModule()

return {
  // 导出新状态和方法
  newOption: configModule.newOption,
  setNewOption: configModule.setNewOption
}
```

#### 4. 创建或更新UI组件
```vue
<template>
  <div class="new-feature">
    <!-- UI内容 -->
  </div>
</template>

<script setup lang="ts">
import { useVideoStore } from '../stores/videoStore'

const videoStore = useVideoStore()

// 使用新功能
const handleNewFeature = () => {
  videoStore.setNewOption(newValue)
}
</script>
```

### Git工作流

#### 分支策略
```bash
# 主分支
main                    # 生产环境代码
develop                 # 开发环境代码

# 功能分支
feature/feature-name    # 新功能开发
bugfix/bug-description  # Bug修复
hotfix/urgent-fix      # 紧急修复
```

#### 提交规范
```bash
# 提交消息格式
type(scope): description

# 类型说明
feat:     新功能
fix:      Bug修复
docs:     文档更新
style:    代码格式调整
refactor: 代码重构
test:     测试相关
chore:    构建工具或辅助工具的变动

# 示例
feat(timeline): 添加多选功能
fix(webav): 修复内存泄漏问题
docs(api): 更新API文档
```

## 🐛 调试技巧

### WebAV调试
```typescript
// 使用内置调试工具
import { logWebAVReadyStateChange, debugError } from '../utils/webavDebug'

// 监控WebAV状态变化
watch(() => videoStore.isWebAVReady, (isReady, wasReady) => {
  logWebAVReadyStateChange(isReady, wasReady)
})

// 错误处理
try {
  await webAVOperation()
} catch (error) {
  debugError('WebAV操作失败', error, { context: 'additional info' })
}
```

### 性能监控
```typescript
// 使用性能计时器
const timer = createPerformanceTimer('操作名称')
await performOperation()
const duration = timer.end()
console.log(`操作耗时: ${duration}ms`)
```

### 状态调试
```typescript
// 在组件中添加调试信息
onMounted(() => {
  console.log('组件状态:', {
    mediaItems: videoStore.mediaItems.value.length,
    timelineItems: videoStore.timelineItems.value.length,
    isWebAVReady: videoStore.isWebAVReady.value
  })
})
```

### 常用调试命令
```bash
# 启动开发服务器（带调试信息）
npm run dev

# 类型检查
npm run type-check

# 代码检查
npm run lint

# 代码格式化
npm run format

# 构建项目
npm run build

# 预览构建结果
npm run preview
```

## 🧪 测试策略

### 单元测试
```typescript
// 测试模块功能
describe('ConfigModule', () => {
  it('应该正确设置配置选项', () => {
    const module = createConfigModule()
    module.setNewOption('test-value')
    expect(module.newOption.value).toBe('test-value')
  })
})
```

### 集成测试
```typescript
// 测试组件集成
describe('VideoPreviewEngine', () => {
  it('应该正确初始化WebAV', async () => {
    const wrapper = mount(VideoPreviewEngine)
    await nextTick()
    expect(wrapper.vm.videoStore.isWebAVReady).toBe(true)
  })
})
```

### 手动测试清单
- [ ] 视频文件导入功能
- [ ] 时间轴拖拽操作
- [ ] 播放控制功能
- [ ] 视频属性调整
- [ ] 分辨率切换
- [ ] 错误处理和恢复

## 🚀 构建和部署

### 构建命令
```bash
# 开发构建
npm run dev

# 生产构建
npm run build

# 类型检查
npm run type-check

# 代码检查
npm run lint

# 代码格式化
npm run format
```

### 部署检查清单
- [ ] 所有TypeScript错误已修复
- [ ] ESLint检查通过
- [ ] 构建成功无警告
- [ ] 功能测试通过
- [ ] 性能测试通过
- [ ] 浏览器兼容性测试

### 环境变量配置
```bash
# 开发环境 (.env.development)
VITE_APP_TITLE=AI视频编辑器
VITE_API_BASE_URL=http://localhost:3000/api
VITE_ENABLE_DEBUG=true
VITE_WEBAV_DEBUG=true

# 生产环境 (.env.production)
VITE_APP_TITLE=AI视频编辑器
VITE_API_BASE_URL=https://api.example.com
VITE_ENABLE_DEBUG=false
VITE_WEBAV_DEBUG=false
```

## 🔗 相关文档

- [架构设计](架构设计.md) - 系统架构设计和技术选型
- [API文档](API文档.md) - 详细的API接口文档
- [代码规范](代码规范.md) - 编码标准和最佳实践
- [故障排除](../02-用户指南/故障排除.md) - 常见问题解决方案

---

**提示**：开发环境配置完成后，建议先阅读架构设计文档，了解项目的整体架构和设计理念。
