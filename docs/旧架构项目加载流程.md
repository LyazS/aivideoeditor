# æ—§æ¶æ„é¡¹ç›®åŠ è½½æµç¨‹åˆ†æ

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æäº†æ—§æ¶æ„ä¸­é¡¹ç›®çš„åŠ è½½æµç¨‹ï¼ŒåŒ…æ‹¬ä»ç”¨æˆ·é€‰æ‹©é¡¹ç›®åˆ°å®Œå…¨åŠ è½½åˆ°å†…å­˜ä¸­çš„æ•´ä¸ªè¿‡ç¨‹ã€‚æ—§æ¶æ„é‡‡ç”¨äº†åˆ†é˜¶æ®µåŠ è½½ç­–ç•¥ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒæµç•…ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡ã€‚

## æ•´ä½“æ¶æ„

æ—§æ¶æ„çš„é¡¹ç›®åŠ è½½ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ç»„æˆï¼š

1. **ProjectManagement.vue** - é¡¹ç›®ç®¡ç†ç•Œé¢ï¼Œè´Ÿè´£é¡¹ç›®åˆ—è¡¨æ˜¾ç¤ºå’Œç”¨æˆ·äº¤äº’
2. **ProjectManager.ts** - é¡¹ç›®ç®¡ç†å™¨ï¼Œè´Ÿè´£å®é™…çš„é¡¹ç›®æ–‡ä»¶æ“ä½œ
3. **projectModule** - é¡¹ç›®çŠ¶æ€ç®¡ç†æ¨¡å—ï¼Œè´Ÿè´£é¡¹ç›®åŠ è½½çŠ¶æ€è·Ÿè¸ª
4. **videoStore** - ä¸»çŠ¶æ€å­˜å‚¨ï¼Œæ•´åˆå„ä¸ªåŠŸèƒ½æ¨¡å—
5. **MediaManager** - åª’ä½“æ–‡ä»¶ç®¡ç†å™¨ï¼Œè´Ÿè´£åª’ä½“æ–‡ä»¶çš„åŠ è½½

## è¯¦ç»†åŠ è½½æµç¨‹

### 1. é¡¹ç›®åˆ—è¡¨åŠ è½½é˜¶æ®µ

#### 1.1 å·¥ä½œç›®å½•æƒé™æ£€æŸ¥
```typescript
// æ–‡ä»¶: frontend/src/views/ProjectManagement.vue
async function checkWorkspaceAccess() {
  try {
    console.log('ğŸ” å¼€å§‹æ£€æŸ¥å·¥ä½œç›®å½•æƒé™...')
    const hasAccess = await directoryManager.hasWorkspaceAccess()
    hasWorkspaceAccess.value = hasAccess
    
    if (hasAccess) {
      workspaceInfo.value = await directoryManager.getWorkspaceInfo()
      await loadProjects()
    }
  } catch (error) {
    console.error('âŒ æ£€æŸ¥å·¥ä½œç›®å½•æƒé™å¤±è´¥:', error)
    hasWorkspaceAccess.value = false
  }
}
```

#### 1.2 é¡¹ç›®åˆ—è¡¨æ‰«æ
```typescript
// æ–‡ä»¶: frontend/src/utils/ProjectManager.ts
async listProjects(): Promise<ProjectConfig[]> {
  const workspaceHandle = await directoryManager.getWorkspaceHandle()
  const projectsHandle = await this.getOrCreateProjectsFolder(workspaceHandle)
  const projects: ProjectConfig[] = []

  // éå†projectsæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å­æ–‡ä»¶å¤¹
  for await (const [name, handle] of projectsHandle.entries()) {
    if (handle.kind === 'directory') {
      try {
        const projectConfig = await this.loadProjectConfig(handle)
        if (projectConfig) {
          projects.push(projectConfig)
        }
      } catch (error) {
        console.warn(`åŠ è½½é¡¹ç›® ${name} å¤±è´¥:`, error)
      }
    }
  }

  // æŒ‰æ›´æ–°æ—¶é—´æ’åº
  projects.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime())
  return projects
}
```

### 2. é¡¹ç›®é€‰æ‹©ä¸é¡µé¢è·³è½¬

#### 2.1 é¡¹ç›®é€‰æ‹©
ç”¨æˆ·åœ¨é¡¹ç›®åˆ—è¡¨ä¸­ç‚¹å‡»é¡¹ç›®å¡ç‰‡ï¼š
```typescript
// æ–‡ä»¶: frontend/src/views/ProjectManagement.vue
function openProjectById(projectId: string) {
  // ä½¿ç”¨é¡µé¢é‡è½½æ–¹å¼æ‰“å¼€é¡¹ç›®ï¼Œç¡®ä¿æ‰€æœ‰storeçŠ¶æ€éƒ½è¢«é‡æ–°åˆ›å»º
  console.log(`ğŸš€ ä½¿ç”¨é¡µé¢é‡è½½æ–¹å¼æ‰“å¼€é¡¹ç›®: ${projectId}`)
  window.location.href = `/editor/${projectId}`
}
```

#### 2.2 ç¼–è¾‘å™¨é¡µé¢åˆå§‹åŒ–
ç¼–è¾‘å™¨é¡µé¢ï¼ˆ`/editor/:projectId`ï¼‰åŠ è½½æ—¶ï¼Œä¼šè§¦å‘ä»¥ä¸‹æµç¨‹ï¼š

1. URLå‚æ•°è§£æè·å–é¡¹ç›®ID
2. åˆå§‹åŒ–unifiedStoreï¼ˆæ›¿ä»£äº†æ—§æ¶æ„çš„videoStoreï¼‰
3. è§¦å‘é¡¹ç›®åŠ è½½æµç¨‹

##### è¯¦ç»†å®ç°è¿‡ç¨‹

###### 1. URLå‚æ•°è§£æè·å–é¡¹ç›®ID

URLå‚æ•°è§£æåœ¨VideoEditor.vueç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å®Œæˆï¼š

```typescript
// æ–‡ä»¶: frontend/src/views/VideoEditor.vue
import { useRoute } from 'vue-router'

const route = useRoute()

// åœ¨onBeforeMountå’ŒonMountedä¸­è·å–é¡¹ç›®ID
const projectId = route.params.projectId as string
```

è·¯ç”±é…ç½®åœ¨ [`router/index.ts`](frontend/src/router/index.ts:18) ä¸­å®šä¹‰ï¼š

```typescript
// æ–‡ä»¶: frontend/src/router/index.ts
{
  path: '/editor/:projectId?',
  name: 'VideoEditor',
  component: VideoEditor,
  meta: {
    title: 'è§†é¢‘ç¼–è¾‘å™¨ - å…‰å½±ç»˜æ¢¦',
  },
}
```

###### 2. åˆå§‹åŒ–unifiedStore

unifiedStoreçš„åˆå§‹åŒ–åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶å®Œæˆï¼Œå…·ä½“åœ¨ [`main.ts`](frontend/src/main.ts:10) ä¸­ï¼š

```typescript
// æ–‡ä»¶: frontend/src/main.ts
import { createPinia } from 'pinia'
import App from './App.vue'
import router from './router'

const app = createApp(App)

app.use(createPinia())  // åˆå§‹åŒ–PiniaçŠ¶æ€ç®¡ç†
app.use(router)         // åˆå§‹åŒ–è·¯ç”±
```

ç„¶ååœ¨VideoEditor.vueç»„ä»¶ä¸­é€šè¿‡ [`useUnifiedStore`](frontend/src/views/VideoEditor.vue:134) è·å–storeå®ä¾‹ï¼š

```typescript
// æ–‡ä»¶: frontend/src/views/VideoEditor.vue
import { useUnifiedStore } from '@/unified/unifiedStore'

const unifiedStore = useUnifiedStore()
```

unifiedStoreæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†å™¨ï¼Œæ•´åˆäº†å¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼ŒåŒ…æ‹¬ï¼š
- ç»Ÿä¸€åª’ä½“ç®¡ç†æ¨¡å— (UnifiedMediaModule)
- ç»Ÿä¸€è½¨é“ç®¡ç†æ¨¡å— (UnifiedTrackModule)
- ç»Ÿä¸€æ—¶é—´è½´ç®¡ç†æ¨¡å— (UnifiedTimelineModule)
- ç»Ÿä¸€é¡¹ç›®ç®¡ç†æ¨¡å— (UnifiedProjectModule)
- ç»Ÿä¸€è§†å£ç®¡ç†æ¨¡å— (UnifiedViewportModule)
- ç»Ÿä¸€é€‰æ‹©ç®¡ç†æ¨¡å— (UnifiedSelectionModule)
- ç»Ÿä¸€ç‰‡æ®µæ“ä½œæ¨¡å— (UnifiedClipOperationsModule)
- ç»Ÿä¸€é…ç½®ç®¡ç†æ¨¡å— (UnifiedConfigModule)
- ç»Ÿä¸€æ’­æ”¾æ§åˆ¶æ¨¡å— (UnifiedPlaybackModule)
- ç»Ÿä¸€WebAVé›†æˆæ¨¡å— (UnifiedWebavModule)
- ç»Ÿä¸€é€šçŸ¥ç®¡ç†æ¨¡å— (UnifiedNotificationModule)
- ç»Ÿä¸€å†å²è®°å½•æ¨¡å— (UnifiedHistoryModule)

###### 3. è§¦å‘é¡¹ç›®åŠ è½½æµç¨‹

é¡¹ç›®åŠ è½½æµç¨‹åœ¨VideoEditor.vueç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­åˆ†ä¸¤ä¸ªé˜¶æ®µè§¦å‘ï¼š

**ç¬¬ä¸€é˜¶æ®µï¼šé¢„åŠ è½½é¡¹ç›®è®¾ç½®ï¼ˆonBeforeMountï¼‰**

```typescript
// æ–‡ä»¶: frontend/src/views/VideoEditor.vue
onBeforeMount(async () => {
  console.log('ğŸ”„ [LIFECYCLE] VideoEditor.onBeforeMount å¼€å§‹')

  // ä»è·¯ç”±å‚æ•°è·å–é¡¹ç›®ID
  const projectId = route.params.projectId as string

  try {
    console.log('ğŸ”„ [LIFECYCLE] VideoEditor å¼€å§‹é¢„åŠ è½½é¡¹ç›®è®¾ç½®')
    await unifiedStore.preloadProjectSettings(projectId)
    console.log('âœ… [LIFECYCLE] VideoEditor é¡¹ç›®è®¾ç½®é¢„åŠ è½½å®Œæˆ')
  } catch (error) {
    console.error('âŒ [LIFECYCLE] VideoEditor é¢„åŠ è½½é¡¹ç›®è®¾ç½®å¤±è´¥:', error)
    // å¯¹äºç°æœ‰é¡¹ç›®ï¼Œé¢„åŠ è½½å¤±è´¥æ˜¯ä¸¥é‡é”™è¯¯ï¼Œéœ€è¦é€šçŸ¥ç”¨æˆ·
    if (projectId && projectId !== 'undefined') {
      projectTitle.value = 'é¡¹ç›®è®¾ç½®åŠ è½½å¤±è´¥'
      throw new Error(`é¡¹ç›®è®¾ç½®åŠ è½½å¤±è´¥: ${error}`)
    }
    // å¯¹äºæ–°é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤è®¾ç½®ç»§ç»­
    console.log('ğŸ”„ [LIFECYCLE] VideoEditor æ–°é¡¹ç›®ä½¿ç”¨é»˜è®¤è®¾ç½®')
  }

  console.log('ğŸ”„ [LIFECYCLE] VideoEditor.onBeforeMount å®Œæˆ')
})
```

**ç¬¬äºŒé˜¶æ®µï¼šåŠ è½½é¡¹ç›®å†…å®¹ï¼ˆonMountedï¼‰**

```typescript
// æ–‡ä»¶: frontend/src/views/VideoEditor.vue
onMounted(async () => {
  console.log('ğŸ”„ [LIFECYCLE] VideoEditor.onMounted å¼€å§‹')

  // ä»è·¯ç”±å‚æ•°è·å–é¡¹ç›®ID
  const projectId = route.params.projectId as string

  try {
    console.log('ğŸ“‚ [VideoEditor] å¼€å§‹åŠ è½½é¡¹ç›®å†…å®¹...')
    await unifiedStore.loadProjectContent(projectId)

    if (unifiedStore.hasCurrentProject) {
      projectTitle.value = unifiedStore.currentProjectName
      console.log('âœ… [VideoEditor] é¡¹ç›®å†…å®¹åŠ è½½å®Œæˆ:', unifiedStore.currentProjectName)

      // å¯ç”¨è‡ªåŠ¨ä¿å­˜
      autoSave.enableAutoSave()
      console.log('âœ… [VideoEditor] è‡ªåŠ¨ä¿å­˜å·²å¯ç”¨')
    } else {
      projectTitle.value = 'æ–°å»ºé¡¹ç›®'
      console.log('ğŸ“ [VideoEditor] å‡†å¤‡åˆ›å»ºæ–°é¡¹ç›®')

      // å¯¹äºæ–°é¡¹ç›®ï¼Œæš‚æ—¶ç¦ç”¨è‡ªåŠ¨ä¿å­˜ï¼Œç›´åˆ°é¡¹ç›®è¢«åˆ›å»º
      autoSave.disableAutoSave()
    }
  } catch (error) {
    console.error('âŒ [VideoEditor] åŠ è½½é¡¹ç›®å†…å®¹å¤±è´¥:', error)
    projectTitle.value = 'åŠ è½½å¤±è´¥'
    autoSave.disableAutoSave()
  }

  // æ³¨å†Œé”®ç›˜å¿«æ·é”®
  window.addEventListener('keydown', handleKeydown)

  console.log('ğŸ”„ [LIFECYCLE] VideoEditor.onMounted å®Œæˆ')
})
```

è¿™ç§åˆ†é˜¶æ®µåŠ è½½çš„è®¾è®¡ç¡®ä¿äº†ï¼š
1. **å¿«é€Ÿå“åº”**ï¼šé¢„åŠ è½½é˜¶æ®µåªåŠ è½½é¡¹ç›®è®¾ç½®ï¼Œä¸åŒ…å«åª’ä½“æ–‡ä»¶ï¼Œå¯ä»¥å¿«é€Ÿå®Œæˆ
2. **æ¸è¿›å¼åŠ è½½**ï¼šå†…å®¹åŠ è½½é˜¶æ®µåœ¨ç»„ä»¶æŒ‚è½½åè¿›è¡Œï¼Œä¸ä¼šé˜»å¡ç•Œé¢æ¸²æŸ“
3. **é”™è¯¯éš”ç¦»**ï¼šè®¾ç½®é¢„åŠ è½½å¤±è´¥ä¸ä¼šé˜»æ­¢ç»„ä»¶æŒ‚è½½ï¼Œå¯ä»¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
4. **ç”¨æˆ·ä½“éªŒ**ï¼šç”¨æˆ·å¯ä»¥ç«‹å³çœ‹åˆ°ç¼–è¾‘å™¨ç•Œé¢ï¼ŒåŒæ—¶åå°ç»§ç»­åŠ è½½é¡¹ç›®å†…å®¹

### 3. é¡¹ç›®è®¾ç½®é¢„åŠ è½½é˜¶æ®µ

#### 3.1 è½»é‡çº§è®¾ç½®åŠ è½½
```typescript
// æ–‡ä»¶: frontend/src/stores/modules/projectModule.ts
async function preloadProjectSettings(projectId: string): Promise<void> {
  if (!projectId || projectId === 'undefined') {
    console.log('ğŸ”„ [LIFECYCLE] ProjectModule æ–°é¡¹ç›®ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®')
    isProjectSettingsReady.value = true
    return
  }

  try {
    console.log(`ğŸ”§ [Settings Preload] å¼€å§‹é¢„åŠ è½½é¡¹ç›®è®¾ç½®: ${projectId}`)
    
    const settings = await projectManager.loadProjectSettings(projectId)
    
    if (settings) {
      // æ¢å¤é…ç½®åˆ°configModule
      videoStore.restoreFromProjectSettings(settings)
      
      console.log('ğŸ”„ [LIFECYCLE] ProjectModule é¡¹ç›®è®¾ç½®é¢„åŠ è½½æˆåŠŸ')
      isProjectSettingsReady.value = true
    } else {
      // settingsä¸ºnullè¡¨ç¤ºé¡¹ç›®ä¸å­˜åœ¨ï¼ˆæ–°é¡¹ç›®ï¼‰ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®
      console.log('ğŸ”„ [LIFECYCLE] ProjectModule é¡¹ç›®ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®')
      isProjectSettingsReady.value = true
    }
  } catch (error) {
    console.error('âŒ [Settings Preload] é¢„åŠ è½½é¡¹ç›®è®¾ç½®å¤±è´¥:', error)
    isProjectSettingsReady.value = false
    throw new Error(`é¡¹ç›®è®¾ç½®åŠ è½½å¤±è´¥ï¼Œæ— æ³•ç»§ç»­: ${error instanceof Error ? error.message : String(error)}`)
  }
}
```

#### 3.2 é¡¹ç›®ç®¡ç†å™¨ä¸­çš„è®¾ç½®åŠ è½½å®ç°
```typescript
// æ–‡ä»¶: frontend/src/utils/ProjectManager.ts
async loadProjectSettings(projectId: string): Promise<ProjectConfig['settings'] | null> {
  try {
    console.log(`ğŸ”§ [Settings Preload] å¼€å§‹é¢„åŠ è½½é¡¹ç›®è®¾ç½®: ${projectId}`)
    
    const projectsHandle = await workspaceHandle.getDirectoryHandle(this.PROJECTS_FOLDER)
    const projectHandle = await projectsHandle.getDirectoryHandle(projectId)
    const projectConfig = await this.loadProjectConfig(projectHandle)
    
    if (!projectConfig) {
      throw new Error(`é¡¹ç›®é…ç½®æ–‡ä»¶è¯»å–å¤±è´¥æˆ–æ ¼å¼é”™è¯¯`)
    }
    
    if (!projectConfig.settings) {
      throw new Error(`é¡¹ç›®é…ç½®æ–‡ä»¶ç¼ºå°‘settingså­—æ®µ`)
    }
    
    // éªŒè¯å…³é”®è®¾ç½®å­—æ®µ
    if (!projectConfig.settings.videoResolution) {
      throw new Error(`é¡¹ç›®é…ç½®ç¼ºå°‘videoResolutionè®¾ç½®`)
    }
    
    return projectConfig.settings
  } catch (error) {
    // å¦‚æœæ˜¯é¡¹ç›®ä¸å­˜åœ¨çš„é”™è¯¯ï¼Œè¿”å›nullï¼ˆç”¨äºæ–°é¡¹ç›®ï¼‰
    if (error instanceof Error && error.name === 'NotFoundError') {
      console.log(`ğŸ“ [Settings Preload] é¡¹ç›®ä¸å­˜åœ¨ï¼Œè¿”å›null: ${projectId}`)
      return null
    }
    
    // å…¶ä»–é”™è¯¯ï¼ˆæ–‡ä»¶æŸåã€æ ¼å¼é”™è¯¯ç­‰ï¼‰æŠ›å‡ºå¼‚å¸¸
    throw new Error(`æ— æ³•åŠ è½½é¡¹ç›®è®¾ç½®: ${error instanceof Error ? error.message : String(error)}`)
  }
}
```

### 4. é¡¹ç›®å†…å®¹åŠ è½½é˜¶æ®µ

#### 4.1 ä¸»è¦åŠ è½½æµç¨‹
```typescript
// æ–‡ä»¶: frontend/src/stores/modules/projectModule.ts
async function loadProjectContent(projectId: string): Promise<void> {
  if (!projectId || projectId === 'undefined') {
    console.log('ğŸ“‚ [Content Load] æ–°é¡¹ç›®ï¼Œè·³è¿‡å†…å®¹åŠ è½½')
    currentProject.value = null
    mediaReferences.value = {}
    lastSaved.value = null
    isProjectContentReady.value = true
    return
  }

  try {
    isLoading.value = true
    updateLoadingProgress('å¼€å§‹åŠ è½½é¡¹ç›®å†…å®¹...', 5)
    console.log(`ğŸ“‚ [Content Load] å¼€å§‹åŠ è½½é¡¹ç›®å†…å®¹: ${projectId}`)

    // è·å–é¢„åŠ è½½çš„è®¾ç½®ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
    const { useVideoStore } = await import('../videoStore')
    const videoStore = useVideoStore()
    const preloadedSettings = {
      videoResolution: videoStore.videoResolution,
      frameRate: videoStore.frameRate,
      timelineDurationFrames: videoStore.timelineDurationFrames,
    }

    // ä½¿ç”¨åˆ†é˜¶æ®µåŠ è½½æ–¹æ³•
    const result = await projectManager.loadProjectContent(projectId, preloadedSettings, {
      loadMedia: true,
      loadTimeline: true,
      onProgress: (stage, progress) => {
        updateLoadingProgress(stage, progress)
      },
    })

    if (result?.projectConfig) {
      const { projectConfig, mediaItems, timelineItems, tracks } = result

      // è®¾ç½®é¡¹ç›®é…ç½®
      currentProject.value = projectConfig
      mediaReferences.value = projectConfig.localMediaReferences || {}
      lastSaved.value = new Date(projectConfig.updatedAt)

      // å…ˆæ¸…ç†æ— æ•ˆçš„åª’ä½“å¼•ç”¨ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
      await cleanupInvalidMediaReferences(mediaItems || [])

      // ç„¶åæ¢å¤åª’ä½“æ–‡ä»¶åˆ°VideoStoreä¸­
      if (mediaItems && mediaItems.length > 0) {
        console.log(`ğŸ“ [Content Load] æ¢å¤åª’ä½“æ–‡ä»¶åˆ°store: ${mediaItems.length}ä¸ªæ–‡ä»¶`)
        videoStore.restoreMediaItems(mediaItems)
        console.log(`âœ… [Content Load] åª’ä½“æ–‡ä»¶æ¢å¤å®Œæˆ: ${mediaItems.length}ä¸ªæ–‡ä»¶`)
      }

      // å¦‚æœæœ‰è½¨é“æ•°æ®ï¼Œæ¢å¤è½¨é“ç»“æ„
      if (tracks && tracks.length > 0) {
        console.log(`ğŸ“‹ [Content Load] æ¢å¤è½¨é“ç»“æ„: ${tracks.length}ä¸ªè½¨é“`)
        videoStore.restoreTracks(tracks)
        console.log(`âœ… [Content Load] è½¨é“ç»“æ„æ¢å¤å®Œæˆ: ${tracks.length}ä¸ªè½¨é“`)
      }

      // å¦‚æœæœ‰æ—¶é—´è½´é¡¹ç›®æ•°æ®ï¼Œæ¢å¤æ—¶é—´è½´é¡¹ç›®
      if (timelineItems && timelineItems.length > 0) {
        console.log(`â° [Content Load] æ¢å¤æ—¶é—´è½´é¡¹ç›®: ${timelineItems.length}ä¸ªé¡¹ç›®`)
        await videoStore.restoreTimelineItems(timelineItems)
        console.log(`âœ… [Content Load] æ—¶é—´è½´é¡¹ç›®æ¢å¤å®Œæˆ: ${timelineItems.length}ä¸ªé¡¹ç›®`)
      }

      updateLoadingProgress('é¡¹ç›®å†…å®¹åŠ è½½å®Œæˆ', 100)
      console.log(`âœ… [Content Load] é¡¹ç›®å†…å®¹åŠ è½½æˆåŠŸ: ${projectConfig.name}`)
    } else {
      console.warn(`âŒ [Content Load] é¡¹ç›®ä¸å­˜åœ¨: ${projectId}`)
    }

    isProjectContentReady.value = true
  } catch (error) {
    console.error('âŒ [Content Load] åŠ è½½é¡¹ç›®å†…å®¹å¤±è´¥:', error)
    throw error
  } finally {
    resetLoadingState()
  }
}
```

#### 4.2 é¡¹ç›®ç®¡ç†å™¨ä¸­çš„å†…å®¹åŠ è½½å®ç°
```typescript
// æ–‡ä»¶: frontend/src/utils/ProjectManager.ts
async loadProjectContent(
  projectId: string,
  preloadedSettings?: ProjectConfig['settings'],
  options: LoadProjectOptions = {},
): Promise<ProjectLoadResult | null> {
  const { loadMedia = true, loadTimeline = true, onProgress } = options

  try {
    console.log(`ğŸ“‚ [Content Load] å¼€å§‹åŠ è½½é¡¹ç›®å†…å®¹: ${projectId}`)
    const loadedStages: string[] = []

    // é˜¶æ®µ1: åŠ è½½é¡¹ç›®é…ç½® (å¦‚æœæ²¡æœ‰é¢„åŠ è½½è®¾ç½®åˆ™éœ€è¦åŠ è½½)
    let projectConfig: ProjectConfig

    if (preloadedSettings) {
      console.log(`ğŸ”§ [Content Load] ä½¿ç”¨é¢„åŠ è½½çš„è®¾ç½®ï¼Œè·³è¿‡é…ç½®æ–‡ä»¶è¯»å–`)
      onProgress?.('ä½¿ç”¨é¢„åŠ è½½è®¾ç½®...', 10)

      // ä»éœ€è¦è¯»å–å®Œæ•´é…ç½®ä»¥è·å–å…¶ä»–æ•°æ®ï¼Œä½†è®¾ç½®éƒ¨åˆ†ä½¿ç”¨é¢„åŠ è½½çš„
      const projectsHandle = await workspaceHandle.getDirectoryHandle(this.PROJECTS_FOLDER)
      const projectHandle = await projectsHandle.getDirectoryHandle(projectId)
      const fullConfig = await this.loadProjectConfig(projectHandle)

      if (!fullConfig) {
        throw new Error('é¡¹ç›®é…ç½®åŠ è½½å¤±è´¥')
      }

      // ä½¿ç”¨é¢„åŠ è½½çš„è®¾ç½®è¦†ç›–æ–‡ä»¶ä¸­çš„è®¾ç½®
      projectConfig = {
        ...fullConfig,
        settings: preloadedSettings,
      }
    } else {
      console.log(`ğŸ“‚ [Content Load] åŠ è½½å®Œæ•´é¡¹ç›®é…ç½®...`)
      onProgress?.('åŠ è½½é¡¹ç›®é…ç½®...', 10)

      const projectsHandle = await workspaceHandle.getDirectoryHandle(this.PROJECTS_FOLDER)
      const projectHandle = await projectsHandle.getDirectoryHandle(projectId)
      const fullConfig = await this.loadProjectConfig(projectHandle)

      if (!fullConfig) {
        throw new Error('é¡¹ç›®é…ç½®åŠ è½½å¤±è´¥')
      }

      projectConfig = fullConfig
    }

    loadedStages.push('config-loaded')
    console.log(`âœ… [Content Load] é¡¹ç›®é…ç½®å¤„ç†å®Œæˆ: ${projectConfig.name}`)

    // é˜¶æ®µ2: åŠ è½½åª’ä½“æ–‡ä»¶ (20% -> 80%)
    let mediaItems: LocalMediaItem[] | undefined

    if (
      loadMedia &&
      projectConfig.localMediaReferences &&
      Object.keys(projectConfig.localMediaReferences).length > 0
    ) {
      onProgress?.('åŠ è½½åª’ä½“æ–‡ä»¶...', 30)

      console.log(
        `ğŸ“ [Content Load] å¼€å§‹åŠ è½½åª’ä½“æ–‡ä»¶: ${Object.keys(projectConfig.localMediaReferences).length}ä¸ªæ–‡ä»¶`,
      )

      try {
        mediaItems = await mediaManager.loadAllMediaForProject(
          projectId,
          projectConfig.localMediaReferences,
          {
            batchSize: 10,
            onProgress: (loaded, total) => {
              // å°†åª’ä½“åŠ è½½è¿›åº¦æ˜ å°„åˆ°30%-80%èŒƒå›´
              const mediaProgress = 30 + (loaded / total) * 50
              onProgress?.(`åŠ è½½åª’ä½“æ–‡ä»¶ ${loaded}/${total}...`, mediaProgress)
            },
          },
        )

        loadedStages.push('media-loaded')
        console.log(`âœ… [Content Load] åª’ä½“æ–‡ä»¶åŠ è½½å®Œæˆ: ${mediaItems.length}ä¸ªæ–‡ä»¶`)
      } catch (error) {
        console.error('âŒ [Content Load] åª’ä½“æ–‡ä»¶åŠ è½½å¤±è´¥:', error)
        // åª’ä½“åŠ è½½å¤±è´¥ä¸åº”è¯¥é˜»æ­¢é¡¹ç›®åŠ è½½ï¼Œç»§ç»­åç»­æµç¨‹
        mediaItems = []
      }
    }

    // é˜¶æ®µ3: åŠ è½½æ—¶é—´è½´æ•°æ® (80% -> 95%)
    let timelineItems: LocalTimelineItemData[] | undefined
    let tracks: Track[] | undefined

    if (loadTimeline && projectConfig.timeline) {
      onProgress?.('åŠ è½½æ—¶é—´è½´æ•°æ®...', 85)

      tracks = projectConfig.timeline.tracks || []
      console.log(`ğŸ“‹ [Content Load] åŠ è½½è½¨é“æ•°æ®: ${tracks.length}ä¸ªè½¨é“`)

      timelineItems = projectConfig.timeline.timelineItems || []
      console.log(`â° [Content Load] åŠ è½½æ—¶é—´è½´é¡¹ç›®æ•°æ®: ${timelineItems.length}ä¸ªé¡¹ç›®`)

      onProgress?.('æ—¶é—´è½´æ•°æ®åŠ è½½å®Œæˆ...', 95)
      loadedStages.push('timeline-loaded')
      console.log(
        `âœ… [Content Load] æ—¶é—´è½´æ•°æ®åŠ è½½å®Œæˆ: ${tracks.length}ä¸ªè½¨é“, ${timelineItems.length}ä¸ªé¡¹ç›®`,
      )
    }

    // é˜¶æ®µ4: å®ŒæˆåŠ è½½ (95% -> 100%)
    onProgress?.('å†…å®¹åŠ è½½å®Œæˆ', 100)
    loadedStages.push('complete')

    const result: ProjectLoadResult = {
      projectConfig,
      mediaItems,
      timelineItems,
      tracks,
      loadedStages,
    }

    console.log(`âœ… [Content Load] é¡¹ç›®å†…å®¹åŠ è½½å®Œæˆ: ${projectConfig.name}`, {
      loadedStages,
      mediaItemsCount: mediaItems?.length || 0,
      timelineItemsCount: timelineItems?.length || 0,
      tracksCount: tracks?.length || 0,
    })

    return result
  } catch (error) {
    console.error(`âŒ [Content Load] åŠ è½½é¡¹ç›®å†…å®¹å¤±è´¥: ${projectId}`, error)
    throw error
  }
}
```

### 5. æ—¶é—´è½´é¡¹ç›®é‡å»ºé˜¶æ®µ

#### 5.1 æ—¶é—´è½´é¡¹ç›®æ¢å¤
```typescript
// æ–‡ä»¶: frontend/src/stores/videoStore.ts
async function restoreTimelineItems(restoredTimelineItems: LocalTimelineItemData[]) {
  console.log(`â° å¼€å§‹æ¢å¤æ—¶é—´è½´é¡¹ç›®: ${restoredTimelineItems.length}ä¸ªé¡¹ç›®`)

  // æ¸…ç©ºç°æœ‰çš„æ—¶é—´è½´é¡¹ç›®
  timelineModule.timelineItems.value = []

  // é¦–å…ˆæ¢å¤æ—¶é—´è½´é¡¹ç›®æ•°æ®ï¼ˆä¸åŒ…å«spriteï¼‰
  for (const itemData of restoredTimelineItems) {
    // åŸºæœ¬éªŒè¯ï¼šå¿…é¡»æœ‰ID
    if (!itemData.id) {
      console.warn('âš ï¸ è·³è¿‡æ— æ•ˆçš„æ—¶é—´è½´é¡¹ç›®æ•°æ®ï¼ˆç¼ºå°‘IDï¼‰:', itemData)
      continue
    }

    // ç‰¹æ®Šå¤„ç†æ–‡æœ¬ç±»å‹ï¼ˆæ–‡æœ¬ç±»å‹æ²¡æœ‰å¯¹åº”çš„åª’ä½“é¡¹ç›®ï¼ŒmediaItemIdå¯ä»¥ä¸ºç©ºï¼‰
    if (itemData.mediaType === 'text') {
      // æ–‡æœ¬ç±»å‹éªŒè¯é€šè¿‡
    } else {
      // éæ–‡æœ¬ç±»å‹ï¼šå¿…é¡»æœ‰mediaItemIdä¸”å¯¹åº”çš„åª’ä½“é¡¹ç›®å¿…é¡»å­˜åœ¨
      if (!itemData.mediaItemId) {
        console.warn('âš ï¸ è·³è¿‡æ— æ•ˆçš„æ—¶é—´è½´é¡¹ç›®æ•°æ®ï¼ˆç¼ºå°‘mediaItemIdï¼‰:', itemData)
        continue
      }

      const mediaItem = mediaModule.getLocalMediaItem(itemData.mediaItemId)
      if (!mediaItem) {
        console.warn(`âš ï¸ è·³è¿‡æ—¶é—´è½´é¡¹ç›®ï¼Œå¯¹åº”çš„åª’ä½“é¡¹ç›®ä¸å­˜åœ¨: ${itemData.mediaItemId}`)
        continue
      }
    }

    // åˆ›å»ºæ—¶é—´è½´é¡¹ç›®ï¼ˆä¸åŒ…å«spriteå’ŒthumbnailUrlï¼Œéƒ½å°†åœ¨åç»­é‡å»ºï¼‰
    const timelineItem: Partial<LocalTimelineItem> = {
      id: itemData.id,
      mediaItemId: itemData.mediaItemId,
      trackId: itemData.trackId,
      mediaType: itemData.mediaType,
      timeRange: itemData.timeRange,
      config: itemData.config,
      animation: itemData.animation ? { ...itemData.animation } : undefined, // æ¢å¤åŠ¨ç”»é…ç½®
      mediaName: itemData.mediaName, // æ¢å¤åª’ä½“åç§°
    }

    // æš‚æ—¶æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼ˆä¸å®Œæ•´çš„é¡¹ç›®ï¼‰
    timelineModule.timelineItems.value.push(timelineItem as LocalTimelineItem)
    console.log(`ğŸ“‹ æ¢å¤æ—¶é—´è½´é¡¹ç›®æ•°æ®: ${itemData.id} (${itemData.mediaType})`)
  }

  console.log(`âœ… æ—¶é—´è½´é¡¹ç›®æ•°æ®æ¢å¤å®Œæˆ: ${timelineModule.timelineItems.value.length}ä¸ªé¡¹ç›®`)

  // ç„¶åç­‰å¾…WebAVç”»å¸ƒå‡†å¤‡å¥½ï¼Œé‡å»ºæ‰€æœ‰sprite
  await rebuildTimelineItemSprites()
}
```

#### 5.2 Spriteé‡å»º
```typescript
// æ–‡ä»¶: frontend/src/stores/videoStore.ts
async function rebuildTimelineItemSprites() {
  console.log(`ğŸ”„ å¼€å§‹é‡å»ºæ—¶é—´è½´é¡¹ç›®çš„sprite...`)

  const items = timelineModule.timelineItems.value
  if (items.length === 0) {
    console.log(`â„¹ï¸ æ²¡æœ‰æ—¶é—´è½´é¡¹ç›®éœ€è¦é‡å»ºsprite`)
    return
  }

  // ç­‰å¾…WebAVç”»å¸ƒå‡†å¤‡å¥½
  await webavModule.waitForWebAVReady()

  // å¯¼å…¥spriteå·¥å‚å‡½æ•°å’Œç¼©ç•¥å›¾ç”Ÿæˆå‡½æ•°
  const { createSpriteFromMediaItem } = await import('../utils/spriteFactory')
  const { regenerateThumbnailForTimelineItem } = await import('../utils/thumbnailGenerator')

  let rebuiltCount = 0
  for (const timelineItem of items) {
    try {
      if (isAsyncProcessingTimelineItem(timelineItem)) {
        continue
      }
      console.log(`ğŸ”„ é‡å»ºsprite: ${timelineItem.id} (${rebuiltCount + 1}/${items.length})`)

      // ç‰¹æ®Šå¤„ç†æ–‡æœ¬ç±»å‹çš„æ—¶é—´è½´é¡¹ç›®
      let newSprite: any
      if (timelineItem.mediaType === 'text') {
        // æ–‡æœ¬ç±»å‹ï¼šä»é…ç½®ä¸­é‡æ–°åˆ›å»ºTextVisibleSprite
        const textConfig = timelineItem.config as TextMediaConfig
        const { TextVisibleSprite } = await import('../utils/TextVisibleSprite')
        newSprite = await TextVisibleSprite.create(textConfig.text, textConfig.style)
      } else {
        // å…¶ä»–ç±»å‹ï¼šä»åª’ä½“é¡¹ç›®åˆ›å»ºsprite
        const mediaItem = mediaModule.getLocalMediaItem(timelineItem.mediaItemId)
        if (!mediaItem) {
          console.warn(`âš ï¸ è·³è¿‡æ—¶é—´è½´é¡¹ç›®ï¼Œå¯¹åº”çš„åª’ä½“é¡¹ç›®ä¸å­˜åœ¨: ${timelineItem.mediaItemId}`)
          continue
        }

        if (mediaItem.status !== 'ready') {
          console.warn(`âš ï¸ è·³è¿‡æ—¶é—´è½´é¡¹ç›®ï¼Œåª’ä½“é¡¹ç›®å°šæœªå‡†å¤‡å¥½: ${mediaItem.name}`)
          continue
        }

        // ä»åŸå§‹ç´ æé‡æ–°åˆ›å»ºsprite
        newSprite = await createSpriteFromMediaItem(mediaItem)
      }

      // æ¢å¤æ—¶é—´èŒƒå›´è®¾ç½®
      newSprite.setTimeRange(timelineItem.timeRange)

      // æ¢å¤é…ç½®è®¾ç½®ï¼ˆåŒ…æ‹¬ä½ç½®ã€å¤§å°ã€æ—‹è½¬ã€é€æ˜åº¦ç­‰ï¼‰
      if (timelineItem.config) {
        // æ ¹æ®åª’ä½“ç±»å‹åº”ç”¨é…ç½®
        if (timelineItem.mediaType === 'video') {
          // VideoVisibleSpriteï¼šåº”ç”¨è§†è§‰å’ŒéŸ³é¢‘å±æ€§
          const videoSprite = newSprite as VideoVisibleSprite
          const visualProps = getVisualPropsFromData(timelineItem)
          const audioProps = getAudioPropsFromData(timelineItem)

          // åº”ç”¨åæ ‡è½¬æ¢ï¼ˆä½ç½®å’Œå°ºå¯¸ï¼‰
          if (visualProps) {
            const { projectToWebavCoords } = await import('../utils/coordinateTransform')
            const webavCoords = projectToWebavCoords(
              visualProps.x,
              visualProps.y,
              visualProps.width,
              visualProps.height,
              configModule.videoResolution.value.width,
              configModule.videoResolution.value.height,
            )
            videoSprite.rect.x = webavCoords.x
            videoSprite.rect.y = webavCoords.y
            videoSprite.rect.w = visualProps.width
            videoSprite.rect.h = visualProps.height
            videoSprite.rect.angle = visualProps.rotation
            videoSprite.opacity = visualProps.opacity
            videoSprite.zIndex = visualProps.zIndex
          }

          // åº”ç”¨éŸ³é¢‘å±æ€§
          if (audioProps) {
            videoSprite.setAudioState({
              volume: audioProps.volume,
              isMuted: audioProps.isMuted,
            })
          }
        }
        // å…¶ä»–åª’ä½“ç±»å‹çš„å¤„ç†...
      }

      // æ·»åŠ åˆ°ç”»å¸ƒ
      await webavModule.addSprite(newSprite)

      // æ›´æ–°storeä¸­çš„spriteå¼•ç”¨
      timelineModule.updateLocalTimelineItemSprite(timelineItem.id, markRaw(newSprite))

      // é‡æ–°è®¾ç½®åŒå‘æ•°æ®åŒæ­¥
      timelineModule.setupBidirectionalSync(timelineItem)

      // å¦‚æœæœ‰åŠ¨ç”»é…ç½®ï¼Œé‡æ–°åº”ç”¨åŠ¨ç”»
      if (timelineItem.animation && timelineItem.animation.isEnabled) {
        try {
          console.log(`ğŸ¬ é‡æ–°åº”ç”¨åŠ¨ç”»é…ç½®: ${timelineItem.id}`)
          const { updateWebAVAnimation } = await import('../utils/webavAnimationManager')
          await updateWebAVAnimation(timelineItem)
          console.log(`âœ… åŠ¨ç”»é…ç½®é‡æ–°åº”ç”¨å®Œæˆ: ${timelineItem.id}`)
        } catch (animationError) {
          console.error(`âŒ åŠ¨ç”»é…ç½®é‡æ–°åº”ç”¨å¤±è´¥: ${timelineItem.id}`, animationError)
        }
      }

      // é‡æ–°ç”Ÿæˆç¼©ç•¥å›¾ï¼ˆå› ä¸ºä¹‹å‰çš„blob URLå¯èƒ½å·²å¤±æ•ˆï¼‰
      if (timelineItem.mediaType !== 'audio' && timelineItem.mediaType !== 'text') {
        const mediaItem = mediaModule.getLocalMediaItem(timelineItem.mediaItemId)
        if (mediaItem) {
          console.log(`ğŸ–¼ï¸ é‡æ–°ç”Ÿæˆç¼©ç•¥å›¾: ${timelineItem.id}`)
          const newThumbnailUrl = await regenerateThumbnailForTimelineItem(
            timelineItem,
            mediaItem,
          )
          if (newThumbnailUrl) {
            timelineItem.thumbnailUrl = newThumbnailUrl
            console.log(`âœ… ç¼©ç•¥å›¾é‡æ–°ç”Ÿæˆå®Œæˆ: ${timelineItem.id}`)
          }
        }
      }

      rebuiltCount++
      console.log(`âœ… spriteé‡å»ºå®Œæˆ: ${timelineItem.id} (${rebuiltCount}/${items.length})`)
    } catch (error) {
      console.error(`âŒ spriteé‡å»ºå¤±è´¥: ${timelineItem.id}`, error)
    }
  }

  console.log(`âœ… æ‰€æœ‰spriteé‡å»ºå®Œæˆ: æˆåŠŸ${rebuiltCount}/${items.length}ä¸ª`)
}
```

### 6. åª’ä½“å¼•ç”¨æ¸…ç†é˜¶æ®µ

#### 6.1 æ¸…ç†æ— æ•ˆåª’ä½“å¼•ç”¨
```typescript
// æ–‡ä»¶: frontend/src/stores/modules/projectModule.ts
async function cleanupInvalidMediaReferences(loadedMediaItems: LocalMediaItem[]): Promise<void> {
  const loadedMediaIds = new Set(loadedMediaItems.map((item) => item.id))
  const originalReferencesCount = Object.keys(mediaReferences.value).length

  console.log(
    `ğŸ§¹ [MEDIA-CLEANUP] æ£€æŸ¥åª’ä½“å¼•ç”¨ä¸€è‡´æ€§: ${originalReferencesCount} ä¸ªå¼•ç”¨, ${loadedMediaItems.length} ä¸ªæˆåŠŸåŠ è½½`,
  )

  // æ‰¾å‡ºæ— æ•ˆçš„åª’ä½“å¼•ç”¨ï¼ˆåœ¨å¼•ç”¨ä¸­å­˜åœ¨ä½†æœªæˆåŠŸåŠ è½½çš„ï¼‰
  const invalidMediaIds: string[] = []
  for (const mediaId in mediaReferences.value) {
    if (!loadedMediaIds.has(mediaId)) {
      invalidMediaIds.push(mediaId)
    }
  }

  if (invalidMediaIds.length > 0) {
    console.log(`ğŸ§¹ [MEDIA-CLEANUP] å‘ç° ${invalidMediaIds.length} ä¸ªæ— æ•ˆåª’ä½“å¼•ç”¨ï¼Œå¼€å§‹æ¸…ç†...`)

    // ç§»é™¤æ— æ•ˆçš„åª’ä½“å¼•ç”¨
    for (const mediaId of invalidMediaIds) {
      const reference = mediaReferences.value[mediaId]
      console.log(
        `ğŸ§¹ [MEDIA-CLEANUP] æ¸…ç†æ— æ•ˆåª’ä½“å¼•ç”¨: ${mediaId} (${reference?.originalFileName || 'Unknown'})`,
      )
      delete mediaReferences.value[mediaId]
    }

    // ç«‹å³ä¿å­˜æ›´æ–°åçš„é¡¹ç›®é…ç½®
    try {
      if (currentProject.value) {
        // æ›´æ–°å½“å‰é¡¹ç›®çš„ localMediaReferences
        currentProject.value.localMediaReferences = { ...mediaReferences.value }
        await projectManager.saveProject(currentProject.value)
        console.log(
          `ğŸ§¹ [MEDIA-CLEANUP] âœ… åª’ä½“å¼•ç”¨æ¸…ç†å®Œæˆ: ç§»é™¤ ${invalidMediaIds.length} ä¸ªæ— æ•ˆå¼•ç”¨ (${originalReferencesCount} -> ${Object.keys(mediaReferences.value).length})`,
        )
      }
    } catch (error) {
      console.error('ğŸ§¹ [MEDIA-CLEANUP] âŒ ä¿å­˜æ¸…ç†åçš„é¡¹ç›®é…ç½®å¤±è´¥:', error)
    }
  } else {
    console.log(
      `ğŸ§¹ [MEDIA-CLEANUP] âœ… åª’ä½“å¼•ç”¨æ£€æŸ¥å®Œæˆ: æ‰€æœ‰ ${originalReferencesCount} ä¸ªå¼•ç”¨éƒ½æœ‰æ•ˆ`,
    )
  }
}
```

## åŠ è½½çŠ¶æ€ç®¡ç†

### çŠ¶æ€å®šä¹‰
```typescript
// æ–‡ä»¶: frontend/src/stores/modules/projectModule.ts
// é¡¹ç›®åŠ è½½çŠ¶æ€
const isLoading = ref(false)

// é¡¹ç›®è®¾ç½®é¢„åŠ è½½çŠ¶æ€
const isProjectSettingsReady = ref(false)

// é¡¹ç›®å†…å®¹åŠ è½½çŠ¶æ€
const isProjectContentReady = ref(false)

// åŠ è½½è¿›åº¦çŠ¶æ€
const loadingProgress = ref(0) // 0-100
const loadingStage = ref('') // å½“å‰åŠ è½½é˜¶æ®µ
const loadingDetails = ref('') // è¯¦ç»†ä¿¡æ¯
```

### è¿›åº¦æ›´æ–°
```typescript
// æ–‡ä»¶: frontend/src/stores/modules/projectModule.ts
function updateLoadingProgress(stage: string, progress: number, details?: string): void {
  loadingStage.value = stage
  loadingProgress.value = Math.max(0, Math.min(100, progress))
  loadingDetails.value = details || ''
  console.log(`ğŸ“Š åŠ è½½è¿›åº¦: ${stage} (${progress}%)${details ? ` - ${details}` : ''}`)
}
```

### çŠ¶æ€é‡ç½®
```typescript
// æ–‡ä»¶: frontend/src/stores/modules/projectModule.ts
function resetLoadingState(delay: number = 300): void {
  if (delay > 0) {
    // å»¶è¿Ÿé‡ç½®ï¼Œè®©ç”¨æˆ·çœ‹åˆ°åŠ è½½å®Œæˆçš„çŠ¶æ€
    setTimeout(() => {
      isLoading.value = false
      loadingProgress.value = 0
      loadingStage.value = ''
      loadingDetails.value = ''
    }, delay)
  } else {
    // ç«‹å³é‡ç½®
    isLoading.value = false
    loadingProgress.value = 0
    loadingStage.value = ''
    loadingDetails.value = ''
  }
}
```

## æ–‡ä»¶ç»“æ„

æ—§æ¶æ„çš„é¡¹ç›®æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š
```
å·¥ä½œç›®å½•/
â””â”€â”€ projects/
    â””â”€â”€ project_1234567890/
        â”œâ”€â”€ project.json          # é¡¹ç›®é…ç½®æ–‡ä»¶
        â”œâ”€â”€ media/                # åª’ä½“æ–‡ä»¶ç›®å½•
        â”‚   â”œâ”€â”€ videos/           # è§†é¢‘æ–‡ä»¶
        â”‚   â”œâ”€â”€ images/           # å›¾ç‰‡æ–‡ä»¶
        â”‚   â”œâ”€â”€ audio/            # éŸ³é¢‘æ–‡ä»¶
        â”‚   â””â”€â”€ thumbnails/       # ç¼©ç•¥å›¾æ–‡ä»¶
        â””â”€â”€ exports/              # å¯¼å‡ºæ–‡ä»¶ç›®å½•
```

## é¡¹ç›®é…ç½®æ–‡ä»¶ç»“æ„

```json
{
  "id": "project_1234567890",
  "name": "æˆ‘çš„è§†é¢‘é¡¹ç›®",
  "description": "é¡¹ç›®æè¿°",
  "createdAt": "2023-01-01T00:00:00.000Z",
  "updatedAt": "2023-01-01T00:00:00.000Z",
  "version": "1.0.0",
  "settings": {
    "videoResolution": {
      "name": "1920x1080",
      "width": 1920,
      "height": 1080,
      "aspectRatio": "16:9"
    },
    "frameRate": 30,
    "timelineDurationFrames": 3000
  },
  "timeline": {
    "tracks": [...],
    "timelineItems": [...],
    "mediaItems": [...]
  },
  "localMediaReferences": {
    "media_1": {
      "originalFileName": "video1.mp4",
      "storedPath": "media/videos/video1.mp4",
      "fileSize": 1024000,
      "fileType": "video/mp4",
      "mediaType": "video"
    }
  },
  "asyncProcessingMediaReferences": {},
  "exports": []
}
```

## é”™è¯¯å¤„ç†æœºåˆ¶

æ—§æ¶æ„åœ¨é¡¹ç›®åŠ è½½è¿‡ç¨‹ä¸­å®ç°äº†å¤šå±‚é”™è¯¯å¤„ç†ï¼š

1. **æ–‡ä»¶ç³»ç»Ÿé”™è¯¯å¤„ç†**ï¼šå¤„ç†æ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™ä¸è¶³ç­‰æ–‡ä»¶ç³»ç»Ÿé”™è¯¯
2. **åª’ä½“åŠ è½½é”™è¯¯å¤„ç†**ï¼šå•ä¸ªåª’ä½“æ–‡ä»¶åŠ è½½å¤±è´¥ä¸ä¼šé˜»æ­¢æ•´ä¸ªé¡¹ç›®åŠ è½½
3. **æ•°æ®éªŒè¯**ï¼šå¯¹åŠ è½½çš„é¡¹ç›®é…ç½®è¿›è¡Œä¸¥æ ¼éªŒè¯
4. **ç”¨æˆ·åé¦ˆ**ï¼šé€šè¿‡æ§åˆ¶å°æ—¥å¿—å’ŒUIçŠ¶æ€å‘ç”¨æˆ·æä¾›åé¦ˆ

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

1. **åˆ†é˜¶æ®µåŠ è½½**ï¼šå°†é¡¹ç›®åŠ è½½åˆ†ä¸ºè®¾ç½®é¢„åŠ è½½å’Œå†…å®¹åŠ è½½ä¸¤ä¸ªé˜¶æ®µ
2. **æ‰¹é‡åŠ è½½**ï¼šåª’ä½“æ–‡ä»¶é‡‡ç”¨æ‰¹é‡åŠ è½½ç­–ç•¥ï¼Œé¿å…åŒæ—¶åŠ è½½è¿‡å¤šæ–‡ä»¶
3. **è¿›åº¦åé¦ˆ**ï¼šæä¾›è¯¦ç»†çš„åŠ è½½è¿›åº¦åé¦ˆï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒ
4. **ç¼“å­˜æœºåˆ¶**ï¼šé¢„åŠ è½½çš„è®¾ç½®ä¼šè¢«ç¼“å­˜ï¼Œé¿å…é‡å¤è¯»å–
5. **å»¶è¿Ÿé‡å»º**ï¼šæ—¶é—´è½´é¡¹ç›®çš„spriteé‡å»ºç­‰å¾…WebAVç”»å¸ƒå‡†å¤‡å®Œæˆåè¿›è¡Œ

## æ€»ç»“

æ—§æ¶æ„çš„é¡¹ç›®åŠ è½½æµç¨‹è®¾è®¡åˆç†ï¼Œé‡‡ç”¨äº†åˆ†é˜¶æ®µåŠ è½½ç­–ç•¥ï¼Œç¡®ä¿äº†ç”¨æˆ·ä½“éªŒçš„æµç•…æ€§ã€‚é€šè¿‡è®¾ç½®é¢„åŠ è½½å’Œå†…å®¹åŠ è½½çš„åˆ†ç¦»ï¼Œä»¥åŠè¯¦ç»†çš„è¿›åº¦åé¦ˆæœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿçœ‹åˆ°é¡¹ç›®ç•Œé¢ï¼ŒåŒæ—¶åå°ç»§ç»­åŠ è½½åª’ä½“æ–‡ä»¶å’Œæ—¶é—´è½´æ•°æ®ã€‚

è¯¥æ¶æ„çš„ä¸»è¦ä¼˜ç‚¹åŒ…æ‹¬ï¼š
- å“åº”è¿…é€Ÿï¼šè®¾ç½®é¢„åŠ è½½ç¡®ä¿ç•Œé¢å¿«é€Ÿå“åº”
- å®¹é”™æ€§å¼ºï¼šå•ä¸ªåª’ä½“æ–‡ä»¶åŠ è½½å¤±è´¥ä¸å½±å“æ•´ä½“é¡¹ç›®åŠ è½½
- ç”¨æˆ·ä½“éªŒå¥½ï¼šè¯¦ç»†çš„è¿›åº¦åé¦ˆè®©ç”¨æˆ·äº†è§£åŠ è½½çŠ¶æ€
- æ•°æ®ä¸€è‡´æ€§ï¼šé€šè¿‡åª’ä½“å¼•ç”¨æ¸…ç†ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

ä¸»è¦çš„æ”¹è¿›ç©ºé—´åŒ…æ‹¬ï¼š
- å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–å¤§åª’ä½“æ–‡ä»¶çš„åŠ è½½ç­–ç•¥
- å¯ä»¥å¢åŠ æ›´å¤šçš„ç¼“å­˜æœºåˆ¶æé«˜é‡å¤åŠ è½½é€Ÿåº¦
- å¯ä»¥ä¼˜åŒ–é”™è¯¯æ¢å¤æœºåˆ¶ï¼Œæä¾›æ›´å¤šçš„è‡ªåŠ¨ä¿®å¤é€‰é¡¹