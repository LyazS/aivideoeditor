# ç»Ÿä¸€è½¨é“ç±»å‹è®¾è®¡ - ä½¿ç”¨ç¤ºä¾‹

## æ¦‚è¿°

æœ¬æ–‡æ¡£å±•ç¤ºäº†åŸºäºæ–°æ¶æ„çš„ç»Ÿä¸€è½¨é“ç±»å‹ç³»ç»Ÿçš„å…·ä½“ä½¿ç”¨æ–¹æ³•ã€‚æ–°çš„è½¨é“ç³»ç»Ÿé‡‡ç”¨"æ ¸å¿ƒæ•°æ® + è¡Œä¸ºåˆ†ç¦»"çš„å“åº”å¼æ¶æ„æ¨¡å¼ï¼Œä¸UnifiedMediaItemå’ŒUnifiedTimelineItemä¿æŒä¸€è‡´çš„è®¾è®¡ç†å¿µã€‚

## æ ¸å¿ƒè®¾è®¡ç‰¹ç‚¹

### 1. å“åº”å¼ä¼˜å…ˆ
- é‡‡ç”¨Vue3å“åº”å¼ç³»ç»Ÿï¼ŒçŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘UIæ›´æ–°
- çº¯æ•°æ®å¯¹è±¡è®¾è®¡ï¼Œä½¿ç”¨`reactive()`åŒ…è£…
- ä¸ç°æœ‰çš„ç»Ÿä¸€åª’ä½“é¡¹ç›®å’Œæ—¶é—´è½´é¡¹ç›®æ¶æ„ä¸€è‡´

### 2. ç±»å‹å®‰å…¨
- å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- ç±»å‹å®ˆå«å‡½æ•°ç¡®ä¿è¿è¡Œæ—¶ç±»å‹å®‰å…¨
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥

### 3. åŠŸèƒ½ä¸°å¯Œ
- æ”¯æŒ5ç§è½¨é“ç±»å‹ï¼šè§†é¢‘ã€éŸ³é¢‘ã€æ–‡æœ¬ã€å­—å¹•ã€ç‰¹æ•ˆ
- å®Œæ•´çš„çŠ¶æ€ç®¡ç†ï¼šå¯è§æ€§ã€éŸ³é¢‘ã€å¸ƒå±€ã€æ¸²æŸ“é…ç½®
- çµæ´»çš„å…ƒæ•°æ®ç³»ç»Ÿ

## åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»ºè½¨é“ç®¡ç†å™¨

```typescript
import { createUnifiedTrackManager } from '@/unified/track'

// åˆ›å»ºè½¨é“ç®¡ç†å™¨å®ä¾‹
const trackManager = createUnifiedTrackManager()

// è·å–å“åº”å¼è½¨é“åˆ—è¡¨
const tracks = trackManager.tracks

// ç›‘å¬è½¨é“å˜åŒ–
watch(tracks, (newTracks) => {
  console.log('è½¨é“åˆ—è¡¨æ›´æ–°:', newTracks.length)
}, { deep: true })
```

### 2. åˆ›å»ºä¸åŒç±»å‹çš„è½¨é“

```typescript
import { createUnifiedTrackData, TrackTypes } from '@/unified/track'

// åˆ›å»ºè§†é¢‘è½¨é“
const videoTrack = createUnifiedTrackData('video', 'ä¸»è§†é¢‘è½¨é“', {
  layout: { height: 100 },
  metadata: { color: '#4CAF50' }
})

// åˆ›å»ºéŸ³é¢‘è½¨é“
const audioTrack = createUnifiedTrackData('audio', 'èƒŒæ™¯éŸ³ä¹', {
  audio: { volume: 0.8 },
  layout: { height: 60 }
})

// åˆ›å»ºæ–‡æœ¬è½¨é“
const textTrack = createUnifiedTrackData('text', 'æ ‡é¢˜æ–‡å­—', {
  renderConfig: {
    fontFamily: 'Arial',
    fontSize: 24,
    fontColor: '#FFFFFF'
  }
})
```

### 3. è½¨é“ç®¡ç†æ“ä½œ

```typescript
// æ·»åŠ è½¨é“åˆ°ç®¡ç†å™¨
const result = trackManager.createTrack('video', 'æ–°è§†é¢‘è½¨é“')
if (result.success) {
  console.log('è½¨é“åˆ›å»ºæˆåŠŸ:', result.trackId)
}

// æ›´æ–°è½¨é“å±æ€§
trackManager.updateTrack(result.trackId!, {
  name: 'æ›´æ–°åçš„è½¨é“åç§°',
  layout: { height: 80 }
})

// åˆ é™¤è½¨é“
trackManager.deleteTrack(result.trackId!)
```

## è½¨é“çŠ¶æ€ç®¡ç†ç¤ºä¾‹

### 1. å¯è§æ€§æ§åˆ¶

```typescript
import { toggleTrackVisibility, isTrackVisible } from '@/unified/track'

// åˆ‡æ¢è½¨é“å¯è§æ€§
toggleTrackVisibility(videoTrack)

// æ£€æŸ¥è½¨é“æ˜¯å¦å¯è§
if (isTrackVisible(videoTrack)) {
  console.log('è½¨é“å½“å‰å¯è§')
}

// è®¾ç½®é€æ˜åº¦
setTrackOpacity(videoTrack, 0.5)
```

### 2. éŸ³é¢‘æ§åˆ¶

```typescript
import { 
  toggleTrackMute, 
  toggleTrackSolo, 
  setTrackVolume,
  trackSupportsAudio 
} from '@/unified/track'

// æ£€æŸ¥è½¨é“æ˜¯å¦æ”¯æŒéŸ³é¢‘
if (trackSupportsAudio(audioTrack)) {
  // åˆ‡æ¢é™éŸ³
  toggleTrackMute(audioTrack)
  
  // åˆ‡æ¢ç‹¬å¥
  toggleTrackSolo(audioTrack)
  
  // è®¾ç½®éŸ³é‡
  setTrackVolume(audioTrack, 0.8)
}
```

### 3. è½¨é“é”å®šå’ŒçŠ¶æ€

```typescript
import { toggleTrackLock, isTrackLocked } from '@/unified/track'

// é”å®šè½¨é“
toggleTrackLock(videoTrack)

// æ£€æŸ¥é”å®šçŠ¶æ€
if (isTrackLocked(videoTrack)) {
  console.log('è½¨é“å·²é”å®šï¼Œæ— æ³•ç¼–è¾‘')
}

// è®¾ç½®è½¨é“çŠ¶æ€
videoTrack.status = 'disabled'
```

## è½¨é“æŸ¥è¯¢å’Œç­›é€‰ç¤ºä¾‹

### 1. åŸºç¡€æŸ¥è¯¢

```typescript
// æ ¹æ®IDè·å–è½¨é“
const track = trackManager.getTrackById('track_123')

// æ ¹æ®ç±»å‹è·å–è½¨é“
const videoTracks = trackManager.getTracksByType('video')
const audioTracks = trackManager.getTracksByType('audio')
```

### 2. æ¡ä»¶æŸ¥è¯¢

```typescript
// æŸ¥è¯¢å¯è§çš„è§†é¢‘è½¨é“
const visibleVideoTracks = trackManager.queryTracks({
  type: 'video',
  visible: true
})

// æŸ¥è¯¢æœªé™éŸ³çš„éŸ³é¢‘è½¨é“
const unmutedAudioTracks = trackManager.queryTracks({
  type: 'audio',
  muted: false
})

// æŸ¥è¯¢é”å®šçš„è½¨é“
const lockedTracks = trackManager.queryTracks({
  locked: true
})
```

### 3. è½¨é“ç»Ÿè®¡

```typescript
// è·å–è½¨é“ç»Ÿè®¡ä¿¡æ¯
const stats = trackManager.stats

console.log('è½¨é“ç»Ÿè®¡:', {
  æ€»æ•°: stats.total,
  è§†é¢‘è½¨é“: stats.byType.video,
  éŸ³é¢‘è½¨é“: stats.byType.audio,
  å¯è§è½¨é“: stats.visible,
  é™éŸ³è½¨é“: stats.muted
})
```

## è½¨é“æ’åºå’Œå¸ƒå±€ç¤ºä¾‹

### 1. è½¨é“é‡æ’åº

```typescript
// é‡æ–°æ’åºè½¨é“
const newOrder = ['track_1', 'track_3', 'track_2']
const result = trackManager.reorderTracks(newOrder)

if (result.success) {
  console.log('è½¨é“é‡æ’åºæˆåŠŸ')
}
```

### 2. è½¨é“é«˜åº¦è°ƒæ•´

```typescript
import { setTrackHeight, validateTrackHeight } from '@/unified/track'

// éªŒè¯é«˜åº¦å€¼
const validation = validateTrackHeight(120)
if (validation.valid) {
  setTrackHeight(videoTrack, 120)
} else {
  console.error('é«˜åº¦å€¼æ— æ•ˆ:', validation.error)
}
```

### 3. è½¨é“æŠ˜å 

```typescript
import { toggleTrackCollapse } from '@/unified/track'

// åˆ‡æ¢è½¨é“æŠ˜å çŠ¶æ€
toggleTrackCollapse(videoTrack)

// æ£€æŸ¥æŠ˜å çŠ¶æ€
if (videoTrack.layout.isCollapsed) {
  console.log('è½¨é“å·²æŠ˜å ')
}
```

## æ‰¹é‡æ“ä½œç¤ºä¾‹

### 1. æ‰¹é‡æ›´æ–°è½¨é“

```typescript
// æ‰¹é‡æ›´æ–°å¤šä¸ªè½¨é“
const trackIds = ['track_1', 'track_2', 'track_3']
const updates = {
  visibility: { isVisible: false },
  audio: { isMuted: true }
}

const result = trackManager.batchUpdateTracks(trackIds, updates)
console.log('æ‰¹é‡æ›´æ–°ç»“æœ:', result.success)
```

### 2. é‡ç½®æ‰€æœ‰è½¨é“

```typescript
// é‡ç½®æ‰€æœ‰è½¨é“åˆ°é»˜è®¤çŠ¶æ€
const result = trackManager.resetAllTracks()
if (result.success) {
  console.log('æ‰€æœ‰è½¨é“å·²é‡ç½®')
}
```

## Vueç»„ä»¶é›†æˆç¤ºä¾‹

### 1. è½¨é“åˆ—è¡¨ç»„ä»¶

```vue
<template>
  <div class="track-list">
    <div 
      v-for="track in tracks" 
      :key="track.id"
      class="track-item"
      :class="{
        'track-visible': isTrackVisible(track),
        'track-muted': isTrackMuted(track),
        'track-locked': isTrackLocked(track)
      }"
      :style="{ 
        height: track.layout.height + 'px',
        backgroundColor: getTrackColor(track)
      }"
    >
      <!-- è½¨é“å¤´éƒ¨ -->
      <div class="track-header">
        <span class="track-icon">{{ getTrackIcon(track) }}</span>
        <span class="track-name">{{ getTrackDisplayName(track) }}</span>
        
        <!-- è½¨é“æ§åˆ¶æŒ‰é’® -->
        <div class="track-controls">
          <button @click="toggleTrackVisibility(track)">
            {{ track.visibility.isVisible ? 'ğŸ‘ï¸' : 'ğŸ™ˆ' }}
          </button>
          
          <button 
            v-if="trackSupportsAudio(track)"
            @click="toggleTrackMute(track)"
          >
            {{ track.audio.isMuted ? 'ğŸ”‡' : 'ğŸ”Š' }}
          </button>
          
          <button @click="toggleTrackLock(track)">
            {{ isTrackLocked(track) ? 'ğŸ”’' : 'ğŸ”“' }}
          </button>
        </div>
      </div>
      
      <!-- è½¨é“å†…å®¹åŒºåŸŸ -->
      <div class="track-content">
        <!-- è¿™é‡Œæ”¾ç½®æ—¶é—´è½´é¡¹ç›® -->
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { 
  createUnifiedTrackManager,
  isTrackVisible,
  isTrackMuted,
  isTrackLocked,
  trackSupportsAudio,
  toggleTrackVisibility,
  toggleTrackMute,
  toggleTrackLock,
  getTrackDisplayName,
  getTrackColor,
  getTrackIcon
} from '@/unified/track'

// åˆ›å»ºè½¨é“ç®¡ç†å™¨
const trackManager = createUnifiedTrackManager()

// å“åº”å¼è½¨é“åˆ—è¡¨
const tracks = computed(() => trackManager.tracks.value)

// åˆå§‹åŒ–é»˜è®¤è½¨é“
trackManager.createTrack('video', 'è§†é¢‘è½¨é“ 1')
trackManager.createTrack('audio', 'éŸ³é¢‘è½¨é“ 1')
trackManager.createTrack('text', 'æ–‡æœ¬è½¨é“ 1')
</script>
```

### 2. è½¨é“å±æ€§é¢æ¿ç»„ä»¶

```vue
<template>
  <div v-if="selectedTrack" class="track-properties">
    <h3>è½¨é“å±æ€§</h3>
    
    <!-- åŸºç¡€ä¿¡æ¯ -->
    <div class="property-group">
      <label>è½¨é“åç§°:</label>
      <input 
        v-model="selectedTrack.name" 
        @input="updateTrack"
        :disabled="isTrackLocked(selectedTrack)"
      />
    </div>
    
    <!-- å¯è§æ€§æ§åˆ¶ -->
    <div class="property-group">
      <label>å¯è§æ€§:</label>
      <input 
        type="checkbox" 
        v-model="selectedTrack.visibility.isVisible"
        @change="updateTrack"
      />
      
      <label>é€æ˜åº¦:</label>
      <input 
        type="range" 
        min="0" 
        max="1" 
        step="0.1"
        v-model.number="selectedTrack.visibility.opacity"
        @input="updateTrack"
      />
    </div>
    
    <!-- éŸ³é¢‘æ§åˆ¶ (ä»…éŸ³é¢‘è½¨é“) -->
    <div v-if="trackSupportsAudio(selectedTrack)" class="property-group">
      <label>éŸ³é‡:</label>
      <input 
        type="range" 
        min="0" 
        max="2" 
        step="0.1"
        v-model.number="selectedTrack.audio.volume"
        @input="updateTrack"
      />
      
      <label>é™éŸ³:</label>
      <input 
        type="checkbox" 
        v-model="selectedTrack.audio.isMuted"
        @change="updateTrack"
      />
    </div>
    
    <!-- å¸ƒå±€æ§åˆ¶ -->
    <div class="property-group">
      <label>è½¨é“é«˜åº¦:</label>
      <input 
        type="number" 
        min="30" 
        max="200"
        v-model.number="selectedTrack.layout.height"
        @input="updateTrack"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue'
import type { UnifiedTrackData } from '@/unified/track'
import { 
  isTrackLocked,
  trackSupportsAudio,
  validateTrackData
} from '@/unified/track'

// Props
const props = defineProps<{
  track: UnifiedTrackData | null
}>()

// é€‰ä¸­çš„è½¨é“
const selectedTrack = ref(props.track)

// ç›‘å¬è½¨é“å˜åŒ–
watch(() => props.track, (newTrack) => {
  selectedTrack.value = newTrack
})

// æ›´æ–°è½¨é“
function updateTrack() {
  if (!selectedTrack.value) return
  
  // éªŒè¯æ•°æ®
  const validation = validateTrackData(selectedTrack.value)
  if (!validation.valid) {
    console.error('è½¨é“æ•°æ®éªŒè¯å¤±è´¥:', validation.errors)
    return
  }
  
  // æ›´æ–°æ—¶é—´æˆ³
  selectedTrack.value.updatedAt = new Date().toISOString()
  
  console.log('è½¨é“å±æ€§å·²æ›´æ–°')
}
</script>
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å“åº”å¼ä¼˜åŒ–

```typescript
// ä½¿ç”¨ shallowRef ä¼˜åŒ–å¤§é‡è½¨é“çš„æ€§èƒ½
import { shallowRef } from 'vue'

const tracks = shallowRef<UnifiedTrackData[]>([])

// æ‰¹é‡æ›´æ–°æ—¶ä½¿ç”¨ nextTick
import { nextTick } from 'vue'

async function batchUpdateTracks() {
  // æ‰¹é‡ä¿®æ”¹
  tracks.value.forEach(track => {
    track.visibility.isVisible = false
  })
  
  // ç­‰å¾…DOMæ›´æ–°
  await nextTick()
  console.log('æ‰¹é‡æ›´æ–°å®Œæˆ')
}
```

### 2. å†…å­˜ç®¡ç†

```typescript
// æ¸…ç†è½¨é“èµ„æº
function cleanupTrack(track: UnifiedTrackData) {
  // æ¸…ç†æ¸²æŸ“é…ç½®
  track.renderConfig = {}
  
  // é‡ç½®çŠ¶æ€
  track.status = 'disabled'
  
  console.log('è½¨é“èµ„æºå·²æ¸…ç†')
}
```

## æ€»ç»“

æ–°çš„ç»Ÿä¸€è½¨é“ç±»å‹ç³»ç»Ÿæä¾›äº†ï¼š

1. **å®Œæ•´çš„ç±»å‹å®‰å…¨**ï¼šTypeScriptç±»å‹å®šä¹‰å’Œè¿è¡Œæ—¶éªŒè¯
2. **å“åº”å¼æ¶æ„**ï¼šä¸Vue3å®Œç¾é›†æˆï¼Œè‡ªåŠ¨UIæ›´æ–°
3. **ä¸°å¯Œçš„åŠŸèƒ½**ï¼šæ”¯æŒå¤šç§è½¨é“ç±»å‹å’Œå¤æ‚çš„çŠ¶æ€ç®¡ç†
4. **æ˜“äºä½¿ç”¨**ï¼šç®€æ´çš„APIå’Œå®Œå–„çš„å·¥å…·å‡½æ•°
5. **é«˜æ€§èƒ½**ï¼šä¼˜åŒ–çš„å“åº”å¼è®¾è®¡å’Œæ‰¹é‡æ“ä½œæ”¯æŒ

è¿™ä¸ªè®¾è®¡ä¸é‡æ„æ–‡æ¡£ä¸­çš„ç»Ÿä¸€å¼‚æ­¥æºæ¶æ„å®Œå…¨ä¸€è‡´ï¼Œä¸ºè§†é¢‘ç¼–è¾‘å™¨æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„è½¨é“ç®¡ç†èƒ½åŠ›ã€‚
