# åª’ä½“ç±»å‹ç»Ÿä¸€è®¾è®¡ - ç±»å‹è®¾è®¡ï¼ˆå“åº”å¼é‡æ„ç‰ˆï¼‰

## æ¦‚è¿°

å½“å‰é¡¹ç›®ä¸­å­˜åœ¨ `LocalMediaItem` å’Œ `AsyncProcessingMediaItem` ä¸¤å¥—å¹¶è¡Œçš„åª’ä½“ç±»å‹ç³»ç»Ÿï¼Œå¯¼è‡´æ¶æ„å¤æ‚ã€ä»£ç é‡å¤ã€ç»´æŠ¤å›°éš¾ã€‚æœ¬æ–¹æ¡ˆåŸºäº"æ ¸å¿ƒæ•°æ®ä¸è¡Œä¸ºåˆ†ç¦»"çš„é‡æ„æ€è·¯ï¼Œæå‡º**ç»Ÿä¸€å¼‚æ­¥æº**çš„è®¾è®¡ï¼Œå°†"æœ¬åœ°"å’Œ"å¼‚æ­¥"ä»**ç±»å‹åŒºåˆ†**æ”¹ä¸º**çŠ¶æ€åŒºåˆ†**ï¼Œæ‰€æœ‰åª’ä½“é¡¹ç›®éƒ½ç»Ÿä¸€é‡‡ç”¨å“åº”å¼å¼‚æ­¥å¤„ç†æ¨¡å¼ã€‚

### æ ¸å¿ƒç†å¿µï¼šç»Ÿä¸€å¼‚æ­¥æº + å“åº”å¼æ¶æ„

**æ‰€æœ‰åª’ä½“é¡¹ç›®éƒ½æ˜¯å“åº”å¼å¼‚æ­¥æº**ï¼Œæ— è®ºæ˜¯ç”¨æˆ·é€‰æ‹©çš„æœ¬åœ°æ–‡ä»¶ã€å·¥ç¨‹åŠ è½½çš„æ–‡ä»¶è·¯å¾„ï¼Œè¿˜æ˜¯è¿œç¨‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œéƒ½é€šè¿‡ç»Ÿä¸€çš„å“åº”å¼å¼‚æ­¥çŠ¶æ€æœºè¿›è¡Œå¤„ç†ï¼š

- **æœ¬åœ°æ–‡ä»¶**ï¼šç¬é—´å®Œæˆè·å–é˜¶æ®µï¼Œä½†ä»èµ°å®Œæ•´çš„å¼‚æ­¥æµç¨‹
- **è¿œç¨‹æ–‡ä»¶**ï¼šæ­£å¸¸çš„å¼‚æ­¥ä¸‹è½½å’Œå¤„ç†æµç¨‹
- **å·¥ç¨‹æ–‡ä»¶**ï¼šæ£€æŸ¥å­˜åœ¨æ€§åèµ°å¼‚æ­¥æµç¨‹
- **äº‘ç›˜æ–‡ä»¶**ï¼šåŒæ­¥åèµ°å¼‚æ­¥æµç¨‹

è¿™ç§è®¾è®¡å½»åº•æ¶ˆé™¤äº†ç±»å‹å±‚é¢çš„å¤æ‚æ€§ï¼Œæä¾›äº†çœŸæ­£ç»Ÿä¸€çš„å“åº”å¼æ¶æ„ã€‚

## å½“å‰é—®é¢˜åˆ†æ

### 1. æ¦‚å¿µæ¨¡å‹æ··ä¹±
```typescript
// âŒ å½“å‰è®¾è®¡ï¼šä¸¤ç§ç±»å‹
LocalMediaItem vs AsyncProcessingMediaItem

// é—®é¢˜ï¼šæœ¬è´¨ä¸Šéƒ½æ˜¯"åª’ä½“é¡¹ç›®"ï¼Œä¸åº”è¯¥åœ¨ç±»å‹å±‚é¢åŒºåˆ†
```

### 2. æ¶æ„å¤æ‚åº¦è¿‡é«˜
- ä¸¤å¥—å¹¶è¡Œçš„ç±»å‹ç³»ç»Ÿ
- ä¸¤å¥—çŠ¶æ€ç®¡ç†API
- ä¸¤å¥—UIæ¸²æŸ“é€»è¾‘
- å¤æ‚çš„ç±»å‹å®ˆå«å’Œè½¬æ¢é€»è¾‘

### 3. Vue3å“åº”å¼é—®é¢˜
- ç±»å®ä¾‹å±æ€§çš„ä¿®æ”¹æ— æ³•è¢«Vue3å“åº”å¼ç³»ç»Ÿæ£€æµ‹
- ä¾èµ–å›è°ƒæœºåˆ¶æ‰‹åŠ¨è§¦å‘UIæ›´æ–°ï¼Œå®¹æ˜“é—æ¼ä¸”ä¸å¯é 
- ç»„ä»¶ä¸­æ— æ³•ç›´æ¥ä½¿ç”¨å“åº”å¼ç‰¹æ€§

## ç»Ÿä¸€è®¾è®¡æ–¹æ¡ˆ

### 1. æ ¸å¿ƒæ€è·¯ï¼šç»Ÿä¸€å¼‚æ­¥æº + å“åº”å¼æ¶æ„

**é‡æ–°ç†è§£"çŠ¶æ€"vs"ç±»å‹"**ï¼š
- "æœ¬åœ°"å’Œ"å¼‚æ­¥"æ˜¯**çŠ¶æ€**ï¼Œä¸æ˜¯**ç±»å‹**
- **æ‰€æœ‰åª’ä½“éƒ½æ˜¯å“åº”å¼å¼‚æ­¥æº**ï¼šç»Ÿä¸€ä¸ºä¸€ç§åª’ä½“ç±»å‹ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½èµ°å¼‚æ­¥å¤„ç†æµç¨‹
- **å·®å¼‚ä½“ç°åœ¨å¤„ç†é€Ÿåº¦**ï¼šæœ¬åœ°æ–‡ä»¶ç¬é—´å®Œæˆè·å–ï¼Œè¿œç¨‹æ–‡ä»¶éœ€è¦ä¸‹è½½æ—¶é—´
- **ç»Ÿä¸€çš„çŠ¶æ€è½¬æ¢**ï¼šæ‰€æœ‰åª’ä½“éƒ½ç»è¿‡ç›¸åŒçš„çŠ¶æ€è½¬æ¢è·¯å¾„
- **å“åº”å¼æ•°æ®ç»“æ„**ï¼šæ ¸å¿ƒæ•°æ® + è¡Œä¸ºå‡½æ•° + æŸ¥è¯¢å‡½æ•°

**ç»Ÿä¸€å¼‚æ­¥æº + å“åº”å¼çš„ä¼˜åŠ¿**ï¼š
- âœ… **æ¶æ„å®Œå…¨ç»Ÿä¸€**ï¼šæ¶ˆé™¤æ‰€æœ‰ç±»å‹å±‚é¢çš„åˆ†æ”¯é€»è¾‘
- âœ… **å®Œç¾å“åº”å¼æ”¯æŒ**ï¼šæ‰€æœ‰çŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘UIæ›´æ–°
- âœ… **ä»£ç é«˜åº¦å¤ç”¨**ï¼šä¸€å¥—ä»£ç å¤„ç†æ‰€æœ‰åª’ä½“ç±»å‹
- âœ… **æ‰©å±•æ€§æå¼º**ï¼šæ–°å¢æ•°æ®æºç±»å‹æ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘
- âœ… **UIé€»è¾‘ç»Ÿä¸€**ï¼šæ‰€æœ‰åª’ä½“ä½¿ç”¨ç›¸åŒçš„çŠ¶æ€æ˜¾ç¤ºç»„ä»¶
- âœ… **æµ‹è¯•ç®€åŒ–**ï¼šå•ä¸€æµç¨‹æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

### 2. åŒé‡çŠ¶æ€è®¾è®¡æ€è·¯

**æ ¸å¿ƒæ´å¯Ÿ**ï¼šæ•°æ®æºçŠ¶æ€å’Œåª’ä½“å¤„ç†çŠ¶æ€æ˜¯ä¸¤ä¸ªä¸åŒå±‚é¢çš„æ¦‚å¿µ
- **æ•°æ®æºçŠ¶æ€**ï¼šè´Ÿè´£"è·å–æ–‡ä»¶"ï¼ˆä¸‹è½½ã€åŒæ­¥ã€ä¼ è¾“ç­‰ï¼‰
- **åª’ä½“çŠ¶æ€**ï¼šè´Ÿè´£"å¤„ç†æ–‡ä»¶"ï¼ˆè§£æã€å°±ç»ªã€é”™è¯¯ç­‰ï¼‰

**å“åº”å¼è®¾è®¡ä¼˜åŠ¿**ï¼š
- èŒè´£åˆ†ç¦»æ¸…æ™°ï¼šæ•°æ®æºç®¡ç†è·å–é€»è¾‘ï¼Œåª’ä½“é¡¹ç›®ç®¡ç†å¤„ç†é€»è¾‘
- æ‰©å±•æ€§å¼ºï¼šæœªæ¥å¯æ”¯æŒäº‘ç›˜ã€FTPã€æ•°æ®åº“ç­‰å¤šç§æ•°æ®æº
- UIé€»è¾‘ç®€åŒ–ï¼šUIåªéœ€å…³å¿ƒæŠ½è±¡çš„åª’ä½“çŠ¶æ€
- å®Œç¾å“åº”å¼ï¼šæ‰€æœ‰çŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘UIæ›´æ–°

## çŠ¶æ€å®šä¹‰

### 1. åª’ä½“å¤„ç†çŠ¶æ€ï¼ˆæŠ½è±¡å±‚ï¼‰

```typescript
type MediaStatus =
  | 'pending'         // ç­‰å¾…å¼€å§‹å¤„ç†
  | 'asyncprocessing' // å¼‚æ­¥è·å–ä¸­ï¼ˆæŠ½è±¡çŠ¶æ€ï¼Œå¯¹åº”å„ç§æ•°æ®æºçš„è·å–é˜¶æ®µï¼‰
  | 'webavdecoding'   // WebAVè§£æä¸­
  | 'ready'           // å°±ç»ª
  | 'error'           // é”™è¯¯
  | 'cancelled'       // å–æ¶ˆ
  | 'missing'         // ç¼ºå¤±ï¼ˆåŠ è½½å·¥ç¨‹æ—¶æœ¬åœ°æ–‡ä»¶ä¸å­˜åœ¨ï¼‰
```

### 2. æ•°æ®æºçŠ¶æ€æ˜ å°„

æ•°æ®æºçš„å†…éƒ¨çŠ¶æ€ä¼šæ˜ å°„åˆ°åª’ä½“å¤„ç†çŠ¶æ€ï¼š

```typescript
// æ•°æ®æºçŠ¶æ€ â†’ åª’ä½“çŠ¶æ€æ˜ å°„
UnifiedDataSourceData.status â†’ UnifiedMediaItemData.mediaStatus
â”œâ”€â”€ 'pending'     â†’ 'pending'
â”œâ”€â”€ 'acquiring'   â†’ 'asyncprocessing' âœ… å…³é”®æ˜ å°„
â”œâ”€â”€ 'acquired'    â†’ 'webavdecoding' (å¼€å§‹è§£ææ–‡ä»¶)
â”œâ”€â”€ 'error'       â†’ 'error'
â””â”€â”€ 'cancelled'   â†’ 'cancelled'

// ğŸ”„ ç»Ÿä¸€å¼‚æ­¥æºï¼šæ‰€æœ‰æ–‡ä»¶éƒ½èµ°å¼‚æ­¥æµç¨‹
// æœ¬åœ°æ–‡ä»¶ï¼šç¬é—´å®Œæˆè·å–é˜¶æ®µ
UserSelectedFileSourceData â†’ 'acquiring'(ç¬é—´å®Œæˆ) â†’ 'acquired' â†’ 'webavdecoding'
// è¿œç¨‹æ–‡ä»¶ï¼šæ­£å¸¸å¼‚æ­¥è·å–
RemoteFileSourceData â†’ 'acquiring'(ä¸‹è½½è¿‡ç¨‹) â†’ 'acquired' â†’ 'webavdecoding'
```

> **æ³¨æ„**ï¼šå…·ä½“çš„æ•°æ®æºç±»å‹å®šä¹‰è¯·å‚è€ƒ [æ•°æ®æºç±»å‹è®¾è®¡æ–‡æ¡£](./01-æ•°æ®æºåŸºç¡€ç±»å‹è®¾è®¡.md)

## ç»Ÿä¸€åª’ä½“é¡¹ç›®æ•°æ®ç»“æ„

### 1. æ ¸å¿ƒæ•°æ®æ¥å£

```typescript
// å¯¼å…¥æ•°æ®æºç±»å‹å®šä¹‰
import type { UnifiedDataSourceData } from './01-æ•°æ®æºåŸºç¡€ç±»å‹è®¾è®¡'

/**
 * ç»Ÿä¸€çš„åª’ä½“é¡¹ç›®æ•°æ®æ¥å£ - çº¯å“åº”å¼çŠ¶æ€å¯¹è±¡
 */
export interface UnifiedMediaItemData {
  // ==================== æ ¸å¿ƒå±æ€§ ====================
  readonly id: string
  name: string
  createdAt: string

  // ==================== çŠ¶æ€ä¿¡æ¯ ====================
  mediaStatus: MediaStatus
  mediaType: MediaType | 'unknown'

  // ==================== æ•°æ®æºï¼ˆåŒ…å«è·å–çŠ¶æ€ï¼‰ ====================
  source: UnifiedDataSourceData // ä½¿ç”¨ç»Ÿä¸€çš„å“åº”å¼æ•°æ®æº

  // ==================== WebAVå¯¹è±¡ï¼ˆçŠ¶æ€ç›¸å…³ï¼‰ ====================
  webav?: WebAVObjects

  // ==================== å…ƒæ•°æ®ï¼ˆçŠ¶æ€ç›¸å…³ï¼‰ ====================
  duration?: number // åª’ä½“æ—¶é•¿ï¼ˆå¸§æ•°ï¼‰ï¼Œå¯èƒ½åœ¨ä¸åŒé˜¶æ®µè·å¾—ï¼šæœåŠ¡å™¨æä¾›ã€ç”¨æˆ·è¾“å…¥ã€WebAVè§£æç­‰
}

/**
 * WebAVå¯¹è±¡æ¥å£
 */
interface WebAVObjects {
  mp4Clip?: Raw<MP4Clip>
  imgClip?: Raw<ImgClip>
  audioClip?: Raw<AudioClip>
  thumbnailUrl?: string
  // WebAVè§£æå¾—åˆ°çš„åŸå§‹å°ºå¯¸ä¿¡æ¯
  originalWidth?: number  // åŸå§‹å®½åº¦ï¼ˆè§†é¢‘å’Œå›¾ç‰‡ï¼‰
  originalHeight?: number // åŸå§‹é«˜åº¦ï¼ˆè§†é¢‘å’Œå›¾ç‰‡ï¼‰
}

/**
 * å·¥å‚å‡½æ•° - åˆ›å»ºå“åº”å¼åª’ä½“é¡¹ç›®æ•°æ®
 */
export function createUnifiedMediaItemData(
  id: string,
  name: string,
  source: UnifiedDataSourceData,
  options?: Partial<UnifiedMediaItemData>
): UnifiedMediaItemData {
  return reactive({
    id,
    name,
    createdAt: new Date().toISOString(),
    mediaStatus: 'pending' as MediaStatus,
    mediaType: 'unknown' as MediaType | 'unknown',
    source,
    ...options
  })
}
```

### 2. è¡Œä¸ºå‡½æ•°æ¨¡å—

```typescript
/**
 * ç»Ÿä¸€åª’ä½“é¡¹ç›®è¡Œä¸ºå‡½æ•° - æ— çŠ¶æ€æ“ä½œå‡½æ•°
 */
export const UnifiedMediaItemActions = {
  // çŠ¶æ€è½¬æ¢
  transitionTo(
    item: UnifiedMediaItemData,
    newStatus: MediaStatus,
    context?: MediaTransitionContext
  ): boolean {
    if (!UnifiedMediaItemQueries.canTransitionTo(item, newStatus)) {
      console.warn(`æ— æ•ˆçŠ¶æ€è½¬æ¢: ${item.mediaStatus} â†’ ${newStatus}`)
      return false
    }

    const oldStatus = item.mediaStatus
    item.mediaStatus = newStatus

    // è§¦å‘å…¨å±€äº‹ä»¶ï¼ˆæ›¿ä»£å›è°ƒæœºåˆ¶ï¼‰
    UnifiedMediaItemEvents.emit('statusChanged', {
      item,
      oldStatus,
      newStatus,
      context
    })

    return true
  },

  // å¼€å§‹WebAVå¤„ç†
  async startWebAVProcessing(item: UnifiedMediaItemData): Promise<void> {
    if (!UnifiedMediaItemActions.transitionTo(item, 'webavdecoding')) return

    try {
      // WebAVå¤„ç†é€»è¾‘...
      const webavObjects = await processWithWebAV(item.source)
      item.webav = webavObjects
      item.duration = webavObjects.duration

      UnifiedMediaItemActions.transitionTo(item, 'ready')
    } catch (error) {
      UnifiedMediaItemActions.transitionTo(item, 'error', {
        type: 'error',
        errorMessage: error.message,
        errorCode: 'WEBAV_ERROR'
      })
    }
  },

  // å–æ¶ˆå¤„ç†
  cancel(item: UnifiedMediaItemData): void {
    if (UnifiedMediaItemQueries.isProcessing(item)) {
      // å–æ¶ˆæ•°æ®æºä»»åŠ¡
      if (item.source && DataSourceQueries.canCancel(item.source)) {
        UnifiedDataSourceActions.cancel(item.source)
      }
      UnifiedMediaItemActions.transitionTo(item, 'cancelled')
    }
  },

  // é‡è¯•å¤„ç†
  retry(item: UnifiedMediaItemData): void {
    if (UnifiedMediaItemQueries.canRetry(item)) {
      UnifiedMediaItemActions.transitionTo(item, 'pending')
      // é‡æ–°å¼€å§‹å¤„ç†æµç¨‹...
    }
  }
}
```

### 3. æŸ¥è¯¢å‡½æ•°æ¨¡å—

```typescript
/**
 * ç»Ÿä¸€åª’ä½“é¡¹ç›®æŸ¥è¯¢å‡½æ•° - æ— çŠ¶æ€æŸ¥è¯¢å‡½æ•°
 */
export const UnifiedMediaItemQueries = {
  // çŠ¶æ€æ£€æŸ¥
  isPending(item: UnifiedMediaItemData): boolean {
    return item.mediaStatus === 'pending'
  },

  isReady(item: UnifiedMediaItemData): boolean {
    return item.mediaStatus === 'ready'
  },

  isProcessing(item: UnifiedMediaItemData): boolean {
    return item.mediaStatus === 'asyncprocessing' ||
           item.mediaStatus === 'webavdecoding'
  },

  hasError(item: UnifiedMediaItemData): boolean {
    return item.mediaStatus === 'error'
  },

  hasAnyError(item: UnifiedMediaItemData): boolean {
    return item.mediaStatus === 'error' ||
           item.mediaStatus === 'cancelled' ||
           item.mediaStatus === 'missing'
  },

  isParsing(item: UnifiedMediaItemData): boolean {
    return UnifiedMediaItemQueries.isPending(item) ||
           UnifiedMediaItemQueries.isProcessing(item)
  },

  // çŠ¶æ€è½¬æ¢éªŒè¯
  canTransitionTo(item: UnifiedMediaItemData, newStatus: MediaStatus): boolean {
    const validTransitions: Record<MediaStatus, MediaStatus[]> = {
      pending: ['asyncprocessing', 'error', 'cancelled'],
      asyncprocessing: ['webavdecoding', 'error', 'cancelled'],
      webavdecoding: ['ready', 'error', 'cancelled'],
      ready: ['error'],
      error: ['pending', 'cancelled'],
      cancelled: ['pending'],
      missing: ['pending', 'cancelled'],
    }

    return validTransitions[item.mediaStatus]?.includes(newStatus) || false
  },

  // ä¸šåŠ¡æŸ¥è¯¢
  canRetry(item: UnifiedMediaItemData): boolean {
    return item.mediaStatus === 'error' ||
           item.mediaStatus === 'cancelled' ||
           item.mediaStatus === 'missing'
  },

  getProgress(item: UnifiedMediaItemData): number | undefined {
    return DataSourceQueries.getProgress(item.source)
  },

  getError(item: UnifiedMediaItemData): string | undefined {
    return DataSourceQueries.getError(item.source)
  },

  getUrl(item: UnifiedMediaItemData): string | undefined {
    return DataSourceQueries.getUrl(item.source)
  },

  getDuration(item: UnifiedMediaItemData): number | undefined {
    return item.duration
  },

  getOriginalSize(item: UnifiedMediaItemData): { width: number; height: number } | undefined {
    const width = item.webav?.originalWidth
    const height = item.webav?.originalHeight
    return (width !== undefined && height !== undefined) ? { width, height } : undefined
  }
}
```

## è®¾è®¡ç†å¿µ

### 1. å“åº”å¼ä¼˜å…ˆåŸåˆ™

UnifiedMediaItemDataé‡‡ç”¨**çº¯æ•°æ®å®¹å™¨**å’Œ**æ— çŠ¶æ€å‡½æ•°**çš„è®¾è®¡ç†å¿µï¼š

- **å®Œç¾å“åº”å¼**ï¼šæ‰€æœ‰çŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘UIæ›´æ–°
- **è‡ªåŠ¨åŒ–å¤„ç†**ï¼šåˆ›å»ºåè‡ªåŠ¨å¼€å§‹å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•
- **çŠ¶æ€æœºä¿æŠ¤**ï¼šé€šè¿‡æŸ¥è¯¢å‡½æ•°éªŒè¯çŠ¶æ€è½¬æ¢çš„åˆæ³•æ€§
- **å‡½æ•°å¼è®¾è®¡**ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— çŠ¶æ€çš„çº¯å‡½æ•°
- **åªè¯»ä¸ºä¸»**ï¼šå¤§éƒ¨åˆ†å‡½æ•°æ˜¯çŠ¶æ€æŸ¥è¯¢ï¼Œè€ŒéçŠ¶æ€ä¿®æ”¹

### 2. ä¿ç•™çš„æ ¸å¿ƒåŠŸèƒ½

#### è¡Œä¸ºå‡½æ•°
- **transitionTo()**ï¼šçŠ¶æ€è½¬æ¢çš„æ ¸å¿ƒæ–¹æ³•
- **cancel()**ï¼šç”¨æˆ·å¯èƒ½éœ€è¦å–æ¶ˆæ­£åœ¨å¤„ç†çš„åª’ä½“
- **retry()**ï¼šé”™è¯¯çŠ¶æ€ä¸‹çš„é‡æ–°å°è¯•

#### æŸ¥è¯¢å‡½æ•°
- **çŠ¶æ€æŸ¥è¯¢**ï¼š`isReady()`, `isProcessing()`, `hasError()` ç­‰
- **ä¿¡æ¯è·å–**ï¼š`getUrl()`, `getDuration()`, `getProgress()` ç­‰

### 3. ç§»é™¤çš„æ“ä½œæ–¹æ³•

ä»¥ä¸‹æ–¹æ³•åœ¨å“åº”å¼æ¶æ„ä¸‹ä¸å†éœ€è¦ï¼š

```typescript
// âŒ å·²ç§»é™¤çš„æ–¹æ³•
startProcessing()     // åˆ›å»ºæ—¶è‡ªåŠ¨å¼€å§‹
pause() / resume()    // ç”±ç®¡ç†å™¨æ§åˆ¶
setStatus()          // çŠ¶æ€ç”±è¡Œä¸ºå‡½æ•°ç®¡ç†
forceTransition()    // è¿åçŠ¶æ€æœºåŸåˆ™
onStatusChanged()    // ä½¿ç”¨å“åº”å¼ç›‘å¬æ›¿ä»£
```

## è½¬æ¢ä¸Šä¸‹æ–‡è®¾è®¡

è½¬æ¢ä¸Šä¸‹æ–‡ï¼ˆMediaTransitionContextï¼‰æ˜¯çŠ¶æ€è½¬æ¢æ—¶ä¼ é€’é™„åŠ ä¿¡æ¯çš„æœºåˆ¶ï¼Œè®©çŠ¶æ€æœºèƒ½å¤Ÿåœ¨ä¿æŒç®€æ´çš„åŒæ—¶æ”¯æŒå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ã€‚

### 1. åŸºç¡€ä¸Šä¸‹æ–‡ç»“æ„

```typescript
// åŸºç¡€ä¸Šä¸‹æ–‡ - æ‰€æœ‰è½¬æ¢éƒ½åŒ…å«çš„é€šç”¨ä¿¡æ¯
interface BaseMediaTransitionContext {
  timestamp: number         // è½¬æ¢æ—¶é—´æˆ³
  source: string           // è§¦å‘è½¬æ¢çš„æ¥æº
  reason: string           // è½¬æ¢åŸå› 
  metadata?: Record<string, any> // å…¶ä»–å…ƒæ•°æ®
}
```

### 2. å…·ä½“ä¸Šä¸‹æ–‡ç±»å‹

```typescript
// å¼€å§‹å¼‚æ­¥å¤„ç†çš„ä¸Šä¸‹æ–‡
interface AsyncProcessingContext extends BaseMediaTransitionContext {
  type: 'async_processing'
  initialProgress?: number  // åˆå§‹è¿›åº¦
  estimatedDuration?: number // é¢„ä¼°æ€»è€—æ—¶
}

// WebAVè§£æå®Œæˆä¸Šä¸‹æ–‡
interface ParseCompletedContext extends BaseMediaTransitionContext {
  type: 'parse_completed'
  parsedMetadata: {         // è§£æå¾—åˆ°çš„å…ƒæ•°æ®
    duration: number
    resolution?: string
    format: string
    bitrate?: number
    codecInfo?: {
      video?: string
      audio?: string
    }
  }
  thumbnailGenerated: boolean // æ˜¯å¦ç”Ÿæˆäº†ç¼©ç•¥å›¾
  webavObjects: WebAVObjects  // WebAVè§£æç»“æœ
  parseTime: number          // è§£æè€—æ—¶(ms)
}

// é”™è¯¯è½¬æ¢ä¸Šä¸‹æ–‡
interface ErrorContext extends BaseMediaTransitionContext {
  type: 'error'
  errorMessage: string      // é”™è¯¯æè¿°
  errorCode: string         // é”™è¯¯ä»£ç 
  errorDetails?: any        // è¯¦ç»†é”™è¯¯ä¿¡æ¯
  retryable: boolean        // æ˜¯å¦å¯é‡è¯•
  retryCount?: number       // é‡è¯•æ¬¡æ•°
  lastAttemptTime?: number  // ä¸Šæ¬¡å°è¯•æ—¶é—´
}

// å–æ¶ˆè½¬æ¢ä¸Šä¸‹æ–‡
interface CancelledContext extends BaseMediaTransitionContext {
  type: 'cancelled'
  cancelReason: string      // å–æ¶ˆåŸå› 
  partialProgress?: number  // å–æ¶ˆæ—¶çš„è¿›åº¦
  canResume?: boolean       // æ˜¯å¦å¯æ¢å¤
}

// é‡è¯•è½¬æ¢ä¸Šä¸‹æ–‡
interface RetryContext extends BaseMediaTransitionContext {
  type: 'retry'
  retryCount: number        // é‡è¯•æ¬¡æ•°
  previousError?: string    // ä¸Šæ¬¡é”™è¯¯ä¿¡æ¯
  retryDelay?: number       // é‡è¯•å»¶è¿Ÿ(ms)
}

// æ–‡ä»¶ç¼ºå¤±ä¸Šä¸‹æ–‡
interface MissingContext extends BaseMediaTransitionContext {
  type: 'missing'
  originalPath?: string     // åŸå§‹æ–‡ä»¶è·¯å¾„
  lastModified?: number     // æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´
  expectedSize?: number     // é¢„æœŸæ–‡ä»¶å¤§å°
}

// è”åˆç±»å‹å®šä¹‰
type MediaTransitionContext =
  | AsyncProcessingContext
  | ParseCompletedContext
  | ErrorContext
  | CancelledContext
  | RetryContext
  | MissingContext
```

### 3. è”åˆç±»å‹è®¾è®¡ä¼˜åŠ¿

1. **ç±»å‹å®‰å…¨**
   - æ¯ç§è½¬æ¢åœºæ™¯éƒ½æœ‰æ˜ç¡®çš„ä¸Šä¸‹æ–‡ç»“æ„
   - TypeScript å¯ä»¥æä¾›ç²¾ç¡®çš„ç±»å‹æ£€æŸ¥å’Œä»£ç æç¤º
   - é¿å…ä¼ é€’ä¸ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

2. **è¯­ä¹‰æ¸…æ™°**
   - é€šè¿‡ `type` å­—æ®µæ˜ç¡®æ ‡è¯†ä¸Šä¸‹æ–‡ç±»å‹
   - ä¸åŒåœºæ™¯çš„ä¸Šä¸‹æ–‡å­—æ®µæœ‰æ˜ç¡®çš„ä¸šåŠ¡å«ä¹‰
   - ä¾¿äºç†è§£å’Œç»´æŠ¤

3. **æ‰©å±•æ€§å¼º**
   - æ–°å¢è½¬æ¢åœºæ™¯æ—¶åªéœ€æ·»åŠ æ–°çš„ä¸Šä¸‹æ–‡ç±»å‹
   - ä¸å½±å“ç°æœ‰çš„ä¸Šä¸‹æ–‡ç»“æ„
   - æ”¯æŒæ¸è¿›å¼åŠŸèƒ½å¢å¼º

4. **å¯è°ƒè¯•æ€§å¥½**
   - æ¯ä¸ªä¸Šä¸‹æ–‡éƒ½åŒ…å«å®Œæ•´çš„è½¬æ¢ä¿¡æ¯
   - ä¾¿äºæ—¥å¿—è®°å½•å’Œé—®é¢˜æ’æŸ¥
   - æ”¯æŒè¯¦ç»†çš„çŠ¶æ€è½¬æ¢è¿½è¸ª

## çŠ¶æ€è½¬æ¢è§„åˆ™

```typescript
/**
 * åˆæ³•çš„çŠ¶æ€è½¬æ¢æ˜ å°„è¡¨
 */
const VALID_MEDIA_TRANSITIONS: Record<MediaStatus, MediaStatus[]> = {
  'pending': ['asyncprocessing', 'webavdecoding', 'error', 'missing'],
  'asyncprocessing': ['webavdecoding', 'error', 'cancelled'],
  'webavdecoding': ['ready', 'error'],
  'ready': ['error'], // è¿è¡Œæ—¶å¯èƒ½å‡ºé”™
  'error': ['pending'], // æ”¯æŒé‡è¯•
  'cancelled': ['pending'], // æ”¯æŒé‡æ–°å¼€å§‹
  'missing': ['pending', 'error'] // é‡æ–°é€‰æ‹©æ–‡ä»¶æˆ–ç¡®è®¤é”™è¯¯
}

/**
 * çŠ¶æ€è½¬æ¢å®ç°ï¼ˆåœ¨æŸ¥è¯¢å‡½æ•°ä¸­ï¼‰
 */
export const UnifiedMediaItemQueries = {
  // ... å…¶ä»–æŸ¥è¯¢å‡½æ•°

  canTransitionTo(item: UnifiedMediaItemData, newStatus: MediaStatus): boolean {
    return VALID_MEDIA_TRANSITIONS[item.mediaStatus]?.includes(newStatus) ?? false
  }
}

/**
 * çŠ¶æ€è½¬æ¢å®ç°ï¼ˆåœ¨è¡Œä¸ºå‡½æ•°ä¸­ï¼‰
 */
export const UnifiedMediaItemActions = {
  // ... å…¶ä»–è¡Œä¸ºå‡½æ•°

  transitionTo(
    item: UnifiedMediaItemData,
    newStatus: MediaStatus,
    context?: MediaTransitionContext
  ): boolean {
    if (!UnifiedMediaItemQueries.canTransitionTo(item, newStatus)) {
      console.warn(`æ— æ•ˆçŠ¶æ€è½¬æ¢: ${item.mediaStatus} â†’ ${newStatus}`)
      return false
    }

    const oldStatus = item.mediaStatus
    item.mediaStatus = newStatus

    // è§¦å‘å…¨å±€äº‹ä»¶ï¼ˆæ›¿ä»£å›è°ƒæœºåˆ¶ï¼‰
    UnifiedMediaItemEvents.emit('statusChanged', {
      item,
      oldStatus,
      newStatus,
      context
    })

    return true
  }
}
```

## å„çŠ¶æ€å­—æ®µçº¦æŸ

### 1. pendingçŠ¶æ€
```typescript
{
  id: string âœ…
  name: string âœ…
  mediaType: 'unknown' âœ… // è¿˜æœªæ£€æµ‹
  source: UnifiedDataSourceData âœ… // ä»»ä½•å“åº”å¼æ•°æ®æºç±»å‹
  source.status: 'pending' âœ…
  webav: undefined âŒ
  duration: undefined | number // å¯èƒ½æœ‰ç”¨æˆ·é¢„è¾“å…¥çš„é¢„æœŸæ—¶é•¿
}
```

### 2. asyncprocessingçŠ¶æ€ï¼ˆç»Ÿä¸€å¼‚æ­¥æº - æ‰€æœ‰æ•°æ®æºéƒ½ç»è¿‡æ­¤çŠ¶æ€ï¼‰
```typescript
{
  id: string âœ…
  name: string âœ…
  mediaType: 'unknown' âœ… // ä»æœªæ£€æµ‹åˆ°å®é™…ç±»å‹
  source: UnifiedDataSourceData âœ… // æ•°æ®æºæ­£åœ¨è·å–ä¸­
  source.status: 'acquiring' âœ…
  source.progress: 0-99 âœ…
  webav: undefined âŒ
  duration: undefined | number // å¯èƒ½æœ‰æœåŠ¡å™¨æä¾›çš„æ—¶é•¿æˆ–ç”¨æˆ·é¢„è¾“å…¥çš„æ—¶é•¿
}
```

### 3. webavdecodingçŠ¶æ€
```typescript
{
  id: string âœ…
  name: string âœ…
  mediaType: 'unknown' âœ… // æ­£åœ¨æ£€æµ‹ä¸­
  source: UnifiedDataSourceData âœ… // æ•°æ®æºå·²è·å–å®Œæˆ
  source.status: 'acquired' âœ…
  webav: undefined âŒ // æˆ–éƒ¨åˆ†åˆ›å»º
  duration: undefined | number // å¯èƒ½æœ‰æœåŠ¡å™¨/ç”¨æˆ·æä¾›çš„æ—¶é•¿ï¼ŒWebAVè§£æä¼šç¡®è®¤æˆ–æ›´æ–°
}
```

### 4. readyçŠ¶æ€
```typescript
{
  id: string âœ…
  name: string âœ…
  mediaType: MediaType âœ… // å·²æ£€æµ‹åˆ°ç¡®åˆ‡ç±»å‹
  source: UnifiedDataSourceData âœ… // æ•°æ®æºå·²è·å–å®Œæˆ
  source.status: 'acquired' âœ…
  webav: {
    mp4Clip?: Raw<MP4Clip> âœ… // æ ¹æ®ç±»å‹
    imgClip?: Raw<ImgClip> âœ…
    audioClip?: Raw<AudioClip> âœ…
    thumbnailUrl?: string âœ…
    originalWidth?: number âœ…  // WebAVè§£æçš„åŸå§‹å®½åº¦
    originalHeight?: number âœ… // WebAVè§£æçš„åŸå§‹é«˜åº¦
  }
  duration: number âœ… // WebAVè§£æç¡®è®¤çš„æœ€ç»ˆå‡†ç¡®å€¼
}
```

### 5. error/cancelledçŠ¶æ€
```typescript
{
  id: string âœ…
  name: string âœ…
  mediaType: 'unknown' | MediaType âœ… // å¯èƒ½å·²æ£€æµ‹æˆ–æœªæ£€æµ‹
  source: UnifiedDataSourceData âœ…
  source.status: 'error' | 'cancelled' âœ…
  source.errorMessage: string âœ… // é”™è¯¯ä¿¡æ¯
  webav: undefined âŒ
  duration: undefined | number // å¯èƒ½æœ‰æœåŠ¡å™¨/ç”¨æˆ·æä¾›çš„é¢„ä¼°å€¼ï¼Œä¿ç•™ç”¨äºé‡è¯•
}
```

### 6. missingçŠ¶æ€ï¼ˆé¡¹ç›®åŠ è½½æ—¶ï¼‰
```typescript
{
  id: string âœ…
  name: string âœ…
  mediaType: MediaType âœ… // ä»é¡¹ç›®é…ç½®ä¸­å·²çŸ¥
  source: UnifiedDataSourceData âœ… // æ•°æ®æºå¯èƒ½æ— æ•ˆ
  webav: undefined âŒ
  duration: number âœ… // ä»é¡¹ç›®é…ç½®æ¢å¤
}
```

## çŠ¶æ€æœºè®¾è®¡åŸåˆ™

### å“åº”å¼æ•°æ®æµç®¡ç†

æ‰€æœ‰çŠ¶æ€å˜æ›´å’Œæ•°æ®è®¾ç½®éƒ½å¿…é¡»é€šè¿‡è¡Œä¸ºå‡½æ•°è¿›è¡Œï¼Œç¡®ä¿ï¼š

1. **å®Œæ•´çš„çŠ¶æ€è¿½è¸ª**ï¼šæ¯æ¬¡å˜æ›´éƒ½æœ‰å®Œæ•´çš„è½¬æ¢ä¸Šä¸‹æ–‡è®°å½•
2. **ç±»å‹å®‰å…¨**ï¼šåˆ©ç”¨ TypeScript çš„è”åˆç±»å‹ç¡®ä¿ä¸Šä¸‹æ–‡ç±»å‹å®‰å…¨
3. **å“åº”å¼æ›´æ–°**ï¼šæ‰€æœ‰çŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘UIæ›´æ–°
4. **å¯è¿½æº¯æ€§**ï¼šé€šè¿‡äº‹ä»¶ç³»ç»Ÿå¯ä»¥å®Œæ•´è¿½è¸ªæ‰€æœ‰çŠ¶æ€å˜æ›´

### å·²ç§»é™¤çš„æ–¹æ³•

ä»¥ä¸‹æ–¹æ³•å·²ä»è®¾è®¡ä¸­ç§»é™¤ï¼Œæ”¹ä¸ºé€šè¿‡å“åº”å¼æ•°æ®å’Œè¡Œä¸ºå‡½æ•°å¤„ç†ï¼š

- ~~`setUserDuration(duration, description)`~~ â†’ ç›´æ¥ä¿®æ”¹ `item.duration`
- ~~`setServerMetadata(metadata)`~~ â†’ é€šè¿‡è½¬æ¢ä¸Šä¸‹æ–‡ä¼ é€’
- ~~`onStatusChanged(callback)`~~ â†’ ä½¿ç”¨Vueçš„ `watch` æˆ– `watchEffect`

### æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼

```typescript
// âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼ˆå·²ç§»é™¤ï¼‰
// mediaItem.setUserDuration(1800, "ç”¨æˆ·é¢„ä¼°")
// mediaItem.setServerMetadata({ duration: 3600 })

// âœ… æ­£ç¡®ï¼šé€šè¿‡è¡Œä¸ºå‡½æ•°å’Œå“åº”å¼æ•°æ®
// 1. ç›´æ¥ä¿®æ”¹å“åº”å¼æ•°æ®
item.duration = 1800

// 2. é€šè¿‡è¡Œä¸ºå‡½æ•°è¿›è¡ŒçŠ¶æ€è½¬æ¢
UnifiedMediaItemActions.transitionTo(item, 'ready', {
  type: 'parse_completed',
  timestamp: Date.now(),
  source: 'webav',
  reason: 'WebAV parsing completed',
  parsedMetadata: {
    duration: 3600,
    format: 'mp4'
  }
})

// 3. ä½¿ç”¨Vueå“åº”å¼ç›‘å¬çŠ¶æ€å˜åŒ–
watch(
  () => item.mediaStatus,
  (newStatus, oldStatus) => {
    console.log(`çŠ¶æ€å˜åŒ–: ${oldStatus} â†’ ${newStatus}`)
  }
)
```

## Durationå¤šæ¥æºè®¾è®¡

### Durationçš„è·å–æ—¶æœºå’Œæ¥æº

åª’ä½“é¡¹ç›®çš„durationå­—æ®µé‡‡ç”¨**å¤šæ¥æºã€æ¸è¿›å¼ç²¾ç¡®**çš„å“åº”å¼è®¾è®¡ï¼Œå¯ä»¥åœ¨ä¸åŒé˜¶æ®µä»ä¸åŒæ¥æºè·å¾—ï¼š

#### 1. ç”¨æˆ·é¢„è¾“å…¥ï¼ˆpending/asyncprocessingé˜¶æ®µï¼‰
```typescript
// ç”¨æˆ·åœ¨æ·»åŠ è¿œç¨‹æ–‡ä»¶æ—¶é¢„å…ˆè¾“å…¥é¢„æœŸæ—¶é•¿
// ç›´æ¥ä¿®æ”¹å“åº”å¼æ•°æ®
item.duration = 1800 // 1800å¸§ = 30ç§’@60fps

// å¯é€‰ï¼šè®°å½•æ¥æºä¿¡æ¯
UnifiedMediaItemActions.transitionTo(item, item.mediaStatus, {
  type: 'async_processing',
  timestamp: Date.now(),
  source: 'user',
  reason: 'User provided duration estimate'
})
```

#### 2. æœåŠ¡å™¨å…ƒæ•°æ®ï¼ˆasyncprocessingé˜¶æ®µï¼‰
```typescript
// è¿œç¨‹ä¸‹è½½æ—¶ï¼ŒæœåŠ¡å™¨HTTPå¤´æˆ–APIå“åº”æä¾›çš„å…ƒæ•°æ®
// ç›´æ¥æ›´æ–°å“åº”å¼æ•°æ®
item.duration = 3600 // æœåŠ¡å™¨æä¾›çš„æ—¶é•¿

// è®°å½•è½¬æ¢ä¸Šä¸‹æ–‡
UnifiedMediaItemActions.transitionTo(item, 'asyncprocessing', {
  type: 'async_processing',
  timestamp: Date.now(),
  source: 'server',
  reason: 'Server provided metadata'
})
```

#### 3. WebAVè§£æï¼ˆreadyé˜¶æ®µï¼‰
```typescript
// WebAVè§£ææ–‡ä»¶åå¾—åˆ°çš„ç²¾ç¡®æ—¶é•¿
// é€šè¿‡è¡Œä¸ºå‡½æ•°æ›´æ–°
UnifiedMediaItemActions.transitionTo(item, 'ready', {
  type: 'parse_completed',
  timestamp: Date.now(),
  source: 'webav',
  reason: 'WebAV parsing completed',
  parsedMetadata: {
    duration: 3598, // WebAVè§£æçš„ç²¾ç¡®æ—¶é•¿
    format: 'mp4'
  }
})

// åœ¨è¡Œä¸ºå‡½æ•°å†…éƒ¨ä¼šæ›´æ–° item.duration = context.parsedMetadata.duration
```

### Durationä¼˜å…ˆçº§å’Œæ›´æ–°ç­–ç•¥

1. **åˆå§‹å€¼**ï¼šç”¨æˆ·é¢„è¾“å…¥ > undefined
2. **å¼‚æ­¥å¤„ç†é˜¶æ®µ**ï¼šæœåŠ¡å™¨æä¾› > ç”¨æˆ·é¢„è¾“å…¥ > undefined
3. **æœ€ç»ˆå€¼**ï¼šWebAVè§£æ > æœåŠ¡å™¨æä¾› > ç”¨æˆ·é¢„è¾“å…¥

### å“åº”å¼ç›‘å¬ç¤ºä¾‹

```vue
<template>
  <div>
    <!-- âœ… å“åº”å¼æ˜¾ç¤ºæ—¶é•¿ -->
    <p v-if="item.duration">æ—¶é•¿: {{ formatDuration(item.duration) }}</p>
    <p v-else>æ—¶é•¿æœªçŸ¥</p>
  </div>
</template>

<script setup>
// âœ… è‡ªåŠ¨å“åº”æ—¶é•¿å˜åŒ–
watch(
  () => item.duration,
  (newDuration, oldDuration) => {
    if (newDuration !== oldDuration) {
      console.log(`æ—¶é•¿æ›´æ–°: ${oldDuration} â†’ ${newDuration}`)
    }
  }
)
</script>
```

### ä½¿ç”¨åœºæ™¯

- **è¿œç¨‹ä¸‹è½½**ï¼šç”¨æˆ·é¢„è¾“å…¥ â†’ æœåŠ¡å™¨ç¡®è®¤ â†’ WebAVç²¾ç¡®è§£æ
- **æœ¬åœ°æ–‡ä»¶**ï¼šundefined â†’ WebAVè§£æï¼ˆç¬é—´å®Œæˆï¼‰
- **é¡¹ç›®åŠ è½½**ï¼šé¡¹ç›®é…ç½®æ¢å¤ â†’ WebAVé‡æ–°éªŒè¯
- **æ–‡æœ¬åª’ä½“**ï¼šç”¨æˆ·è®¾ç½® â†’ ç›´æ¥å°±ç»ª

## åŸå§‹å°ºå¯¸ä¿¡æ¯è®¾è®¡

### å°ºå¯¸ä¿¡æ¯çš„è·å–æ—¶æœºå’Œæ¥æº

åª’ä½“é¡¹ç›®çš„åŸå§‹å°ºå¯¸ä¿¡æ¯ï¼ˆoriginalWidth/originalHeightï¼‰é‡‡ç”¨**å¤šæ¥æºã€æ¸è¿›å¼ç²¾ç¡®**çš„å“åº”å¼è®¾è®¡ï¼š

#### 1. æœåŠ¡å™¨æä¾›ï¼ˆasyncprocessingé˜¶æ®µï¼‰
```typescript
// è¿œç¨‹ä¸‹è½½æ—¶ï¼ŒæœåŠ¡å™¨APIå“åº”æä¾›çš„å°ºå¯¸ä¿¡æ¯
// ç›´æ¥æ›´æ–°å“åº”å¼æ•°æ®
if (!item.webav) {
  item.webav = {}
}
item.webav.originalWidth = 1920
item.webav.originalHeight = 1080

// è®°å½•è½¬æ¢ä¸Šä¸‹æ–‡
UnifiedMediaItemActions.transitionTo(item, 'asyncprocessing', {
  type: 'async_processing',
  timestamp: Date.now(),
  source: 'server',
  reason: 'Server provided metadata'
})
```

#### 2. WebAVè§£æï¼ˆreadyé˜¶æ®µï¼‰
```typescript
// WebAVè§£ææ–‡ä»¶åå¾—åˆ°çš„ç²¾ç¡®å°ºå¯¸
UnifiedMediaItemActions.transitionTo(item, 'ready', {
  type: 'parse_completed',
  timestamp: Date.now(),
  source: 'webav',
  reason: 'WebAV parsing completed',
  parsedMetadata: {
    originalWidth: 1920,  // WebAVè§£æçš„ç²¾ç¡®å®½åº¦
    originalHeight: 1080, // WebAVè§£æçš„ç²¾ç¡®é«˜åº¦
    duration: 3598,
    format: 'mp4'
  }
})

// åœ¨è¡Œä¸ºå‡½æ•°å†…éƒ¨ä¼šæ›´æ–° item.webav.originalWidth/originalHeight
```

### å°ºå¯¸ä¿¡æ¯çš„ä½¿ç”¨æ–¹æ³•

```typescript
// ä½¿ç”¨æŸ¥è¯¢å‡½æ•°è·å–å°ºå¯¸ä¿¡æ¯
const size = UnifiedMediaItemQueries.getOriginalSize(item) // { width: number; height: number } | undefined

// åœ¨Vueç»„ä»¶ä¸­å“åº”å¼ä½¿ç”¨
const hasSize = computed(() => {
  return item.webav?.originalWidth !== undefined &&
         item.webav?.originalHeight !== undefined
})
```

### Vueç»„ä»¶ä¸­çš„å“åº”å¼ä½¿ç”¨

```vue
<template>
  <div>
    <!-- âœ… å“åº”å¼æ˜¾ç¤ºå°ºå¯¸ä¿¡æ¯ -->
    <div v-if="originalSize" class="size-info">
      å°ºå¯¸: {{ originalSize.width }} x {{ originalSize.height }}
    </div>
    <div v-else class="no-size">
      å°ºå¯¸ä¿¡æ¯æœªçŸ¥
    </div>
  </div>
</template>

<script setup>
// âœ… å“åº”å¼è®¡ç®—å±æ€§
const originalSize = computed(() =>
  UnifiedMediaItemQueries.getOriginalSize(item)
)

// âœ… ç›‘å¬å°ºå¯¸å˜åŒ–
watch(originalSize, (newSize, oldSize) => {
  if (newSize && !oldSize) {
    console.log(`è·å¾—å°ºå¯¸ä¿¡æ¯: ${newSize.width}x${newSize.height}`)
  }
})
</script>
```

### é€‚ç”¨çš„åª’ä½“ç±»å‹

- **è§†é¢‘åª’ä½“**ï¼šå¿…é¡»æœ‰åŸå§‹å°ºå¯¸ä¿¡æ¯
- **å›¾ç‰‡åª’ä½“**ï¼šå¿…é¡»æœ‰åŸå§‹å°ºå¯¸ä¿¡æ¯
- **éŸ³é¢‘åª’ä½“**ï¼šä¸éœ€è¦å°ºå¯¸ä¿¡æ¯
- **æ–‡æœ¬åª’ä½“**ï¼šä¸éœ€è¦å°ºå¯¸ä¿¡æ¯ï¼ˆä½¿ç”¨æ ·å¼é…ç½®çš„å°ºå¯¸ï¼‰

## è®¾è®¡ä¼˜åŠ¿æ€»ç»“

### 1. ç»Ÿä¸€å¼‚æ­¥æº + å“åº”å¼æ¶æ„
- **å®Œå…¨ç»Ÿä¸€**ï¼šæ‰€æœ‰åª’ä½“é¡¹ç›®éƒ½æ˜¯å“åº”å¼å¼‚æ­¥æºï¼Œæ¶ˆé™¤ç±»å‹åˆ†æ”¯
- **å®Œç¾å“åº”å¼**ï¼šæ‰€æœ‰çŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘UIæ›´æ–°
- **æ•°æ®æºå±‚**ï¼šä¸“æ³¨æ–‡ä»¶è·å–ï¼ˆä¸‹è½½ã€åŒæ­¥ã€ä¼ è¾“ã€éªŒè¯ï¼‰
- **åª’ä½“å±‚**ï¼šä¸“æ³¨æ–‡ä»¶å¤„ç†ï¼ˆè§£æã€å°±ç»ªã€é”™è¯¯ï¼‰
- **èŒè´£åˆ†ç¦»**ï¼šå„å±‚ç®¡ç†è‡ªå·±çš„çŠ¶æ€å’Œé€»è¾‘
- **å¤„ç†å·®å¼‚åŒ–**ï¼šé€šè¿‡è·å–é€Ÿåº¦åŒºåˆ†ï¼Œè€Œéç±»å‹åŒºåˆ†

### 2. æ‰©å±•æ€§å¼º
- æ•°æ®æºç±»å‹å¯ç‹¬ç«‹æ‰©å±•ï¼Œæ— éœ€ä¿®æ”¹åª’ä½“ç±»å‹æ ¸å¿ƒé€»è¾‘
- æ–°çš„æ•°æ®æºåªéœ€å®ç°ç»Ÿä¸€çš„çŠ¶æ€æ˜ å°„æ¥å£
- æ”¯æŒäº‘ç›˜ã€FTPã€æ•°æ®åº“ç­‰å¤šç§æ•°æ®æºç±»å‹
- å‡½æ•°å¼è®¾è®¡ä¾¿äºæµ‹è¯•å’Œç»´æŠ¤

### 3. å¼€å‘ä½“éªŒä¼˜ç§€
- ç±»å‹å®‰å…¨çš„æŸ¥è¯¢å‡½æ•°å’Œè¡Œä¸ºå‡½æ•°
- Vue3å“åº”å¼ç³»ç»Ÿçš„å®Œç¾æ”¯æŒ
- ç®€åŒ–çš„çŠ¶æ€ç®¡ç†å’ŒUIæ›´æ–°é€»è¾‘
- æ›´å¥½çš„è°ƒè¯•å’Œå¼€å‘å·¥å…·æ”¯æŒ

> è¯¦ç»†çš„æ•°æ®æºæ‰©å±•è®¾è®¡è¯·å‚è€ƒ [æ•°æ®æºç±»å‹è®¾è®¡æ–‡æ¡£](./01-æ•°æ®æºåŸºç¡€ç±»å‹è®¾è®¡.md)
