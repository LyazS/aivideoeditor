# åª’ä½“ç±»å‹ç»Ÿä¸€è®¾è®¡ - ç±»å‹è®¾è®¡

## æ¦‚è¿°

å½“å‰é¡¹ç›®ä¸­å­˜åœ¨ `LocalMediaItem` å’Œ `AsyncProcessingMediaItem` ä¸¤å¥—å¹¶è¡Œçš„åª’ä½“ç±»å‹ç³»ç»Ÿï¼Œå¯¼è‡´æ¶æ„å¤æ‚ã€ä»£ç é‡å¤ã€ç»´æŠ¤å›°éš¾ã€‚æœ¬æ–¹æ¡ˆæå‡º**ç»Ÿä¸€å¼‚æ­¥æº**çš„è®¾è®¡æ€è·¯ï¼Œå°†"æœ¬åœ°"å’Œ"å¼‚æ­¥"ä»**ç±»å‹åŒºåˆ†**æ”¹ä¸º**çŠ¶æ€åŒºåˆ†**ï¼Œæ‰€æœ‰åª’ä½“é¡¹ç›®éƒ½ç»Ÿä¸€é‡‡ç”¨å¼‚æ­¥å¤„ç†æ¨¡å¼ã€‚

### æ ¸å¿ƒç†å¿µï¼šç»Ÿä¸€å¼‚æ­¥æº (Unified Async Source)

**æ‰€æœ‰åª’ä½“é¡¹ç›®éƒ½æ˜¯å¼‚æ­¥æº**ï¼Œæ— è®ºæ˜¯ç”¨æˆ·é€‰æ‹©çš„æœ¬åœ°æ–‡ä»¶ã€å·¥ç¨‹åŠ è½½çš„æ–‡ä»¶è·¯å¾„ï¼Œè¿˜æ˜¯è¿œç¨‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œéƒ½é€šè¿‡ç»Ÿä¸€çš„å¼‚æ­¥çŠ¶æ€æœºè¿›è¡Œå¤„ç†ï¼š

- **æœ¬åœ°æ–‡ä»¶**ï¼šç¬é—´å®Œæˆè·å–é˜¶æ®µï¼Œä½†ä»èµ°å®Œæ•´çš„å¼‚æ­¥æµç¨‹
- **è¿œç¨‹æ–‡ä»¶**ï¼šæ­£å¸¸çš„å¼‚æ­¥ä¸‹è½½å’Œå¤„ç†æµç¨‹  
- **å·¥ç¨‹æ–‡ä»¶**ï¼šæ£€æŸ¥å­˜åœ¨æ€§åèµ°å¼‚æ­¥æµç¨‹
- **äº‘ç›˜æ–‡ä»¶**ï¼šåŒæ­¥åèµ°å¼‚æ­¥æµç¨‹

jè¿™ç§è®¾è®¡å½»åº•æ¶ˆé™¤äº†ç±»å‹å±‚é¢çš„å¤æ‚æ€§ï¼Œæä¾›äº†çœŸæ­£ç»Ÿä¸€çš„æ¶æ„ã€‚

## å½“å‰é—®é¢˜åˆ†æ

### 1. æ¦‚å¿µæ¨¡å‹æ··ä¹±
```typescript
// âŒ å½“å‰è®¾è®¡ï¼šä¸¤ç§ç±»å‹
LocalMediaItem vs AsyncProcessingMediaItem

// é—®é¢˜ï¼šæœ¬è´¨ä¸Šéƒ½æ˜¯"åª’ä½“é¡¹ç›®"ï¼Œä¸åº”è¯¥åœ¨ç±»å‹å±‚é¢åŒºåˆ†
```

### 2. æ¶æ„å¤æ‚åº¦è¿‡é«˜
- ä¸¤å¥—å¹¶è¡Œçš„ç±»å‹ç³»ç»Ÿ
- ä¸¤å¥—çŠ¶æ€ç®¡ç†API
- ä¸¤å¥—UIæ¸²æŸ“é€»è¾‘
- å¤æ‚çš„ç±»å‹å®ˆå«å’Œè½¬æ¢é€»è¾‘

## ç»Ÿä¸€è®¾è®¡æ–¹æ¡ˆ

### 1. æ ¸å¿ƒæ€è·¯ï¼šç»Ÿä¸€å¼‚æ­¥æºæ¶æ„

**é‡æ–°ç†è§£"çŠ¶æ€"vs"ç±»å‹"**ï¼š
- "æœ¬åœ°"å’Œ"å¼‚æ­¥"æ˜¯**çŠ¶æ€**ï¼Œä¸æ˜¯**ç±»å‹**
- **æ‰€æœ‰åª’ä½“éƒ½æ˜¯å¼‚æ­¥æº**ï¼šç»Ÿä¸€ä¸ºä¸€ç§åª’ä½“ç±»å‹ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½èµ°å¼‚æ­¥å¤„ç†æµç¨‹
- **å·®å¼‚ä½“ç°åœ¨å¤„ç†é€Ÿåº¦**ï¼šæœ¬åœ°æ–‡ä»¶ç¬é—´å®Œæˆè·å–ï¼Œè¿œç¨‹æ–‡ä»¶éœ€è¦ä¸‹è½½æ—¶é—´
- **ç»Ÿä¸€çš„çŠ¶æ€è½¬æ¢**ï¼šæ‰€æœ‰åª’ä½“éƒ½ç»è¿‡ç›¸åŒçš„çŠ¶æ€è½¬æ¢è·¯å¾„
- å±æ€§åˆ†å±‚ï¼šæ ¸å¿ƒå±æ€§ + çŠ¶æ€ç›¸å…³å±æ€§ + å¯é€‰å±æ€§

**ç»Ÿä¸€å¼‚æ­¥æºçš„ä¼˜åŠ¿**ï¼š
- âœ… **æ¶æ„å®Œå…¨ç»Ÿä¸€**ï¼šæ¶ˆé™¤æ‰€æœ‰ç±»å‹å±‚é¢çš„åˆ†æ”¯é€»è¾‘
- âœ… **ä»£ç é«˜åº¦å¤ç”¨**ï¼šä¸€å¥—ä»£ç å¤„ç†æ‰€æœ‰åª’ä½“ç±»å‹
- âœ… **æ‰©å±•æ€§æå¼º**ï¼šæ–°å¢æ•°æ®æºç±»å‹æ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘
- âœ… **UIé€»è¾‘ç»Ÿä¸€**ï¼šæ‰€æœ‰åª’ä½“ä½¿ç”¨ç›¸åŒçš„çŠ¶æ€æ˜¾ç¤ºç»„ä»¶
- âœ… **æµ‹è¯•ç®€åŒ–**ï¼šå•ä¸€æµç¨‹æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

### 2. åŒé‡çŠ¶æ€è®¾è®¡æ€è·¯

**æ ¸å¿ƒæ´å¯Ÿ**ï¼šæ•°æ®æºçŠ¶æ€å’Œåª’ä½“å¤„ç†çŠ¶æ€æ˜¯ä¸¤ä¸ªä¸åŒå±‚é¢çš„æ¦‚å¿µ
- **æ•°æ®æºçŠ¶æ€**ï¼šè´Ÿè´£"è·å–æ–‡ä»¶"ï¼ˆä¸‹è½½ã€åŒæ­¥ã€ä¼ è¾“ç­‰ï¼‰
- **åª’ä½“çŠ¶æ€**ï¼šè´Ÿè´£"å¤„ç†æ–‡ä»¶"ï¼ˆè§£æã€å°±ç»ªã€é”™è¯¯ç­‰ï¼‰

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- èŒè´£åˆ†ç¦»æ¸…æ™°ï¼šæ•°æ®æºç®¡ç†è·å–é€»è¾‘ï¼Œåª’ä½“é¡¹ç›®ç®¡ç†å¤„ç†é€»è¾‘
- æ‰©å±•æ€§å¼ºï¼šæœªæ¥å¯æ”¯æŒäº‘ç›˜ã€FTPã€æ•°æ®åº“ç­‰å¤šç§æ•°æ®æº
- UIé€»è¾‘ç®€åŒ–ï¼šUIåªéœ€å…³å¿ƒæŠ½è±¡çš„åª’ä½“çŠ¶æ€

## çŠ¶æ€å®šä¹‰

### 1. åª’ä½“å¤„ç†çŠ¶æ€ï¼ˆæŠ½è±¡å±‚ï¼‰

```typescript
type MediaStatus =
  | 'pending'         // ç­‰å¾…å¼€å§‹å¤„ç†
  | 'asyncprocessing' // å¼‚æ­¥è·å–ä¸­ï¼ˆæŠ½è±¡çŠ¶æ€ï¼Œå¯¹åº”å„ç§æ•°æ®æºçš„è·å–é˜¶æ®µï¼‰
  | 'webavdecoding'   // WebAVè§£æä¸­
  | 'ready'           // å°±ç»ª
  | 'error'           // é”™è¯¯
  | 'cancelled'       // å–æ¶ˆ
  | 'missing'         // ç¼ºå¤±ï¼ˆåŠ è½½å·¥ç¨‹æ—¶æœ¬åœ°æ–‡ä»¶ä¸å­˜åœ¨ï¼‰
```

### 2. æ•°æ®æºçŠ¶æ€æ˜ å°„

æ•°æ®æºçš„å†…éƒ¨çŠ¶æ€ä¼šæ˜ å°„åˆ°åª’ä½“å¤„ç†çŠ¶æ€ï¼š

```typescript
// æ•°æ®æºçŠ¶æ€ â†’ åª’ä½“çŠ¶æ€æ˜ å°„
DataSource.internalStatus â†’ UnifiedMediaItem.mediaStatus
â”œâ”€â”€ 'pending'     â†’ 'pending'
â”œâ”€â”€ 'acquiring'   â†’ 'asyncprocessing' âœ… å…³é”®æ˜ å°„
â”œâ”€â”€ 'acquired'    â†’ 'webavdecoding' (å¼€å§‹è§£ææ–‡ä»¶)
â”œâ”€â”€ 'error'       â†’ 'error'
â””â”€â”€ 'cancelled'   â†’ 'cancelled'

// ğŸ”„ ç»Ÿä¸€å¼‚æ­¥æºï¼šæ‰€æœ‰æ–‡ä»¶éƒ½èµ°å¼‚æ­¥æµç¨‹
// æœ¬åœ°æ–‡ä»¶ï¼šç¬é—´å®Œæˆè·å–é˜¶æ®µ
UserSelectedFileSource â†’ 'acquiring'(ç¬é—´å®Œæˆ) â†’ 'acquired' â†’ 'webavdecoding'
// è¿œç¨‹æ–‡ä»¶ï¼šæ­£å¸¸å¼‚æ­¥è·å–
RemoteFileSource â†’ 'acquiring'(ä¸‹è½½è¿‡ç¨‹) â†’ 'acquired' â†’ 'webavdecoding'
// å·¥ç¨‹æ–‡ä»¶ï¼šæ£€æŸ¥åå¼‚æ­¥å¤„ç†
ProjectFileSource â†’ 'acquiring'(æ£€æŸ¥å­˜åœ¨æ€§) â†’ 'acquired' â†’ 'webavdecoding'
```

> **æ³¨æ„**ï¼šå…·ä½“çš„æ•°æ®æºç±»å‹å®šä¹‰è¯·å‚è€ƒ [æ•°æ®æºç±»å‹è®¾è®¡æ–‡æ¡£](./æ•°æ®æºç±»å‹è®¾è®¡.md)

## ç»Ÿä¸€åª’ä½“é¡¹ç›®æ¥å£

```typescript
// å¯¼å…¥æ•°æ®æºç±»å‹å®šä¹‰
import type { DataSource } from './æ•°æ®æºæ‰©å±•ç±»å‹è®¾è®¡'

/**
 * ç»Ÿä¸€çš„åª’ä½“é¡¹ç›®æ¥å£ - é‡‡ç”¨çŠ¶æ€æœºæ¨¡å¼
 */
export interface UnifiedMediaItem {
  // ==================== æ ¸å¿ƒå±æ€§ ====================
  id: string
  mediaType: MediaType | 'unknown'
  mediaStatus: MediaStatus // ç‹¬ç«‹çŠ¶æ€å­—æ®µï¼Œä¸æ˜¯è®¡ç®—å±æ€§

  // ==================== æ•°æ®æºï¼ˆåŒ…å«è·å–çŠ¶æ€ï¼‰ ====================
  source: DataSource // ä½¿ç”¨ç»Ÿä¸€çš„æ•°æ®æºè”åˆç±»å‹

  // ==================== WebAVå¯¹è±¡ï¼ˆçŠ¶æ€ç›¸å…³ï¼‰ ====================
  webav?: {
    mp4Clip?: Raw<MP4Clip>
    imgClip?: Raw<ImgClip>
    audioClip?: Raw<AudioClip>
    thumbnailUrl?: string
  }

  // ==================== å…ƒæ•°æ®ï¼ˆçŠ¶æ€ç›¸å…³ï¼‰ ====================
  duration?: number // readyçŠ¶æ€æ‰æœ‰ç¡®åˆ‡å€¼

  // ==================== çŠ¶æ€æœºæ–¹æ³• ====================
  /**
   * çŠ¶æ€è½¬æ¢æ–¹æ³• - ç”±æ•°æ®æºç®¡ç†å™¨è°ƒç”¨
   * @param newStatus ç›®æ ‡çŠ¶æ€
   * @param context è½¬æ¢ä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰- ç”¨äºä¼ é€’çŠ¶æ€è½¬æ¢çš„é™„åŠ ä¿¡æ¯
   */
  transitionTo(newStatus: MediaStatus, context?: TransitionContext): void

  /**
   * æ£€æŸ¥æ˜¯å¦å¯ä»¥è½¬æ¢åˆ°æŒ‡å®šçŠ¶æ€
   * @param newStatus ç›®æ ‡çŠ¶æ€
   */
  canTransitionTo(newStatus: MediaStatus): boolean

  /**
   * çŠ¶æ€è½¬æ¢é’©å­ - ç”¨äºå‰¯ä½œç”¨å¤„ç†
   * @param oldStatus åŸçŠ¶æ€
   * @param newStatus æ–°çŠ¶æ€
   * @param context è½¬æ¢ä¸Šä¸‹æ–‡ - åŒ…å«çŠ¶æ€è½¬æ¢çš„è¯¦ç»†ä¿¡æ¯
   */
  onStatusChanged?(oldStatus: MediaStatus, newStatus: MediaStatus, context?: TransitionContext): void
}
```

## è½¬æ¢ä¸Šä¸‹æ–‡è®¾è®¡

è½¬æ¢ä¸Šä¸‹æ–‡ï¼ˆTransitionContextï¼‰æ˜¯çŠ¶æ€è½¬æ¢æ—¶ä¼ é€’é™„åŠ ä¿¡æ¯çš„æœºåˆ¶ï¼Œè®©çŠ¶æ€æœºèƒ½å¤Ÿåœ¨ä¿æŒç®€æ´çš„åŒæ—¶æ”¯æŒå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ã€‚

### 1. åŸºç¡€ä¸Šä¸‹æ–‡ç»“æ„

```typescript
// åŸºç¡€ä¸Šä¸‹æ–‡ - æ‰€æœ‰è½¬æ¢éƒ½åŒ…å«çš„é€šç”¨ä¿¡æ¯
interface BaseTransitionContext {
  timestamp: number         // è½¬æ¢æ—¶é—´æˆ³
  source: string           // è§¦å‘è½¬æ¢çš„æ¥æº
  reason: string           // è½¬æ¢åŸå› 
  metadata?: Record<string, any> // å…¶ä»–å…ƒæ•°æ®
}
```

### 2. å…·ä½“ä¸Šä¸‹æ–‡ç±»å‹

```typescript
// å¼€å§‹å¼‚æ­¥å¤„ç†çš„ä¸Šä¸‹æ–‡
interface AsyncProcessingContext extends BaseTransitionContext {
  type: 'async_processing'
  initialProgress?: number  // åˆå§‹è¿›åº¦
  estimatedDuration?: number // é¢„ä¼°æ€»è€—æ—¶
}

// è¿›åº¦æ›´æ–°ä¸Šä¸‹æ–‡ï¼ˆåŒçŠ¶æ€è½¬æ¢ï¼Œç”¨äºè¿›åº¦é€šçŸ¥ï¼‰
interface ProgressUpdateContext extends BaseTransitionContext {
  type: 'progress_update'
  progress: number          // å½“å‰è¿›åº¦ (0-100)
  progressMessage: string   // è¿›åº¦æè¿°
  estimatedTime?: number    // é¢„ä¼°å‰©ä½™æ—¶é—´(ms)
  downloadSpeed?: string    // ä¸‹è½½é€Ÿåº¦
  downloadedBytes?: number  // å·²ä¸‹è½½å­—èŠ‚æ•°
  totalBytes?: number       // æ€»å­—èŠ‚æ•°
}

// ä¸‹è½½å®Œæˆè½¬æ¢ä¸Šä¸‹æ–‡
interface DownloadCompletedContext extends BaseTransitionContext {
  type: 'download_completed'
  downloadedFile: File      // å·²ä¸‹è½½çš„æ–‡ä»¶å¯¹è±¡
  downloadedUrl: string     // æœ¬åœ°blob URL
  fileSize: number          // æ–‡ä»¶å¤§å°
  downloadDuration: number  // ä¸‹è½½è€—æ—¶(ms)
  averageSpeed?: string     // å¹³å‡ä¸‹è½½é€Ÿåº¦
}

// WebAVè§£æå®Œæˆä¸Šä¸‹æ–‡
interface ParseCompletedContext extends BaseTransitionContext {
  type: 'parse_completed'
  parsedMetadata: {         // è§£æå¾—åˆ°çš„å…ƒæ•°æ®
    duration: number
    resolution?: string
    format: string
    bitrate?: number
    codecInfo?: {
      video?: string
      audio?: string
    }
  }
  thumbnailGenerated: boolean // æ˜¯å¦ç”Ÿæˆäº†ç¼©ç•¥å›¾
  webavObjects: any          // WebAVè§£æç»“æœ
  parseTime: number          // è§£æè€—æ—¶(ms)
}

// é”™è¯¯è½¬æ¢ä¸Šä¸‹æ–‡
interface ErrorContext extends BaseTransitionContext {
  type: 'error'
  errorMessage: string      // é”™è¯¯æè¿°
  errorCode: string         // é”™è¯¯ä»£ç 
  errorDetails?: any        // è¯¦ç»†é”™è¯¯ä¿¡æ¯
  retryable: boolean        // æ˜¯å¦å¯é‡è¯•
  retryCount?: number       // é‡è¯•æ¬¡æ•°
  lastAttemptTime?: number  // ä¸Šæ¬¡å°è¯•æ—¶é—´
}

// å–æ¶ˆè½¬æ¢ä¸Šä¸‹æ–‡
interface CancelledContext extends BaseTransitionContext {
  type: 'cancelled'
  cancelReason: string      // å–æ¶ˆåŸå› 
  partialProgress?: number  // å–æ¶ˆæ—¶çš„è¿›åº¦
  canResume?: boolean       // æ˜¯å¦å¯æ¢å¤
}

// é‡è¯•è½¬æ¢ä¸Šä¸‹æ–‡
interface RetryContext extends BaseTransitionContext {
  type: 'retry'
  retryCount: number        // é‡è¯•æ¬¡æ•°
  previousError?: string    // ä¸Šæ¬¡é”™è¯¯ä¿¡æ¯
  retryDelay?: number       // é‡è¯•å»¶è¿Ÿ(ms)
}

// æ–‡ä»¶ç¼ºå¤±ä¸Šä¸‹æ–‡
interface MissingContext extends BaseTransitionContext {
  type: 'missing'
  originalPath?: string     // åŸå§‹æ–‡ä»¶è·¯å¾„
  lastModified?: number     // æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´
  expectedSize?: number     // é¢„æœŸæ–‡ä»¶å¤§å°
}

// è”åˆç±»å‹å®šä¹‰
type TransitionContext =
  | AsyncProcessingContext
  | ProgressUpdateContext
  | DownloadCompletedContext
  | ParseCompletedContext
  | ErrorContext
  | CancelledContext
  | RetryContext
  | MissingContext
```

### 3. è”åˆç±»å‹è®¾è®¡ä¼˜åŠ¿

1. **ç±»å‹å®‰å…¨**
   - æ¯ç§è½¬æ¢åœºæ™¯éƒ½æœ‰æ˜ç¡®çš„ä¸Šä¸‹æ–‡ç»“æ„
   - TypeScript å¯ä»¥æä¾›ç²¾ç¡®çš„ç±»å‹æ£€æŸ¥å’Œä»£ç æç¤º
   - é¿å…ä¼ é€’ä¸ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

2. **è¯­ä¹‰æ¸…æ™°**
   - é€šè¿‡ `type` å­—æ®µæ˜ç¡®æ ‡è¯†ä¸Šä¸‹æ–‡ç±»å‹
   - ä¸åŒåœºæ™¯çš„ä¸Šä¸‹æ–‡å­—æ®µæœ‰æ˜ç¡®çš„ä¸šåŠ¡å«ä¹‰
   - ä¾¿äºç†è§£å’Œç»´æŠ¤

3. **æ‰©å±•æ€§å¼º**
   - æ–°å¢è½¬æ¢åœºæ™¯æ—¶åªéœ€æ·»åŠ æ–°çš„ä¸Šä¸‹æ–‡ç±»å‹
   - ä¸å½±å“ç°æœ‰çš„ä¸Šä¸‹æ–‡ç»“æ„
   - æ”¯æŒæ¸è¿›å¼åŠŸèƒ½å¢å¼º

4. **å¯è°ƒè¯•æ€§å¥½**
   - æ¯ä¸ªä¸Šä¸‹æ–‡éƒ½åŒ…å«å®Œæ•´çš„è½¬æ¢ä¿¡æ¯
   - ä¾¿äºæ—¥å¿—è®°å½•å’Œé—®é¢˜æ’æŸ¥
   - æ”¯æŒè¯¦ç»†çš„çŠ¶æ€è½¬æ¢è¿½è¸ª

## çŠ¶æ€è½¬æ¢è§„åˆ™

```typescript
/**
 * åˆæ³•çš„çŠ¶æ€è½¬æ¢æ˜ å°„è¡¨
 */
const VALID_TRANSITIONS: Record<MediaStatus, MediaStatus[]> = {
  'pending': ['asyncprocessing', 'webavdecoding', 'error', 'missing'],
  'asyncprocessing': ['webavdecoding', 'error', 'cancelled'],
  'webavdecoding': ['ready', 'error'],
  'ready': ['error'], // è¿è¡Œæ—¶å¯èƒ½å‡ºé”™
  'error': ['pending'], // æ”¯æŒé‡è¯•
  'cancelled': ['pending'], // æ”¯æŒé‡æ–°å¼€å§‹
  'missing': ['pending', 'error'] // é‡æ–°é€‰æ‹©æ–‡ä»¶æˆ–ç¡®è®¤é”™è¯¯
}

/**
 * çŠ¶æ€è½¬æ¢å®ç°ç¤ºä¾‹
 */
class UnifiedMediaItemImpl implements UnifiedMediaItem {
  // ... å…¶ä»–å±æ€§

  transitionTo(newStatus: MediaStatus, context?: TransitionContext): void {
    if (!this.canTransitionTo(newStatus)) {
      throw new Error(`Invalid transition from ${this.mediaStatus} to ${newStatus}`)
    }

    const oldStatus = this.mediaStatus
    this.mediaStatus = newStatus

    // è§¦å‘çŠ¶æ€å˜åŒ–é’©å­ï¼Œä¼ é€’å®Œæ•´çš„è½¬æ¢ä¸Šä¸‹æ–‡
    this.onStatusChanged?.(oldStatus, newStatus, context)
  }

  canTransitionTo(newStatus: MediaStatus): boolean {
    return VALID_TRANSITIONS[this.mediaStatus]?.includes(newStatus) ?? false
  }
}
```

## å„çŠ¶æ€å­—æ®µçº¦æŸ

### 1. pendingçŠ¶æ€
```typescript
{
  id: string âœ…
  mediaType: 'unknown' âœ… // è¿˜æœªæ£€æµ‹
  source: DataSource âœ… // ä»»ä½•æ•°æ®æºç±»å‹
  source.getStatus(): 'pending' âœ…
  webav: undefined âŒ
  duration: undefined âŒ
}
```

### 2. asyncprocessingçŠ¶æ€ï¼ˆç»Ÿä¸€å¼‚æ­¥æº - æ‰€æœ‰æ•°æ®æºéƒ½ç»è¿‡æ­¤çŠ¶æ€ï¼‰
```typescript
{
  id: string âœ…
  mediaType: 'unknown' âœ… // ä»æœªæ£€æµ‹åˆ°å®é™…ç±»å‹
  source: DataSource âœ… // æ•°æ®æºæ­£åœ¨è·å–ä¸­
  source.getStatus(): 'acquiring' âœ…
  source.getProgress(): 0-99 âœ…
  webav: undefined âŒ
  duration: undefined âŒ
}
```

### 3. webavdecodingçŠ¶æ€
```typescript
{
  id: string âœ…
  mediaType: 'unknown' âœ… // æ­£åœ¨æ£€æµ‹ä¸­
  source: DataSource âœ… // æ•°æ®æºå·²è·å–å®Œæˆ
  source.getStatus(): 'acquired' âœ…
  webav: undefined âŒ // æˆ–éƒ¨åˆ†åˆ›å»º
  duration: undefined âŒ
}
```

### 4. readyçŠ¶æ€
```typescript
{
  id: string âœ…
  mediaType: MediaType âœ… // å·²æ£€æµ‹åˆ°ç¡®åˆ‡ç±»å‹
  source: DataSource âœ… // æ•°æ®æºå·²è·å–å®Œæˆ
  source.getStatus(): 'acquired' âœ…
  webav: {
    mp4Clip?: Raw<MP4Clip> âœ… // æ ¹æ®ç±»å‹
    imgClip?: Raw<ImgClip> âœ…
    audioClip?: Raw<AudioClip> âœ…
    thumbnailUrl?: string âœ…
  }
  duration: number âœ… // ç¡®åˆ‡å€¼
}
```

### 5. error/cancelledçŠ¶æ€
```typescript
{
  id: string âœ…
  mediaType: 'unknown' | MediaType âœ… // å¯èƒ½å·²æ£€æµ‹æˆ–æœªæ£€æµ‹
  source: DataSource âœ…
  source.getStatus(): 'error' | 'cancelled' âœ…
  source.getError(): string âœ… // é”™è¯¯ä¿¡æ¯
  webav: undefined âŒ
  duration: undefined | number // å¯èƒ½æœ‰é¢„ä¼°å€¼
}
```

### 6. missingçŠ¶æ€ï¼ˆé¡¹ç›®åŠ è½½æ—¶ï¼‰
```typescript
{
  id: string âœ…
  mediaType: MediaType âœ… // ä»é¡¹ç›®é…ç½®ä¸­å·²çŸ¥
  source: DataSource âœ… // æ•°æ®æºå¯èƒ½æ— æ•ˆ
  webav: undefined âŒ
  duration: number âœ… // ä»é¡¹ç›®é…ç½®æ¢å¤
}
```

## è®¾è®¡ä¼˜åŠ¿æ€»ç»“

### 1. ç»Ÿä¸€å¼‚æ­¥æºæ¶æ„
- **å®Œå…¨ç»Ÿä¸€**ï¼šæ‰€æœ‰åª’ä½“é¡¹ç›®éƒ½æ˜¯å¼‚æ­¥æºï¼Œæ¶ˆé™¤ç±»å‹åˆ†æ”¯
- **æ•°æ®æºå±‚**ï¼šä¸“æ³¨æ–‡ä»¶è·å–ï¼ˆä¸‹è½½ã€åŒæ­¥ã€ä¼ è¾“ã€éªŒè¯ï¼‰
- **åª’ä½“å±‚**ï¼šä¸“æ³¨æ–‡ä»¶å¤„ç†ï¼ˆè§£æã€å°±ç»ªã€é”™è¯¯ï¼‰
- **èŒè´£åˆ†ç¦»**ï¼šå„å±‚ç®¡ç†è‡ªå·±çš„çŠ¶æ€å’Œé€»è¾‘
- **å¤„ç†å·®å¼‚åŒ–**ï¼šé€šè¿‡è·å–é€Ÿåº¦åŒºåˆ†ï¼Œè€Œéç±»å‹åŒºåˆ†

### 2. æ‰©å±•æ€§å¼º
- æ•°æ®æºç±»å‹å¯ç‹¬ç«‹æ‰©å±•ï¼Œæ— éœ€ä¿®æ”¹åª’ä½“ç±»å‹æ ¸å¿ƒé€»è¾‘
- æ–°çš„æ•°æ®æºåªéœ€å®ç°ç»Ÿä¸€çš„çŠ¶æ€æ˜ å°„æ¥å£
- æ”¯æŒäº‘ç›˜ã€FTPã€æ•°æ®åº“ç­‰å¤šç§æ•°æ®æºç±»å‹

> è¯¦ç»†çš„æ•°æ®æºæ‰©å±•è®¾è®¡è¯·å‚è€ƒ [æ•°æ®æºç±»å‹è®¾è®¡æ–‡æ¡£](./æ•°æ®æºç±»å‹è®¾è®¡.md)
