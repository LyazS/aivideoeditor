# æ–‡æœ¬è½¨é“æ”¯æŒè®¾è®¡æ–¹æ¡ˆ

## ğŸ“Š å®æ–½è¿›åº¦æ€»è§ˆ

**å½“å‰çŠ¶æ€**ï¼šğŸ‰ **é¡¹ç›®å·²å®Œæˆ** (2024-12-19)

| é˜¶æ®µ | çŠ¶æ€ | è¿›åº¦ | å®Œæˆæ—¶é—´ |
|------|------|------|----------|
| é˜¶æ®µ1ï¼šåŸºç¡€æ–‡æœ¬è½¨é“æ”¯æŒ | âœ… å·²å®Œæˆ | 100% | 2024-07-03 |
| é˜¶æ®µ2ï¼šæ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ | âœ… å·²å®Œæˆ | 100% | 2024-12-19 |
| é˜¶æ®µ3ï¼šé«˜çº§æ–‡æœ¬åŠŸèƒ½ | â³ å¾…å¼€å§‹ | 0% | - |
| é˜¶æ®µ4ï¼šæ€§èƒ½ä¼˜åŒ–ä¸å®Œå–„ | â³ å¾…å¼€å§‹ | 0% | - |

**é¡¹ç›®å®Œæˆæˆæœ**ï¼š
- âœ… å®Œæ•´çš„æ–‡æœ¬è½¨é“åˆ›å»ºå’Œç®¡ç†
- âœ… æ–‡æœ¬é¡¹ç›®çš„æ—¶é—´è½´æ˜¾ç¤ºå’Œæ“ä½œ
- âœ… å³é”®èœå•é›†æˆï¼ˆè½¨é“åˆ›å»º+æ–‡æœ¬æ·»åŠ ï¼‰
- âœ… å®Œæ•´çš„æ’¤é”€/é‡åšæ”¯æŒ
- âœ… åª’ä½“ç±»å‹åˆ†ç±»æ¶æ„
- âœ… è°ƒè¯•æ£€æŸ¥ä¼˜åŒ–
- âœ… å®Œæ•´çš„æ–‡æœ¬ç¼–è¾‘é¢æ¿
- âœ… ä¸°å¯Œçš„æ–‡æœ¬æ ·å¼æ§åˆ¶
- âœ… å®æ—¶é¢„è§ˆå’Œæ›´æ–°
- âœ… å®Œæ•´çš„å˜æ¢æ§åˆ¶ï¼ˆä½ç½®ã€ç¼©æ”¾ã€æ—‹è½¬ã€é€æ˜åº¦ï¼‰
- âœ… å…³é”®å¸§åŠ¨ç”»æ”¯æŒ
- âœ… æ—¶é•¿è°ƒæ•´åŠŸèƒ½

**ç”¨æˆ·å¯ç”¨åŠŸèƒ½**ï¼š
- ğŸ¯ åˆ›å»ºå’Œç®¡ç†æ–‡æœ¬è½¨é“
- ğŸ“ æ·»åŠ å’Œç¼–è¾‘æ–‡æœ¬å†…å®¹
- ï¿½ ä¸°å¯Œçš„æ–‡æœ¬æ ·å¼è®¾ç½®ï¼ˆå­—ä½“ã€é¢œè‰²ã€å¯¹é½ã€èƒŒæ™¯è‰²ç­‰ï¼‰
- ï¿½ğŸ¬ æ—¶é—´è½´ä¸­æŸ¥çœ‹æ–‡æœ¬é¢„è§ˆ
- â†”ï¸ æ‹–æ‹½ç§»åŠ¨æ–‡æœ¬ä½ç½®
- ğŸ”„ å˜æ¢æ§åˆ¶ï¼ˆä½ç½®ã€ç¼©æ”¾ã€æ—‹è½¬ã€é€æ˜åº¦ã€å±‚çº§ï¼‰
- â±ï¸ è°ƒæ•´æ–‡æœ¬æ˜¾ç¤ºæ—¶é•¿
- ğŸï¸ å…³é”®å¸§åŠ¨ç”»åˆ¶ä½œ
- â†©ï¸ æ’¤é”€/é‡åšæ‰€æœ‰æ“ä½œ
- ğŸ“‹ å¤åˆ¶ã€ç²˜è´´ã€åˆ é™¤æ–‡æœ¬é¡¹ç›®

---

## 1. å·²å®ç°åŠŸèƒ½è¯¦è§ˆ

### 1.1 æ ¸å¿ƒåŠŸèƒ½æ¸…å•

**è½¨é“ç®¡ç†**ï¼š
- âœ… æ–‡æœ¬è½¨é“åˆ›å»ºå’Œåˆ é™¤
- âœ… è½¨é“å¯è§æ€§æ§åˆ¶
- âœ… è½¨é“é«˜åº¦è‡ªé€‚åº”ï¼ˆ60pxï¼Œæ¯”è§†é¢‘è½¨é“çŸ®ï¼‰
- âœ… é»˜è®¤åŒ…å«ä¸€ä¸ªæ–‡æœ¬è½¨é“

**æ–‡æœ¬é¡¹ç›®æ“ä½œ**ï¼š
- âœ… å³é”®èœå•åˆ›å»ºæ–‡æœ¬é¡¹ç›®
- âœ… æ–‡æœ¬å†…å®¹ç¼–è¾‘ï¼ˆæ”¯æŒå¤šè¡Œï¼‰
- âœ… æ‹–æ‹½ç§»åŠ¨æ–‡æœ¬ä½ç½®
- âœ… æ—¶é•¿è°ƒæ•´ï¼ˆæ—¶é—´ç è¾“å…¥ï¼‰
- âœ… å¤åˆ¶ã€ç²˜è´´ã€åˆ é™¤æ“ä½œ
- âœ… å®Œæ•´çš„æ’¤é”€/é‡åšæ”¯æŒ

**æ–‡æœ¬æ ·å¼æ§åˆ¶**ï¼š
- âœ… å­—ä½“é€‰æ‹©ï¼ˆ7ç§å¸¸ç”¨å­—ä½“ï¼‰
- âœ… å­—ä½“å¤§å°ï¼ˆ12-200pxï¼Œæ»‘å—+æ•°å­—è¾“å…¥ï¼‰
- âœ… å­—ä½“æ ·å¼ï¼ˆæ­£å¸¸/ç²—ä½“/ç»†ä½“ï¼Œæ­£å¸¸/æ–œä½“ï¼‰
- âœ… æ–‡å­—é¢œè‰²ï¼ˆé¢œè‰²é€‰æ‹©å™¨ï¼‰
- âœ… æ–‡æœ¬å¯¹é½ï¼ˆå·¦/ä¸­/å³ï¼‰
- âœ… èƒŒæ™¯é¢œè‰²ï¼ˆå¯é€‰å¯ç”¨/ç¦ç”¨ï¼‰

**å˜æ¢æ§åˆ¶**ï¼š
- âœ… ä½ç½®è°ƒæ•´ï¼ˆx, yåæ ‡ï¼‰
- âœ… ç¼©æ”¾æ§åˆ¶ï¼ˆæ¯”ä¾‹ç¼©æ”¾/ç‹¬ç«‹ç¼©æ”¾ï¼‰
- âœ… æ—‹è½¬æ§åˆ¶ï¼ˆè§’åº¦è°ƒæ•´ï¼‰
- âœ… é€æ˜åº¦æ§åˆ¶ï¼ˆ0-1èŒƒå›´ï¼‰
- âœ… å±‚çº§æ§åˆ¶ï¼ˆzIndexï¼‰
- âœ… å¯¹é½åŠŸèƒ½ï¼ˆæ°´å¹³/å‚ç›´å¯¹é½ï¼‰

**åŠ¨ç”»åŠŸèƒ½**ï¼š
- âœ… å…³é”®å¸§åŠ¨ç”»æ”¯æŒ
- âœ… ç»Ÿä¸€å…³é”®å¸§æ§åˆ¶
- âœ… åŠ¨ç”»æ—¶é•¿è‡ªåŠ¨è°ƒæ•´
- âœ… å…³é”®å¸§å¯¼èˆªåŠŸèƒ½

### 1.2 æŠ€æœ¯å®ç°äº®ç‚¹

**æ¶æ„è®¾è®¡**ï¼š
- âœ… åŸºäºç°æœ‰BaseClipç»„ä»¶ï¼Œä¿æŒä¸€è‡´æ€§
- âœ… ä½¿ç”¨TypeScriptæ³›å‹ `TimelineItem<'text'>`
- âœ… åª’ä½“ç±»å‹åˆ†ç±»æ¶æ„ï¼ˆFILE_BASED vs GENERATEDï¼‰
- âœ… å‘½ä»¤æ¨¡å¼å®ç°æ’¤é”€é‡åš

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- âœ… é˜²æŠ–æ›´æ–°æœºåˆ¶ï¼ˆblur/ç¡®è®¤æ—¶æ›´æ–°ï¼‰
- âœ… æ–‡æœ¬æ¸²æŸ“ç¼“å­˜å¤ç”¨
- âœ… ç²¾çµé‡å»ºç­–ç•¥ï¼ˆä»æºå¤´é‡å»ºï¼‰
- âœ… å†…å­˜ç®¡ç†ä¼˜åŒ–

**ç”¨æˆ·ä½“éªŒ**ï¼š
- âœ… å®æ—¶é¢„è§ˆæ•ˆæœ
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- âœ… ç›´è§‚çš„æ“ä½œç•Œé¢
- âœ… ä¸€è‡´çš„äº¤äº’æ¨¡å¼

---

## 2. æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†ä¸ºè§†é¢‘ç¼–è¾‘å™¨æ·»åŠ æ–‡æœ¬è½¨é“æ”¯æŒçš„å®Œæ•´è®¾è®¡æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆåŸºäºç°æœ‰çš„ `TextVisibleSprite` å®ç°ï¼Œæ‰©å±•è½¨é“ç³»ç»Ÿä»¥æ”¯æŒæ–‡æœ¬å†…å®¹çš„åˆ›å»ºã€ç¼–è¾‘å’Œç®¡ç†ã€‚

### 1.1 è®¾è®¡ç›®æ ‡

- **å®Œæ•´é›†æˆ**ï¼šæ–‡æœ¬è½¨é“ä¸ç°æœ‰è§†é¢‘/éŸ³é¢‘è½¨é“ç³»ç»Ÿæ— ç¼é›†æˆ
- **ç”¨æˆ·å‹å¥½**ï¼šæä¾›ç›´è§‚çš„æ–‡æœ¬ç¼–è¾‘å’Œæ ·å¼æ§åˆ¶ç•Œé¢
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤ç”¨ç°æœ‰ç¼“å­˜æœºåˆ¶ï¼Œç¡®ä¿æµç•…çš„ç¼–è¾‘ä½“éªŒ
- **æ‰©å±•æ€§å¼º**ï¼šä¸ºæœªæ¥çš„æ–‡æœ¬åŠ¨ç”»å’Œé«˜çº§åŠŸèƒ½é¢„ç•™æ¥å£

### 1.2 æ ¸å¿ƒæ¶æ„

```
æ–‡æœ¬è½¨é“ç³»ç»Ÿ
â”œâ”€â”€ ç±»å‹ç³»ç»Ÿæ‰©å±•
â”‚   â”œâ”€â”€ TextTimelineItem (æ–°å¢)
â”‚   â”œâ”€â”€ TextMediaConfig (æ–°å¢)
â”‚   â””â”€â”€ ç°æœ‰ç±»å‹æ‰©å±•
â”œâ”€â”€ æ–‡æœ¬è½¨é“ç®¡ç†
â”‚   â”œâ”€â”€ è½¨é“åˆ›å»ºå’Œç®¡ç† (å·²æœ‰åŸºç¡€)
â”‚   â”œâ”€â”€ æ–‡æœ¬é¡¹ç›®åˆ›å»ºæµç¨‹ (æ–°å¢)
â”‚   â””â”€â”€ æ–‡æœ¬é¡¹ç›®ç”Ÿå‘½å‘¨æœŸç®¡ç† (æ–°å¢)
â”œâ”€â”€ UIç»„ä»¶æ‰©å±•
â”‚   â”œâ”€â”€ æ–‡æœ¬è½¨é“æ¸²æŸ“ (æ–°å¢TextClipåŸºäºBaseClip)
â”‚   â”œâ”€â”€ æ–‡æœ¬ç¼–è¾‘é¢æ¿ (æ–°å¢)
â”‚   â””â”€â”€ æ–‡æœ¬æ ·å¼æ§åˆ¶å™¨ (æ–°å¢)
â””â”€â”€ å‘½ä»¤ç³»ç»Ÿæ‰©å±•
    â”œâ”€â”€ æ–‡æœ¬é¡¹ç›®æ“ä½œå‘½ä»¤ (æ–°å¢)
    â””â”€â”€ æ–‡æœ¬æ ·å¼æ›´æ–°å‘½ä»¤ (æ–°å¢)
```

## 2. ç±»å‹ç³»ç»Ÿæ‰©å±•

### 2.1 æ–‡æœ¬åª’ä½“é…ç½®ç±»å‹

æ–‡æœ¬åª’ä½“é…ç½®é€šè¿‡ç»§æ‰¿ `VisualMediaProps` å®ç°äº†ä¸è§†é¢‘ã€å›¾ç‰‡çš„ä¸€è‡´æ€§ï¼š

**è®¾è®¡ä¼˜åŠ¿ï¼š**
- **ç±»å‹ä¸€è‡´æ€§**ï¼šæ–‡æœ¬ä¸å…¶ä»–è§†è§‰åª’ä½“å…±äº«ç›¸åŒçš„ä½ç½®ã€å¤§å°ã€é€æ˜åº¦ç­‰å±æ€§
- **ä»£ç å¤ç”¨**ï¼šå¯ä»¥å¤ç”¨ç°æœ‰çš„è§†è§‰å±æ€§å¤„ç†é€»è¾‘
- **åŠŸèƒ½å®Œæ•´**ï¼šæ–‡æœ¬æ”¯æŒæ—‹è½¬ã€é€æ˜åº¦ã€å±‚çº§ç­‰æ‰€æœ‰è§†è§‰æ•ˆæœ
- **æ‰©å±•æ€§å¼º**ï¼šæœªæ¥æ·»åŠ æ–°çš„è§†è§‰å±æ€§æ—¶ï¼Œæ–‡æœ¬ä¼šè‡ªåŠ¨ç»§æ‰¿

```typescript
// åœ¨ frontend/src/types/index.ts ä¸­æ–°å¢
export interface TextMediaConfig extends VisualMediaProps {
  /** æ–‡æœ¬å†…å®¹ */
  text: string

  /** æ–‡æœ¬æ ·å¼é…ç½® */
  style: TextStyleConfig

  // ç»§æ‰¿äº† VisualMediaProps çš„æ‰€æœ‰å±æ€§ï¼š
  // - x: number              // æ°´å¹³ä½ç½®
  // - y: number              // å‚ç›´ä½ç½®
  // - width: number          // å®½åº¦
  // - height: number         // é«˜åº¦
  // - rotation: number       // æ—‹è½¬è§’åº¦ï¼ˆå¼§åº¦ï¼‰
  // - opacity: number        // é€æ˜åº¦ï¼ˆ0-1ï¼‰
  // - zIndex: number         // å±‚çº§æ§åˆ¶ï¼ˆæ¥è‡ª BaseMediaPropsï¼‰
  // - animation?: AnimationConfig // åŠ¨ç”»é…ç½®ï¼ˆæ¥è‡ª BaseMediaPropsï¼‰
}

// æ‰©å±•ç°æœ‰çš„ MediaConfigMap å’Œ GetMediaConfig ç±»å‹
type MediaConfigMap = {
  video: VideoMediaConfig
  image: ImageMediaConfig
  audio: AudioMediaConfig
  text: TextMediaConfig  // æ–°å¢
}

export type GetMediaConfig<T extends MediaType> = MediaConfigMap[T]
```

### 2.2 æ–‡æœ¬æ—¶é—´è½´é¡¹ç›®ç±»å‹

```typescript
// æ‰©å±• TimelineItem ä»¥æ”¯æŒæ–‡æœ¬ç±»å‹
export interface TextTimelineItem extends TimelineItem<'text'> {
  mediaType: 'text'
  timeRange: ImageTimeRange  // æ–‡æœ¬ä½¿ç”¨ä¸å›¾ç‰‡ç›¸åŒçš„æ—¶é—´èŒƒå›´
  sprite: Raw<TextVisibleSprite>
  config: TextMediaConfig
}
```

### 2.3 è‡ªå®šä¹‰Spriteç±»å‹æ‰©å±•

```typescript
// ç›´æ¥æ›´æ–° CustomSprite ç±»å‹ä»¥åŒ…å«æ–‡æœ¬ç²¾çµ
export type CustomSprite =
  | VideoVisibleSprite
  | ImageVisibleSprite
  | TextVisibleSprite
```

## 3. æ–‡æœ¬è½¨é“ç®¡ç†æµç¨‹

### 3.1 æ–‡æœ¬é¡¹ç›®åˆ›å»ºæµç¨‹

```typescript
// æ–°å¢æ–‡æœ¬é¡¹ç›®åˆ›å»ºå‡½æ•°
async function createTextTimelineItem(
  text: string,
  style: Partial<TextStyleConfig>,
  startTimeFrames: number,
  trackId: string,
  duration: number = TextVisibleSprite.DEFAULT_DURATION
): Promise<TextTimelineItem> {

  // 1. åˆ›å»ºæ–‡æœ¬ç²¾çµ
  const textSprite = await TextVisibleSprite.create(text, style)

  // 2. è®¾ç½®æ—¶é—´èŒƒå›´
  textSprite.setTimelineStartTime(startTimeFrames)
  textSprite.setDisplayDuration(duration)

  // 3. è®¾ç½®é»˜è®¤ä½ç½®ï¼ˆç”»å¸ƒä¸­å¿ƒï¼‰- ä¸å›¾ç‰‡åˆ›å»ºé€»è¾‘ä¸€è‡´
  const canvasWidth = videoStore.videoResolution.width
  const canvasHeight = videoStore.videoResolution.height
  textSprite.rect.x = (canvasWidth - textSprite.rect.w) / 2
  textSprite.rect.y = (canvasHeight - textSprite.rect.h) / 2

  // 4. å°†WebAVåæ ‡ç³»è½¬æ¢ä¸ºé¡¹ç›®åæ ‡ç³»ï¼ˆä¸­å¿ƒåŸç‚¹ï¼‰
  const projectCoords = webavToProjectCoords(
    textSprite.rect.x,
    textSprite.rect.y,
    textSprite.rect.w,
    textSprite.rect.h,
    canvasWidth,
    canvasHeight,
  )

  // 5. åˆ›å»ºæ—¶é—´è½´é¡¹ç›®
  const timelineItem: TextTimelineItem = {
    id: generateTimelineItemId(),
    mediaItemId: '', // æ–‡æœ¬é¡¹ç›®ä¸éœ€è¦åª’ä½“åº“é¡¹ç›®
    trackId,
    mediaType: 'text',
    timeRange: textSprite.getTimeRange(),
    sprite: markRaw(textSprite),
    config: {
      text,
      style: textSprite.getTextStyle(),
      // ä½¿ç”¨é¡¹ç›®åæ ‡ç³»ï¼ˆä¸­å¿ƒåŸç‚¹ï¼‰
      x: Math.round(projectCoords.x),
      y: Math.round(projectCoords.y),
      width: textSprite.rect.w,
      height: textSprite.rect.h,
      rotation: textSprite.rect.angle || 0,
      opacity: textSprite.opacity,
      zIndex: textSprite.zIndex,
      animation: undefined,
    }
  }

  return timelineItem
}
```

### 3.2 æ–‡æœ¬è½¨é“æ¿€æ´»æµç¨‹

```typescript
// æ‰©å±•ç°æœ‰çš„ addNewTrack å‡½æ•°
async function addNewTrack(type: TrackType = 'video') {
  if (type === 'text') {
    // åˆ›å»ºæ–‡æœ¬è½¨é“
    const newTrackId = await videoStore.addTrackWithHistory(type)

    // æ–‡æœ¬è½¨é“åˆ›å»ºåä¸ºç©ºï¼Œç”¨æˆ·éœ€è¦é€šè¿‡å³é”®èœå•æ·»åŠ æ–‡æœ¬é¡¹ç›®
    return newTrackId
  }

  // å…¶ä»–è½¨é“ç±»å‹çš„ç°æœ‰é€»è¾‘...
}
```

## 4. UIç»„ä»¶æ‰©å±•

> **æ³¨æ„**ï¼šTextClipåŸºäºBaseClipåŸºç¡€ç»„ä»¶æ„å»ºã€‚BaseClipæä¾›äº†æ‰€æœ‰clipçš„é€šç”¨åŠŸèƒ½ï¼ˆæ‹–æ‹½ã€è°ƒæ•´æ—¶é•¿ã€é€‰ä¸­çŠ¶æ€ç­‰ï¼‰ã€‚
> è¯¦ç»†çš„BaseClipè®¾è®¡è¯·å‚è€ƒï¼š[BaseClipåŸºç¡€ç»„ä»¶è®¾è®¡æ–¹æ¡ˆ](./base-clip-component-design.md)

### 4.1 TextClipç»„ä»¶åˆ›å»º

åŸºäºBaseClipåˆ›å»ºTextClipç»„ä»¶ï¼Œä¸“é—¨å¤„ç†æ–‡æœ¬å†…å®¹æ˜¾ç¤ºï¼š

```typescript
// æ–°å¢ TextClip.vue ç»„ä»¶ - åŸºäºBaseClip
<template>
  <BaseClip
    :timeline-item="timelineItem"
    :timeline-width="timelineWidth"
    class="text-clip"
    @select="$emit('select', $event)"
  >
    <template #content="{ timelineItem }">
      <!-- æ–‡æœ¬å†…å®¹æ˜¾ç¤º -->
      <div class="text-content">
        <span class="text-preview">{{ textPreview }}</span>
      </div>
      <!-- æ–‡æœ¬æ ‡ç­¾ -->
      <div class="clip-label">
        {{ timelineItem.config.text || 'æ–‡æœ¬' }}
      </div>
    </template>
  </BaseClip>
</template>

<script setup lang="ts">
import BaseClip from './BaseClip.vue'

interface Props {
  timelineItem: TextTimelineItem
  timelineWidth: number
}

const props = defineProps<Props>()
const emit = defineEmits<{
  'select': [itemId: string]
}>()

// TextClipä¸“ç”¨é€»è¾‘
const textPreview = computed(() => {
  const text = props.timelineItem.config.text || ''
  return text.length > 20 ? text.substring(0, 20) + '...' : text
})
</script>

<style scoped>
/* TextClipä¸“ç”¨æ ·å¼ */
.text-clip {
  background: linear-gradient(135deg, #4CAF50, #45a049); /* æ–‡æœ¬ä¸“ç”¨é¢œè‰² */
}

.text-content {
  display: flex;
  flex-direction: column;
  justify-content: center;
  font-size: 12px;
  color: white;
  height: 100%;
}

.clip-label {
  font-size: 10px;
  opacity: 0.8;
  margin-top: 2px;
}
</style>
```

### 4.2 Timelineç»„ä»¶ä¸­çš„Clipé›†æˆ

```typescript
// åœ¨ Timeline.vue ä¸­æ ¹æ®åª’ä½“ç±»å‹æ¸²æŸ“ä¸åŒçš„clipç»„ä»¶
<template>
  <div class="timeline">
    <!-- è½¨é“æ¸²æŸ“ -->
    <div v-for="track in tracks" :key="track.id" class="track">
      <!-- æ—¶é—´è½´é¡¹ç›®æ¸²æŸ“ -->
      <component
        v-for="item in getTrackItems(track.id)"
        :key="item.id"
        :is="getClipComponent(item.mediaType)"
        :timeline-item="item"
        :timeline-width="timelineWidth"
        @select="handleSelectClip"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import VideoClip from './VideoClip.vue'
import TextClip from './TextClip.vue'

function getClipComponent(mediaType: MediaType) {
  switch (mediaType) {
    case 'video':
    case 'image':
    case 'audio':
      return VideoClip
    case 'text':
      return TextClip
    default:
      return VideoClip
  }
}

function handleSelectClip(itemId: string) {
  // å¤„ç†clipé€‰ä¸­é€»è¾‘
  console.log('é€‰ä¸­clip:', itemId)
}
</script>
```

### 4.3 æ–‡æœ¬ç¼–è¾‘é¢æ¿ç»„ä»¶

```typescript
// æ–°å¢ TextEditPanel.vue ç»„ä»¶
<template>
  <div class="text-edit-panel">
    <div class="text-input-section">
      <textarea 
        v-model="editingText"
        @input="handleTextChange"
        placeholder="è¾“å…¥æ–‡æœ¬å†…å®¹..."
        class="text-input"
      />
    </div>
    
    <div class="text-style-section">
      <TextStyleControls 
        :style="editingStyle"
        @update:style="handleStyleChange"
      />
    </div>
    
    <div class="text-actions">
      <button @click="applyChanges">åº”ç”¨</button>
      <button @click="cancelChanges">å–æ¶ˆ</button>
    </div>
  </div>
</template>
```

### 4.4 æ–‡æœ¬æ ·å¼æ§åˆ¶å™¨ç»„ä»¶

```typescript
// æ–°å¢ TextStyleControls.vue ç»„ä»¶
<template>
  <div class="text-style-controls">
    <div class="font-controls">
      <select v-model="localStyle.fontFamily">
        <option value="Arial">Arial</option>
        <option value="å¾®è½¯é›…é»‘">å¾®è½¯é›…é»‘</option>
        <!-- æ›´å¤šå­—ä½“é€‰é¡¹ -->
      </select>
      
      <input 
        type="range" 
        v-model="localStyle.fontSize"
        min="12" 
        max="120"
        @input="emitStyleChange"
      />
    </div>
    
    <div class="color-controls">
      <input 
        type="color" 
        v-model="localStyle.color"
        @change="emitStyleChange"
      />
    </div>
    
    <!-- æ›´å¤šæ ·å¼æ§åˆ¶... -->
  </div>
</template>
```

## 5. å‘½ä»¤ç³»ç»Ÿæ‰©å±•

### 5.1 æ–‡æœ¬é¡¹ç›®æ“ä½œå‘½ä»¤

```typescript
// åœ¨ timelineCommands.ts ä¸­æ–°å¢
export class AddTextItemCommand implements Command {
  private textItem: TextTimelineItem | null = null
  
  constructor(
    private text: string,
    private style: Partial<TextStyleConfig>,
    private startTimeFrames: number,
    private trackId: string,
    private timelineModule: TimelineModule,
    private webavModule: WebAVModule
  ) {}
  
  async execute(): Promise<void> {
    this.textItem = await createTextTimelineItem(
      this.text,
      this.style,
      this.startTimeFrames,
      this.trackId
    )
    
    this.timelineModule.addTimelineItem(this.textItem)
    this.webavModule.addSprite(this.textItem.sprite)
  }
  
  async undo(): Promise<void> {
    if (this.textItem) {
      this.webavModule.removeSprite(this.textItem.sprite)
      this.timelineModule.removeTimelineItem(this.textItem.id)
    }
  }
}

export class UpdateTextCommand implements Command {
  constructor(
    private timelineItemId: string,
    private newText: string,
    private newStyle: Partial<TextStyleConfig>,
    private timelineModule: TimelineModule
  ) {}

  async execute(): Promise<void> {
    const item = this.timelineModule.getTimelineItem(this.timelineItemId)
    if (item && item.mediaType === 'text') {
      const textSprite = item.sprite as TextVisibleSprite
      await textSprite.updateTextAndStyle(this.newText, this.newStyle)

      // æ›´æ–°é…ç½®
      const textItem = item as TextTimelineItem
      textItem.config.text = this.newText
      textItem.config.style = { ...textItem.config.style, ...this.newStyle }
    }
  }
}
```

### 5.2 æ–‡æœ¬clipæ“ä½œå‘½ä»¤ï¼ˆå¤ç”¨ç°æœ‰é€»è¾‘ï¼‰

æ–‡æœ¬clipçš„å¤åˆ¶ã€æ’¤é”€ç­‰æ“ä½œå¯ä»¥ç›´æ¥å¤ç”¨ç°æœ‰çš„å‘½ä»¤ç³»ç»Ÿï¼Œå› ä¸ºéƒ½éµå¾ªç›¸åŒçš„"ä»æºå¤´é‡å»º"åŸåˆ™ï¼š

```typescript
// æ–‡æœ¬clipå¤åˆ¶ - å¤ç”¨ DuplicateTimelineItemCommand
// ä»æ–‡æœ¬å†…å®¹é‡æ–°åˆ›å»ºspriteï¼Œæ¢å¤æ‰€æœ‰å±æ€§

// æ–‡æœ¬clipæ’¤é”€ - å¤ç”¨ç°æœ‰çš„ Command ç³»ç»Ÿ
// ä»ä¿å­˜çš„çŠ¶æ€é‡æ–°åˆ›å»ºæ–‡æœ¬sprite

// æ³¨æ„ï¼šæ–‡æœ¬clipä¸æ”¯æŒåˆ†å‰²æ“ä½œ
// æ–‡æœ¬æ˜¯å®Œæ•´çš„å†…å®¹å•å…ƒï¼Œä¸åƒè§†é¢‘å¯ä»¥æŒ‰æ—¶é—´åˆ†å‰²
```

**å…³é”®å®ç°ç‚¹ï¼š**
- æ–‡æœ¬clipéœ€è¦æ‰©å±• `createSpriteFromMediaItem` æ”¯æŒæ–‡æœ¬ç±»å‹
- æˆ–è€…ä¸ºæ–‡æœ¬åˆ›å»ºä¸“é—¨çš„é‡å»ºå‡½æ•° `recreateTextSprite`
- ç¡®ä¿æ–‡æœ¬çš„æ—¶é—´èŒƒå›´ã€å˜æ¢å±æ€§èƒ½æ­£ç¡®æ¢å¤
- **åˆ†å‰²æ“ä½œ**ï¼šåœ¨UIä¸­å¯¹æ–‡æœ¬clipç¦ç”¨åˆ†å‰²åŠŸèƒ½

## 6. é›†æˆç‚¹å’Œæ‰©å±•ç‚¹

### 6.1 è½¨é“ç±»å‹æ£€æŸ¥æ‰©å±•

```typescript
// åœ¨ Timeline.vue ä¸­æ‰©å±•è½¨é“å…¼å®¹æ€§æ£€æŸ¥
function isMediaCompatibleWithTrack(mediaType: MediaType, trackType: TrackType): boolean {
  switch (trackType) {
    case 'video':
      return mediaType === 'video' || mediaType === 'image'
    case 'audio':
      return mediaType === 'audio'
    case 'text':
      return mediaType === 'text'  // æ–°å¢
    default:
      return false
  }
}
```



## 6.2 æ–‡æœ¬åˆ›å»ºæ–¹å¼

æ–‡æœ¬é¡¹ç›®åªèƒ½é€šè¿‡å³é”®èœå•åˆ›å»ºï¼Œä¸æ”¯æŒæ‹–æ‹½åˆ›å»ºï¼š

```typescript
// åœ¨æ—¶é—´è½´å³é”®èœå•ä¸­æ·»åŠ æ–‡æœ¬åˆ›å»ºé€‰é¡¹
function showTimelineContextMenu(event: MouseEvent, trackId: string, timePosition: number) {
  const menuItems = [
    // å…¶ä»–èœå•é¡¹...
    {
      label: 'æ·»åŠ æ–‡æœ¬',
      action: () => createTextAtPosition(trackId, timePosition),
      visible: isTextTrack(trackId) // åªåœ¨æ–‡æœ¬è½¨é“æ˜¾ç¤º
    }
  ]

  showContextMenu(event, menuItems)
}

async function createTextAtPosition(trackId: string, timeFrames: number) {
  const textItem = await createTextTimelineItem(
    'ç‚¹å‡»ç¼–è¾‘æ–‡æœ¬',
    { fontSize: 48, color: '#ffffff' },
    timeFrames,
    trackId
  )

  await videoStore.addTimelineItemWithHistory(textItem)
}
```

## 7. å®ç°ä¼˜å…ˆçº§å’Œé˜¶æ®µ

### é˜¶æ®µ1ï¼šåŸºç¡€æ–‡æœ¬è½¨é“æ”¯æŒ âœ… å·²å®Œæˆ
1. âœ… æ‰©å±•ç±»å‹å®šä¹‰
2. âœ… å®ç°æ–‡æœ¬é¡¹ç›®åˆ›å»ºæµç¨‹
3. âœ… åˆ›å»ºTextClipç»„ä»¶æ˜¾ç¤ºæ–‡æœ¬é¡¹ç›®ï¼ˆåŸºäºBaseClipï¼‰
4. âœ… åŸºç¡€çš„æ–‡æœ¬è½¨é“æ“ä½œ

### é˜¶æ®µ2ï¼šæ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ âœ… å·²å®Œæˆ
1. âœ… æ–‡æœ¬ç¼–è¾‘é¢æ¿ç»„ä»¶ï¼ˆTextClipProperties.vueï¼‰
2. âœ… æ–‡æœ¬æ ·å¼æ§åˆ¶å™¨ï¼ˆå®Œæ•´çš„æ ·å¼æ§åˆ¶ï¼‰
3. âœ… å®æ—¶é¢„è§ˆå’Œæ›´æ–°ï¼ˆUpdateTextCommandï¼‰
4. âœ… æ–‡æœ¬é¡¹ç›®çš„ä½ç½®å’Œå¤§å°è°ƒæ•´ï¼ˆTransformControlsé›†æˆï¼‰
5. âœ… å…³é”®å¸§åŠ¨ç”»æ”¯æŒï¼ˆuseKeyframeTransformControlsï¼‰
6. âœ… æ—¶é•¿è°ƒæ•´åŠŸèƒ½ï¼ˆæ—¶é—´ç è¾“å…¥ï¼‰

### é˜¶æ®µ3ï¼šé«˜çº§åŠŸèƒ½ â³ å¾…å¼€å§‹
1. â³ æ–‡æœ¬æ•ˆæœï¼ˆé˜´å½±ã€æè¾¹ã€å‘å…‰ç­‰ï¼‰
2. â³ æ–‡æœ¬æ¨¡æ¿ç³»ç»Ÿ
3. â³ è‡ªå®šä¹‰å­—ä½“ç®¡ç†
4. â³ æ–‡æœ¬åŠ¨ç”»é¢„è®¾

## 8. å…³é”®æŠ€æœ¯è€ƒè™‘

### 8.1 æ–‡æœ¬é¡¹ç›®çš„è°ƒè¯•æ£€æŸ¥å¤„ç†

**é—®é¢˜æè¿°**ï¼š
æ–‡æœ¬é¡¹ç›®ä¸éœ€è¦ç´ æåº“é¡¹ç›®ï¼ˆMediaItemï¼‰ï¼Œå…¶ `mediaItemId` ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè¿™ä¼šå¯¼è‡´ç°æœ‰çš„è°ƒè¯•æ£€æŸ¥é€»è¾‘äº§ç”Ÿ"å­¤ç«‹çš„æ—¶é—´è½´é¡¹ç›®"è­¦å‘Šã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šé‡‡ç”¨åª’ä½“ç±»å‹åˆ†ç±» + è°ƒè¯•é€»è¾‘ä¼˜åŒ–çš„ç»„åˆæ–¹æ¡ˆ

#### 8.1.1 çŸ­æœŸè§£å†³æ–¹æ¡ˆï¼šè°ƒè¯•é€»è¾‘ä¼˜åŒ–

ç›´æ¥ä¿®æ”¹ `debugUtils.ts` ä¸­çš„æ£€æŸ¥é€»è¾‘ï¼Œä¸ºæ–‡æœ¬ç±»å‹æ·»åŠ ä¾‹å¤–å¤„ç†ï¼š

```typescript
// åœ¨ frontend/src/stores/utils/debugUtils.ts ä¸­
function checkOrphanedTimelineItems(
  timelineItems: TimelineItem[],
  mediaItems: MediaItem[]
) {
  const orphanedItems = timelineItems.filter(item => {
    // æ–‡æœ¬é¡¹ç›®ä¸éœ€è¦ç´ æåº“é¡¹ç›®ï¼Œè·³è¿‡æ£€æŸ¥
    if (item.mediaType === 'text') {
      return false
    }

    // å…¶ä»–ç±»å‹æ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”çš„ç´ æåº“é¡¹ç›®
    return !mediaItems.find(m => m.id === item.mediaItemId)
  })

  if (orphanedItems.length > 0) {
    console.warn('âš ï¸ å‘ç°å­¤ç«‹çš„æ—¶é—´è½´é¡¹ç›® (æ²¡æœ‰å¯¹åº”çš„ç´ æåº“é¡¹ç›®):', orphanedItems)
  }
}
```

#### 8.1.2 é•¿æœŸæ¶æ„æ–¹æ¡ˆï¼šåª’ä½“ç±»å‹åˆ†ç±»

å¼•å…¥åª’ä½“ç±»å‹åˆ†ç±»æ¦‚å¿µï¼Œä¸ºæœªæ¥æ‰©å±•åšå‡†å¤‡ï¼š

```typescript
// åœ¨ frontend/src/types/index.ts ä¸­æ–°å¢
/**
 * åª’ä½“ç±»å‹åˆ†ç±»
 * åŒºåˆ†åŸºäºæ–‡ä»¶çš„åª’ä½“å’Œç¨‹åºç”Ÿæˆçš„åª’ä½“
 */
export const MEDIA_TYPE_CATEGORIES = {
  /** åŸºäºæ–‡ä»¶çš„åª’ä½“ç±»å‹ï¼ˆéœ€è¦ç´ æåº“é¡¹ç›®ï¼‰ */
  FILE_BASED: ['video', 'image', 'audio'] as const,

  /** ç¨‹åºç”Ÿæˆçš„åª’ä½“ç±»å‹ï¼ˆä¸éœ€è¦ç´ æåº“é¡¹ç›®ï¼‰ */
  GENERATED: ['text'] as const,
} as const

/**
 * æ£€æŸ¥åª’ä½“ç±»å‹æ˜¯å¦éœ€è¦ç´ æåº“é¡¹ç›®
 * @param mediaType åª’ä½“ç±»å‹
 * @returns æ˜¯å¦éœ€è¦ç´ æåº“é¡¹ç›®
 */
export function requiresMediaItem(mediaType: MediaType): boolean {
  return MEDIA_TYPE_CATEGORIES.FILE_BASED.includes(mediaType as any)
}

/**
 * æ£€æŸ¥åª’ä½“ç±»å‹æ˜¯å¦ä¸ºç¨‹åºç”Ÿæˆ
 * @param mediaType åª’ä½“ç±»å‹
 * @returns æ˜¯å¦ä¸ºç¨‹åºç”Ÿæˆçš„åª’ä½“
 */
export function isGeneratedMedia(mediaType: MediaType): boolean {
  return MEDIA_TYPE_CATEGORIES.GENERATED.includes(mediaType as any)
}
```

#### 8.1.3 ä¼˜åŒ–åçš„è°ƒè¯•æ£€æŸ¥

ä½¿ç”¨åª’ä½“ç±»å‹åˆ†ç±»çš„è°ƒè¯•æ£€æŸ¥ï¼š

```typescript
// ä½¿ç”¨æ–°çš„åˆ†ç±»å‡½æ•°
function checkOrphanedTimelineItems(
  timelineItems: TimelineItem[],
  mediaItems: MediaItem[]
) {
  const orphanedItems = timelineItems.filter(item => {
    // åªæ£€æŸ¥éœ€è¦ç´ æåº“é¡¹ç›®çš„åª’ä½“ç±»å‹
    if (!requiresMediaItem(item.mediaType)) {
      return false
    }

    return !mediaItems.find(m => m.id === item.mediaItemId)
  })

  if (orphanedItems.length > 0) {
    console.warn('âš ï¸ å‘ç°å­¤ç«‹çš„æ—¶é—´è½´é¡¹ç›® (æ²¡æœ‰å¯¹åº”çš„ç´ æåº“é¡¹ç›®):', orphanedItems)
  }
}
```

**å®æ–½è®¡åˆ’**ï¼š
1. **é˜¶æ®µ1**ï¼šå®æ–½çŸ­æœŸè§£å†³æ–¹æ¡ˆï¼Œç«‹å³è§£å†³è­¦å‘Šé—®é¢˜
2. **é˜¶æ®µ2**ï¼šå¼•å…¥åª’ä½“ç±»å‹åˆ†ç±»ï¼Œä¸ºæœªæ¥æ‰©å±•åšå‡†å¤‡
3. **é˜¶æ®µ3**ï¼šåœ¨å…¶ä»–ç›¸å…³ä»£ç ä¸­åº”ç”¨åˆ†ç±»æ¦‚å¿µ

**æ‰©å±•æ€§è€ƒè™‘**ï¼š
- æœªæ¥æ·»åŠ å…¶ä»–ç¨‹åºç”Ÿæˆçš„åª’ä½“ç±»å‹ï¼ˆå¦‚å½¢çŠ¶ã€å›¾è¡¨ã€åŠ¨ç”»ç­‰ï¼‰æ—¶ï¼Œåªéœ€æ·»åŠ åˆ° `GENERATED` åˆ†ç±»ä¸­
- è°ƒè¯•æ£€æŸ¥é€»è¾‘æ— éœ€ä¿®æ”¹ï¼Œè‡ªåŠ¨é€‚åº”æ–°çš„åª’ä½“ç±»å‹

### 8.2 ä¸å›¾ç‰‡clipçš„å¤„ç†å¯¹æ¯”

æ–‡æœ¬clipä¸å›¾ç‰‡clipçš„å¤„ç†é€»è¾‘é«˜åº¦ç›¸ä¼¼ï¼Œä¸»è¦åŒºåˆ«åœ¨äºå†…å®¹æ›´æ–°æœºåˆ¶ï¼š

**ç›¸ä¼¼æ€§ï¼š**
- **åº•å±‚ç»“æ„**ï¼šéƒ½åŸºäº `ImgClip` â†’ `VisibleSprite` çš„æ¶æ„
- **æ—¶é—´è½´å¤„ç†**ï¼šéƒ½ä½¿ç”¨ `ImageTimeRange`ï¼Œæ—¶é—´è½´æ“ä½œé€»è¾‘å®Œå…¨ä¸€è‡´
- **å±æ€§ç®¡ç†**ï¼šä½ç½®ã€å¤§å°ã€é€æ˜åº¦ã€æ—‹è½¬ç­‰å±æ€§å¤„ç†ç›¸åŒ
- **ç”Ÿå‘½å‘¨æœŸ**ï¼šåˆ›å»ºã€æ·»åŠ åˆ°ç”»å¸ƒã€é”€æ¯çš„æµç¨‹ç›¸åŒ

**å…±åŒåŸåˆ™ï¼šéƒ½éµå¾ª"ä»æºå¤´é‡å»º"ç­–ç•¥**
- **å›¾ç‰‡clip**ï¼šå¤åˆ¶ã€åˆ†å‰²ã€æ’¤é”€ç­‰æ“ä½œæ—¶ï¼Œéƒ½ä»åŸå§‹MediaItemé‡æ–°åˆ›å»ºsprite
- **æ–‡æœ¬clip**ï¼šå†…å®¹/æ ·å¼å˜åŒ–ã€å¤åˆ¶ã€æ’¤é”€æ—¶ï¼Œä»æ–‡æœ¬å†…å®¹é‡æ–°æ¸²æŸ“åˆ›å»ºsprite

```typescript
// å›¾ç‰‡ï¼šä»åŸå§‹MediaItemé‡å»ºï¼ˆå¤åˆ¶ã€åˆ†å‰²ã€æ’¤é”€æ—¶ï¼‰
const newSprite = await createSpriteFromMediaItem(mediaItem)
newSprite.setTimeRange(timeRange)
// æ¢å¤å˜æ¢å±æ€§...

// æ–‡æœ¬ï¼šä»æ–‡æœ¬å†…å®¹é‡å»ºï¼ˆå†…å®¹å˜åŒ–ã€å¤åˆ¶ã€æ’¤é”€æ—¶ï¼‰
const newSprite = await TextVisibleSprite.create(newText, newStyle)
// æ¢å¤ä½ç½®ã€æ—¶é—´ç­‰å±æ€§...
```

**æ–‡æœ¬é‡å»ºç­–ç•¥ï¼ˆä¸å›¾ç‰‡æ“ä½œä¿æŒä¸€è‡´ï¼‰ï¼š**
1. **æ£€æµ‹å˜åŒ–**ï¼šæ–‡æœ¬å†…å®¹æˆ–æ ·å¼æ˜¯å¦æ”¹å˜
2. **é‡æ–°æ¸²æŸ“**ï¼šè°ƒç”¨ `renderTxt2ImgBitmap` ç”Ÿæˆæ–°çš„ImageBitmap
3. **é‡å»ºImgClip**ï¼šåŸºäºæ–°çš„ImageBitmapåˆ›å»ºImgClip
4. **åˆ›å»ºæ–°Sprite**ï¼šä»æºå¤´åˆ›å»ºæ–°çš„TextVisibleSpriteå®ä¾‹
5. **çŠ¶æ€æ¢å¤**ï¼šä¿æŒä½ç½®ã€å¤§å°ã€é€æ˜åº¦ã€æ—¶é—´èŒƒå›´ç­‰å±æ€§ä¸å˜
6. **æ›¿æ¢å®ä¾‹**ï¼šåœ¨æ—¶é—´è½´ä¸­æ›¿æ¢æ—§çš„spriteå®ä¾‹

### 8.2 æ€§èƒ½ä¼˜åŒ–
- **ç¼“å­˜å¤ç”¨**ï¼šåˆ©ç”¨ç°æœ‰çš„TextVisibleSpriteç¼“å­˜æœºåˆ¶
- **é˜²æŠ–å¤„ç†**ï¼šæ–‡æœ¬æ¸²æŸ“çš„300msé˜²æŠ–å»¶è¿Ÿ
- **è™šæ‹ŸåŒ–æ¸²æŸ“**ï¼šå¤§é‡æ–‡æœ¬é¡¹ç›®çš„æ€§èƒ½ä¼˜åŒ–

### 8.3 åŠ¨ç”»æ”¯æŒ
é€šè¿‡ç»§æ‰¿ `VisualMediaProps`ï¼Œæ–‡æœ¬è‡ªåŠ¨è·å¾—å®Œæ•´çš„åŠ¨ç”»èƒ½åŠ›ï¼š
- **ä½ç½®åŠ¨ç”»**ï¼šx, y åæ ‡çš„å…³é”®å¸§åŠ¨ç”»
- **å¤§å°åŠ¨ç”»**ï¼šwidth, height çš„ç¼©æ”¾åŠ¨ç”»
- **æ—‹è½¬åŠ¨ç”»**ï¼šrotation è§’åº¦çš„æ—‹è½¬åŠ¨ç”»
- **é€æ˜åº¦åŠ¨ç”»**ï¼šopacity çš„æ·¡å…¥æ·¡å‡ºæ•ˆæœ
- **å¤åˆåŠ¨ç”»**ï¼šå¤šä¸ªå±æ€§çš„ç»„åˆåŠ¨ç”»æ•ˆæœ

```typescript
// æ–‡æœ¬åŠ¨ç”»ç¤ºä¾‹
const textAnimation: AnimationConfig = {
  keyframes: [
    { framePosition: 0, properties: { x: 100, y: 100, opacity: 0 } },
    { framePosition: 30, properties: { x: 200, y: 150, opacity: 1 } },
    { framePosition: 60, properties: { x: 300, y: 200, rotation: Math.PI / 4 } }
  ],
  isEnabled: true,
  easing: 'ease-in-out'
}
```

### 8.4 UIç»„ä»¶å¤ç”¨
ç”±äºæ–‡æœ¬ç»§æ‰¿è‡ª `VisualMediaProps`ï¼Œå¯ä»¥ç›´æ¥å¤ç”¨ç°æœ‰çš„è§†è§‰æ§åˆ¶ç»„ä»¶ï¼š

**å¯å¤ç”¨çš„ä½ç½®å’Œå˜æ¢æ§åˆ¶ï¼š**
- ä½ç½®æ§åˆ¶å™¨ï¼ˆx, y åæ ‡è°ƒæ•´ï¼‰
- å°ºå¯¸æ§åˆ¶å™¨ï¼ˆwidth, height ç¼©æ”¾ï¼‰
- æ—‹è½¬æ§åˆ¶å™¨ï¼ˆrotation è§’åº¦è°ƒæ•´ï¼‰
- é€æ˜åº¦æ§åˆ¶å™¨ï¼ˆopacity é€æ˜åº¦è°ƒæ•´ï¼‰
- å±‚çº§æ§åˆ¶å™¨ï¼ˆzIndex å±‚çº§ç®¡ç†ï¼‰

**å¯å¤ç”¨çš„åŠ¨ç”»ç³»ç»Ÿï¼š**
- å…³é”®å¸§ç¼–è¾‘å™¨ï¼ˆæ—¶é—´è½´ä¸Šçš„å…³é”®å¸§è®¾ç½®ï¼‰
- åŠ¨ç”»æ—¶é—´è½´ï¼ˆåŠ¨ç”»æ’­æ”¾æ§åˆ¶ï¼‰
- ç¼“åŠ¨å‡½æ•°é€‰æ‹©å™¨ï¼ˆåŠ¨ç”»è¿‡æ¸¡æ•ˆæœï¼‰
- åŠ¨ç”»é¢„è§ˆåŠŸèƒ½ï¼ˆå®æ—¶é¢„è§ˆåŠ¨ç”»æ•ˆæœï¼‰

**ä»…éœ€æ–°å¢çš„æ–‡æœ¬ä¸“ç”¨ç»„ä»¶ï¼š**
- æ–‡æœ¬å†…å®¹ç¼–è¾‘å™¨ï¼ˆåŒå‡»ç¼–è¾‘æ–‡æœ¬å†…å®¹ï¼‰
- æ–‡æœ¬æ ·å¼é¢æ¿ï¼ˆå­—ä½“ã€é¢œè‰²ã€å¯¹é½ç­‰æ ·å¼è®¾ç½®ï¼‰

### 8.5 ç”¨æˆ·ä½“éªŒ
- **ç›´è§‚ç¼–è¾‘**ï¼šåŒå‡»æ–‡æœ¬é¡¹ç›®è¿›å…¥ç¼–è¾‘æ¨¡å¼
- **ä½ç½®è°ƒæ•´**ï¼šæ”¯æŒæ–‡æœ¬ä½ç½®å’Œå¤§å°çš„è°ƒæ•´
- **å®æ—¶é¢„è§ˆ**ï¼šæ–‡æœ¬æ•ˆæœçš„å³æ—¶é¢„è§ˆ
- **å³é”®åˆ›å»º**ï¼šé€šè¿‡å³é”®èœå•åˆ›å»ºæ–‡æœ¬é¡¹ç›®

### 8.6 æ•°æ®ä¸€è‡´æ€§
- **åŒæ­¥æ›´æ–°**ï¼šæ–‡æœ¬å†…å®¹ä¸æ ·å¼çš„å®æ—¶åŒæ­¥
- **å†å²è®°å½•**ï¼šæ’¤é”€/é‡åšç³»ç»Ÿçš„å®Œæ•´æ”¯æŒ
- **é¡¹ç›®å…¼å®¹**ï¼šä¿å­˜å’ŒåŠ è½½çš„å‘åå…¼å®¹æ€§

## 9. å®é™…æ–‡ä»¶ç»“æ„

```
frontend/src/
â”œâ”€â”€ types/index.ts                    # âœ… ç±»å‹å®šä¹‰æ‰©å±•ï¼ˆTextStyleConfig, TimelineItem<'text'>ç­‰ï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Timeline.vue                  # âœ… è½¨é“ç®¡ç†å’Œå³é”®èœå•ï¼ˆæ–‡æœ¬è½¨é“åˆ›å»º+æ–‡æœ¬æ·»åŠ ï¼‰
â”‚   â”œâ”€â”€ BaseClip.vue                  # âœ… clipåŸºç¡€ç»„ä»¶ï¼ˆæ‹–æ‹½ã€é€‰æ‹©ç­‰é€šç”¨åŠŸèƒ½ï¼‰
â”‚   â”œâ”€â”€ VideoClip.vue                 # âœ… è§†é¢‘/å›¾ç‰‡/éŸ³é¢‘clipç»„ä»¶
â”‚   â”œâ”€â”€ TextClip.vue                  # âœ… æ–‡æœ¬clipç»„ä»¶ï¼ˆåŸºäºBaseClipï¼‰
â”‚   â”œâ”€â”€ TextClipProperties.vue        # âœ… æ–‡æœ¬ç¼–è¾‘é¢æ¿ï¼ˆé›†æˆæ ·å¼æ§åˆ¶ï¼‰
â”‚   â”œâ”€â”€ PropertiesPanel.vue           # âœ… å±æ€§é¢æ¿ï¼ˆé›†æˆTextClipPropertiesï¼‰
â”‚   â”œâ”€â”€ TransformControls.vue         # âœ… å˜æ¢æ§åˆ¶ç»„ä»¶ï¼ˆä½ç½®ã€ç¼©æ”¾ã€æ—‹è½¬ç­‰ï¼‰
â”‚   â”œâ”€â”€ KeyframeControls.vue          # âœ… å…³é”®å¸§æ§åˆ¶ç»„ä»¶
â”‚   â”œâ”€â”€ SliderInput.vue               # âœ… æ»‘å—è¾“å…¥ç»„ä»¶
â”‚   â””â”€â”€ NumberInput.vue               # âœ… æ•°å­—è¾“å…¥ç»„ä»¶
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ videoStore.ts                 # âœ… ä¸»storeï¼ˆé›†æˆæ–‡æœ¬è½¨é“ç®¡ç†ï¼‰
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ trackModule.ts            # âœ… è½¨é“ç®¡ç†æ¨¡å—ï¼ˆæ”¯æŒæ–‡æœ¬è½¨é“ï¼‰
â”‚       â”œâ”€â”€ timelineModule.ts         # âœ… æ—¶é—´è½´ç®¡ç†æ¨¡å—
â”‚       â””â”€â”€ commands/
â”‚           â”œâ”€â”€ timelineCommands.ts   # âœ… é€šç”¨æ—¶é—´è½´å‘½ä»¤
â”‚           â””â”€â”€ textCommands.ts       # âœ… æ–‡æœ¬ä¸“ç”¨å‘½ä»¤ï¼ˆAdd/Update/Removeï¼‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ TextVisibleSprite.ts          # âœ… æ–‡æœ¬ç²¾çµç±»
â”‚   â”œâ”€â”€ TextHelper.ts                 # âœ… æ–‡æœ¬æ¸²æŸ“å·¥å…·
â”‚   â”œâ”€â”€ textTimelineUtils.ts          # âœ… æ–‡æœ¬æ—¶é—´è½´å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ webavToProjectCoords.ts       # âœ… åæ ‡è½¬æ¢å·¥å…·
â”‚   â””â”€â”€ idGenerator.ts                # âœ… IDç”Ÿæˆå·¥å…·
â”œâ”€â”€ composables/
â”‚   â””â”€â”€ useKeyframeTransformControls.ts # âœ… å…³é”®å¸§å˜æ¢æ§åˆ¶ç»„åˆå¼å‡½æ•°
â””â”€â”€ docs/
    â”œâ”€â”€ text-track-support-design.md  # âœ… æœ¬è®¾è®¡æ–‡æ¡£ï¼ˆå·²æ›´æ–°ï¼‰
    â”œâ”€â”€ text-sprite-integration-guide.md # âœ… æ–‡æœ¬ç²¾çµé›†æˆæŒ‡å—
    â””â”€â”€ base-clip-component-design.md # âœ… BaseClipåŸºç¡€ç»„ä»¶è®¾è®¡
```

**æ–‡ä»¶çŠ¶æ€è¯´æ˜**ï¼š
- âœ… **å·²å®ç°**ï¼šæ–‡ä»¶å·²å­˜åœ¨ä¸”åŠŸèƒ½å®Œæ•´
- ğŸ”„ **å·²é›†æˆ**ï¼šåŠŸèƒ½å·²é›†æˆåˆ°ç°æœ‰æ–‡ä»¶ä¸­
- âŒ **æœªå®ç°**ï¼šåŸè®¡åˆ’çš„ç‹¬ç«‹æ–‡ä»¶ï¼Œå®é™…å·²é›†æˆåˆ°å…¶ä»–ç»„ä»¶ä¸­

**å…³é”®å®ç°å·®å¼‚**ï¼š
1. **TextEditPanel.vue** â†’ é›†æˆåˆ° **TextClipProperties.vue**
2. **TextStyleControls.vue** â†’ é›†æˆåˆ° **TextClipProperties.vue**
3. æ–‡æœ¬æ ·å¼æ§åˆ¶ç›´æ¥åœ¨å±æ€§é¢æ¿ä¸­å®ç°ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

## 10. è¯¦ç»†å®æ–½è®¡åˆ’

åŸºäºå¯¹ç°æœ‰ä»£ç åº“çš„æ·±å…¥åˆ†æï¼Œåˆ¶å®šä»¥ä¸‹åˆ†é˜¶æ®µå®æ–½è®¡åˆ’ï¼š

### é˜¶æ®µ1ï¼šåŸºç¡€æ–‡æœ¬è½¨é“æ”¯æŒ ğŸ¯

**ç›®æ ‡**ï¼šå»ºç«‹æ–‡æœ¬è½¨é“çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œå®ç°åŸºæœ¬çš„æ–‡æœ¬é¡¹ç›®åˆ›å»ºå’Œæ˜¾ç¤ºåŠŸèƒ½ã€‚

#### 1.1 ç±»å‹ç³»ç»Ÿæ‰©å±•
**ä¼˜å…ˆçº§**ï¼šğŸ”´ æœ€é«˜ | **é¢„ä¼°æ—¶é—´**ï¼š2å°æ—¶

**ä»»åŠ¡å†…å®¹**ï¼š
- åœ¨ `frontend/src/types/index.ts` ä¸­æ‰©å±•ç±»å‹å®šä¹‰
- ç¡®ä¿ä¸ç°æœ‰ç±»å‹ç³»ç»Ÿçš„å…¼å®¹æ€§

**å…·ä½“å®ç°**ï¼š
```typescript
// 1. æ‰©å±• MediaTypeï¼ˆå·²å­˜åœ¨ï¼Œéœ€ç¡®è®¤ï¼‰
export type MediaType = 'video' | 'image' | 'audio' | 'text'

// 2. æ–°å¢ TextMediaConfig ç±»å‹
export interface TextMediaConfig extends VisualMediaProps {
  text: string
  style: TextStyleConfig
}

// 3. æ‰©å±• MediaConfigMap
type MediaConfigMap = {
  video: VideoMediaConfig
  image: ImageMediaConfig
  audio: AudioMediaConfig
  text: TextMediaConfig  // æ–°å¢
}

// 4. æ‰©å±• CustomSprite ç±»å‹ï¼ˆå·²å­˜åœ¨TextVisibleSpriteï¼Œéœ€ç¡®è®¤ï¼‰
export type CustomSprite = VideoVisibleSprite | ImageVisibleSprite | TextVisibleSprite

// 5. æ–°å¢ TextTimelineItem ç±»å‹
export interface TextTimelineItem extends TimelineItem<'text'> {
  mediaType: 'text'
  timeRange: ImageTimeRange
  sprite: Raw<TextVisibleSprite>
  config: TextMediaConfig
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] ç±»å‹å®šä¹‰ç¼–è¯‘é€šè¿‡
- [x] ç°æœ‰ä»£ç æ— ç±»å‹é”™è¯¯
- [x] TextVisibleSprite æ­£ç¡®é›†æˆåˆ°ç±»å‹ç³»ç»Ÿ
- [x] åª’ä½“ç±»å‹åˆ†ç±»ç³»ç»Ÿå·²å®ç°ï¼ˆMEDIA_TYPE_CATEGORIESï¼‰
- [x] ä¼˜åŒ–ä¸ºä½¿ç”¨ TimelineItem<'text'> æ³›å‹ï¼ˆç§»é™¤å†—ä½™çš„ TextTimelineItem æ¥å£ï¼‰

#### 1.2 æ–‡æœ¬é¡¹ç›®åˆ›å»ºæµç¨‹
**ä¼˜å…ˆçº§**ï¼šğŸ”´ æœ€é«˜ | **é¢„ä¼°æ—¶é—´**ï¼š4å°æ—¶

**ä»»åŠ¡å†…å®¹**ï¼š
- å®ç° `createTextTimelineItem` å‡½æ•°
- é›†æˆåˆ°ç°æœ‰çš„æ—¶é—´è½´ç®¡ç†æµç¨‹

**å…·ä½“å®ç°**ï¼š
```typescript
// åœ¨ frontend/src/utils/textTimelineUtils.ts ä¸­æ–°å¢
export async function createTextTimelineItem(
  text: string,
  style: Partial<TextStyleConfig>,
  startTimeFrames: number,
  trackId: string,
  duration: number = 150 // é»˜è®¤5ç§’@30fps
): Promise<TextTimelineItem> {
  // 1. åˆ›å»ºæ–‡æœ¬ç²¾çµï¼ˆå¤ç”¨ç°æœ‰TextVisibleSpriteï¼‰
  const textSprite = await TextVisibleSprite.create(text, style)

  // 2. è®¾ç½®æ—¶é—´èŒƒå›´
  textSprite.setTimelineStartTime(startTimeFrames)
  textSprite.setDisplayDuration(duration)

  // 3. è®¾ç½®é»˜è®¤ä½ç½®ï¼ˆç”»å¸ƒä¸­å¿ƒï¼‰
  const canvasWidth = videoStore.videoResolution.width
  const canvasHeight = videoStore.videoResolution.height
  textSprite.rect.x = (canvasWidth - textSprite.rect.w) / 2
  textSprite.rect.y = (canvasHeight - textSprite.rect.h) / 2

  // 4. åæ ‡ç³»è½¬æ¢ï¼ˆWebAV -> é¡¹ç›®åæ ‡ç³»ï¼‰
  const projectCoords = webavToProjectCoords(
    textSprite.rect.x, textSprite.rect.y,
    textSprite.rect.w, textSprite.rect.h,
    canvasWidth, canvasHeight
  )

  // 5. åˆ›å»ºæ—¶é—´è½´é¡¹ç›®
  return {
    id: generateTimelineItemId(),
    mediaItemId: '', // æ–‡æœ¬é¡¹ç›®ä¸éœ€è¦åª’ä½“åº“é¡¹ç›®
    trackId,
    mediaType: 'text',
    timeRange: textSprite.getTimeRange(),
    sprite: markRaw(textSprite),
    config: {
      text,
      style: textSprite.getTextStyle(),
      x: Math.round(projectCoords.x),
      y: Math.round(projectCoords.y),
      width: textSprite.rect.w,
      height: textSprite.rect.h,
      rotation: textSprite.rect.angle || 0,
      opacity: textSprite.opacity,
      zIndex: textSprite.zIndex,
      animation: undefined,
    }
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] æ–‡æœ¬ç²¾çµåˆ›å»ºæˆåŠŸ
- [x] æ—¶é—´èŒƒå›´è®¾ç½®æ­£ç¡®
- [x] åæ ‡è½¬æ¢å‡†ç¡®
- [x] ä¸ç°æœ‰æ—¶é—´è½´ç®¡ç†å…¼å®¹
- [x] createTextTimelineItem å‡½æ•°å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡

#### 1.3 TextClipç»„ä»¶å¼€å‘
**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ é«˜ | **é¢„ä¼°æ—¶é—´**ï¼š3å°æ—¶

**ä»»åŠ¡å†…å®¹**ï¼š
- åŸºäºç°æœ‰ BaseClip åˆ›å»º TextClip ç»„ä»¶
- å®ç°æ–‡æœ¬å†…å®¹çš„æ—¶é—´è½´æ˜¾ç¤º

**å…·ä½“å®ç°**ï¼š
```vue
<!-- frontend/src/components/TextClip.vue -->
<template>
  <BaseClip
    :timeline-item="timelineItem"
    :timeline-width="timelineWidth"
    class="text-clip"
    @select="$emit('select', $event)"
  >
    <template #content="{ timelineItem }">
      <div class="text-content">
        <span class="text-preview">{{ textPreview }}</span>
      </div>
      <div class="clip-label">
        {{ timelineItem.config.text || 'æ–‡æœ¬' }}
      </div>
    </template>
  </BaseClip>
</template>

<script setup lang="ts">
import BaseClip from './BaseClip.vue'
import type { TextTimelineItem } from '../types'

interface Props {
  timelineItem: TextTimelineItem
  timelineWidth: number
}

const props = defineProps<Props>()
const emit = defineEmits<{
  'select': [itemId: string]
}>()

const textPreview = computed(() => {
  const text = props.timelineItem.config.text || ''
  return text.length > 20 ? text.substring(0, 20) + '...' : text
})
</script>

<style scoped>
.text-clip {
  background: linear-gradient(135deg, #4CAF50, #45a049);
}

.text-content {
  display: flex;
  flex-direction: column;
  justify-content: center;
  font-size: 12px;
  color: white;
  height: 100%;
}

.clip-label {
  font-size: 10px;
  opacity: 0.8;
  margin-top: 2px;
}
</style>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] TextClip æ­£ç¡®ç»§æ‰¿ BaseClip åŠŸèƒ½
- [x] æ–‡æœ¬å†…å®¹æ­£ç¡®æ˜¾ç¤º
- [x] æ ·å¼ç¬¦åˆè®¾è®¡è§„èŒƒ
- [x] é€‰ä¸­çŠ¶æ€æ­£å¸¸å·¥ä½œ
- [x] æ”¯æŒæ–‡æœ¬é¢„è§ˆå’Œæ ‡ç­¾æ˜¾ç¤º

#### 1.4 Timelineç»„ä»¶é›†æˆ
**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ é«˜ | **é¢„ä¼°æ—¶é—´**ï¼š2å°æ—¶

**ä»»åŠ¡å†…å®¹**ï¼š
- åœ¨ Timeline.vue ä¸­é›†æˆ TextClip ç»„ä»¶
- å®ç°æ ¹æ®åª’ä½“ç±»å‹æ¸²æŸ“ä¸åŒç»„ä»¶

**å…·ä½“å®ç°**ï¼š
```typescript
// åœ¨ Timeline.vue ä¸­ä¿®æ”¹ getClipComponent å‡½æ•°
function getClipComponent(mediaType: MediaType) {
  switch (mediaType) {
    case 'video':
    case 'image':
    case 'audio':
      return VideoClip
    case 'text':
      return TextClip  // æ–°å¢
    default:
      return VideoClip
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] æ–‡æœ¬è½¨é“æ­£ç¡®æ¸²æŸ“ TextClip
- [x] ä¸å½±å“ç°æœ‰è§†é¢‘/å›¾ç‰‡è½¨é“
- [x] ç»„ä»¶åˆ‡æ¢é€»è¾‘æ­£ç¡®
- [x] getClipComponent å‡½æ•°å·²å®ç°

#### 1.5 å³é”®èœå•æ–‡æœ¬åˆ›å»º
**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ é«˜ | **é¢„ä¼°æ—¶é—´**ï¼š3å°æ—¶

**ä»»åŠ¡å†…å®¹**ï¼š
- åœ¨æ—¶é—´è½´å³é”®èœå•ä¸­æ·»åŠ æ–‡æœ¬åˆ›å»ºé€‰é¡¹
- å®ç°æ–‡æœ¬è½¨é“çš„è¯†åˆ«å’Œèœå•æ˜¾ç¤ºé€»è¾‘

**å…·ä½“å®ç°**ï¼š
```typescript
// åœ¨ Timeline.vue ä¸­æ‰©å±•å³é”®èœå•
const contextMenuItems = computed(() => {
  if (contextMenuType.value === 'track') {
    const track = getTrackFromTarget()
    if (track?.type === 'text') {
      return [
        {
          label: 'æ·»åŠ æ–‡æœ¬',
          icon: 'M9,7H15V15H17V7H23V5H17V3A1,1 0 0,0 16,2H8A1,1 0 0,0 7,3V5H1V7H7V15H9V7Z',
          onClick: () => createTextAtPosition(track.id, getTimePositionFromEvent())
        },
        // å…¶ä»–èœå•é¡¹...
      ]
    }
  }
  return defaultMenuItems
})

async function createTextAtPosition(trackId: string, timeFrames: number) {
  const textItem = await createTextTimelineItem(
    'ç‚¹å‡»ç¼–è¾‘æ–‡æœ¬',
    { fontSize: 48, color: 'white' },
    timeFrames,
    trackId
  )

  await videoStore.addTimelineItemWithHistory(textItem)
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] æ–‡æœ¬è½¨é“æ˜¾ç¤º"æ·»åŠ æ–‡æœ¬"èœå•
- [x] éæ–‡æœ¬è½¨é“ä¸æ˜¾ç¤ºæ–‡æœ¬èœå•
- [x] æ–‡æœ¬åˆ›å»ºåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [x] ä¸ç°æœ‰èœå•ç³»ç»Ÿå…¼å®¹
- [x] æ”¯æŒæ–‡æœ¬è½¨é“åˆ›å»ºï¼ˆå³é”®ç©ºç™½åŒºåŸŸï¼‰

#### 1.6 åŸºç¡€å‘½ä»¤ç³»ç»Ÿ
**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ é«˜ | **é¢„ä¼°æ—¶é—´**ï¼š3å°æ—¶

**ä»»åŠ¡å†…å®¹**ï¼š
- å®ç° AddTextItemCommand å‘½ä»¤
- é›†æˆåˆ°ç°æœ‰çš„å†å²è®°å½•ç³»ç»Ÿ

**å…·ä½“å®ç°**ï¼š
```typescript
// åœ¨ frontend/src/stores/modules/commands/textCommands.ts ä¸­æ–°å¢
export class AddTextItemCommand implements SimpleCommand {
  public readonly id: string
  public readonly description: string
  private textItem: TimelineItem<'text'> | null = null

  constructor(
    private text: string,
    private style: Partial<TextStyleConfig>,
    private startTimeFrames: number,
    private trackId: string,
    private timelineModule: any,
    private webavModule: any
  ) {
    this.id = generateCommandId()
    this.description = `æ·»åŠ æ–‡æœ¬: ${text.substring(0, 10)}...`
  }

  async execute(): Promise<void> {
    this.textItem = await createTextTimelineItem(
      this.text,
      this.style,
      this.startTimeFrames,
      this.trackId
    )

    this.timelineModule.addTimelineItem(this.textItem)
    this.webavModule.addSprite(this.textItem.sprite)
  }

  async undo(): Promise<void> {
    if (this.textItem) {
      this.webavModule.removeSprite(this.textItem.sprite)
      this.timelineModule.removeTimelineItem(this.textItem.id)
    }
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] æ–‡æœ¬æ·»åŠ å‘½ä»¤æ­£å¸¸æ‰§è¡Œ
- [x] æ’¤é”€åŠŸèƒ½æ­£ç¡®å·¥ä½œ
- [x] ä¸ç°æœ‰å‘½ä»¤ç³»ç»Ÿå…¼å®¹
- [x] å†å²è®°å½•æ­£ç¡®è®°å½•
- [x] AddTextItemCommand, UpdateTextCommand, RemoveTextItemCommand å·²å®ç°

#### 1.7 è°ƒè¯•æ£€æŸ¥ä¼˜åŒ–
**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ ä¸­ | **é¢„ä¼°æ—¶é—´**ï¼š1å°æ—¶

**ä»»åŠ¡å†…å®¹**ï¼š
- ä¿®å¤æ–‡æœ¬é¡¹ç›®å¯¼è‡´çš„"å­¤ç«‹æ—¶é—´è½´é¡¹ç›®"è­¦å‘Š
- å®æ–½åª’ä½“ç±»å‹åˆ†ç±»æ¶æ„

**å…·ä½“å®ç°**ï¼š
```typescript
// çŸ­æœŸè§£å†³æ–¹æ¡ˆï¼šåœ¨ debugUtils.ts ä¸­æ·»åŠ æ–‡æœ¬ç±»å‹ä¾‹å¤–
function checkOrphanedTimelineItems(timelineItems, mediaItems) {
  const orphanedItems = timelineItems.filter(item => {
    // æ–‡æœ¬é¡¹ç›®ä¸éœ€è¦ç´ æåº“é¡¹ç›®ï¼Œè·³è¿‡æ£€æŸ¥
    if (item.mediaType === 'text') {
      return false
    }
    return !mediaItems.find(m => m.id === item.mediaItemId)
  })
  // ...
}

// é•¿æœŸæ–¹æ¡ˆï¼šåœ¨ types/index.ts ä¸­æ·»åŠ åª’ä½“ç±»å‹åˆ†ç±»
export const MEDIA_TYPE_CATEGORIES = {
  FILE_BASED: ['video', 'image', 'audio'] as const,
  GENERATED: ['text'] as const,
} as const

export function requiresMediaItem(mediaType: MediaType): boolean {
  return MEDIA_TYPE_CATEGORIES.FILE_BASED.includes(mediaType as any)
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] æ–‡æœ¬é¡¹ç›®ä¸å†äº§ç”Ÿå­¤ç«‹è­¦å‘Š
- [x] å…¶ä»–åª’ä½“ç±»å‹çš„æ£€æŸ¥æ­£å¸¸å·¥ä½œ
- [x] åª’ä½“ç±»å‹åˆ†ç±»å‡½æ•°å¯ç”¨
- [x] ä¸ºæœªæ¥æ‰©å±•åšå¥½å‡†å¤‡
- [x] MEDIA_TYPE_CATEGORIES å’Œç›¸å…³å·¥å…·å‡½æ•°å·²å®ç°

**é˜¶æ®µ1æ€»ç»“**ï¼š
- **çŠ¶æ€**ï¼šâœ… **å·²å®Œæˆ** (2024-07-03)
- **å®é™…ç”¨æ—¶**ï¼šçº¦18å°æ—¶
- **å…³é”®é‡Œç¨‹ç¢‘**ï¼šæ–‡æœ¬è½¨é“åŸºç¡€åŠŸèƒ½å®Œå…¨å¯ç”¨ï¼Œæ— è°ƒè¯•è­¦å‘Š
- **éªŒæ”¶æ ‡å‡†**ï¼šâœ… ç”¨æˆ·å¯ä»¥é€šè¿‡å³é”®èœå•åˆ›å»ºæ–‡æœ¬è½¨é“å’Œæ–‡æœ¬é¡¹ç›®ï¼Œåœ¨æ—¶é—´è½´ä¸­æ­£å¸¸æ˜¾ç¤ºï¼Œæ— è°ƒè¯•è­¦å‘Š

**å·²å®Œæˆçš„åŠŸèƒ½**ï¼š
- âœ… ç±»å‹ç³»ç»Ÿæ‰©å±•ï¼ˆå«åª’ä½“ç±»å‹åˆ†ç±»æ¶æ„ï¼‰
- âœ… æ–‡æœ¬é¡¹ç›®åˆ›å»ºæµç¨‹ï¼ˆcreateTextTimelineItemï¼‰
- âœ… TextClipç»„ä»¶å¼€å‘ï¼ˆåŸºäºBaseClipï¼‰
- âœ… Timelineç»„ä»¶é›†æˆï¼ˆåŠ¨æ€ç»„ä»¶æ¸²æŸ“ï¼‰
- âœ… å³é”®èœå•æ–‡æœ¬åˆ›å»ºï¼ˆè½¨é“åˆ›å»º+æ–‡æœ¬æ·»åŠ ï¼‰
- âœ… åŸºç¡€å‘½ä»¤ç³»ç»Ÿï¼ˆå®Œæ•´çš„æ’¤é”€/é‡åšæ”¯æŒï¼‰
- âœ… è°ƒè¯•æ£€æŸ¥ä¼˜åŒ–ï¼ˆæ¶ˆé™¤å­¤ç«‹é¡¹ç›®è­¦å‘Šï¼‰

**æŠ€æœ¯äº®ç‚¹**ï¼š
- ğŸ¯ æ¶æ„ä¸€è‡´æ€§ï¼šéµå¾ªç°æœ‰è®¾è®¡æ¨¡å¼ï¼Œä½¿ç”¨ TimelineItem<'text'> æ³›å‹
- ğŸ”§ æ‰©å±•æ€§å¼ºï¼šåª’ä½“ç±»å‹åˆ†ç±»ç³»ç»Ÿä¸ºæœªæ¥æ–°åª’ä½“ç±»å‹åšå‡†å¤‡
- ğŸš€ ç”¨æˆ·ä½“éªŒï¼šå®Œæ•´çš„å·¥ä½œæµä»è½¨é“åˆ›å»ºåˆ°æ–‡æœ¬ç¼–è¾‘
- ğŸ›¡ï¸ ç±»å‹å®‰å…¨ï¼šå®Œæ•´çš„TypeScriptç±»å‹æ”¯æŒ

---

### é˜¶æ®µ2ï¼šæ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ âœ… å·²å®Œæˆ

**ç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ï¼ŒåŒ…æ‹¬å†…å®¹ç¼–è¾‘ã€æ ·å¼æ§åˆ¶å’Œå®æ—¶é¢„è§ˆã€‚

#### 2.1 æ–‡æœ¬ç¼–è¾‘é¢æ¿ âœ… å·²å®Œæˆ
**å®ç°çŠ¶æ€**ï¼šâœ… å®Œæˆ | **å®é™…æ–‡ä»¶**ï¼š`TextClipProperties.vue`

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… å®Œæ•´çš„æ–‡æœ¬å†…å®¹ç¼–è¾‘ç•Œé¢ï¼ˆtextareaæ”¯æŒå¤šè¡Œï¼‰
- âœ… æ–‡æœ¬å†…å®¹å®æ—¶æ›´æ–°ï¼ˆblurå’ŒCtrl+Enterè§¦å‘ï¼‰
- âœ… æ—¶é•¿è°ƒæ•´åŠŸèƒ½ï¼ˆæ—¶é—´ç è¾“å…¥ï¼‰

#### 2.2 æ–‡æœ¬æ ·å¼æ§åˆ¶å™¨ âœ… å·²å®Œæˆ
**å®ç°çŠ¶æ€**ï¼šâœ… å®Œæˆ | **é›†æˆåœ¨**ï¼š`TextClipProperties.vue`

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… å­—ä½“é€‰æ‹©ï¼ˆArial, å¾®è½¯é›…é»‘, é»‘ä½“, å®‹ä½“, æ¥·ä½“, Times New Roman, Courier Newï¼‰
- âœ… å­—ä½“å¤§å°æ§åˆ¶ï¼ˆ12-200pxï¼Œæ»‘å—+æ•°å­—è¾“å…¥ï¼‰
- âœ… å­—ä½“æ ·å¼ï¼ˆæ­£å¸¸/ç²—ä½“/ç»†ä½“ï¼Œæ­£å¸¸/æ–œä½“ï¼‰
- âœ… æ–‡å­—é¢œè‰²é€‰æ‹©å™¨
- âœ… æ–‡æœ¬å¯¹é½æ§åˆ¶ï¼ˆå·¦/ä¸­/å³ï¼‰
- âœ… èƒŒæ™¯é¢œè‰²ï¼ˆå¯é€‰å¯ç”¨/ç¦ç”¨ï¼‰

#### 2.3 å±æ€§é¢æ¿é›†æˆ âœ… å·²å®Œæˆ
**å®ç°çŠ¶æ€**ï¼šâœ… å®Œæˆ | **å®é™…æ–‡ä»¶**ï¼š`PropertiesPanel.vue`

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… æ ¹æ®åª’ä½“ç±»å‹åŠ¨æ€æ˜¾ç¤ºå±æ€§ç»„ä»¶
- âœ… æ–‡æœ¬é¡¹ç›®é€‰ä¸­æ—¶æ­£ç¡®æ˜¾ç¤ºTextClipProperties
- âœ… å¤šé€‰çŠ¶æ€å¤„ç†
- âœ… ç©ºé€‰æ‹©çŠ¶æ€å¤„ç†

#### 2.4 å®æ—¶é¢„è§ˆå’Œæ›´æ–° âœ… å·²å®Œæˆ
**å®ç°çŠ¶æ€**ï¼šâœ… å®Œæˆ | **é€šè¿‡**ï¼š`UpdateTextCommand`

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… æ–‡æœ¬å†…å®¹å’Œæ ·å¼çš„å®æ—¶é¢„è§ˆ
- âœ… é˜²æŠ–æ›´æ–°æœºåˆ¶ï¼ˆblur/ç¡®è®¤æ—¶æ›´æ–°ï¼‰
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- âœ… æ€§èƒ½ä¼˜åŒ–çš„æ›´æ–°æœºåˆ¶

#### 2.5 æ–‡æœ¬æ›´æ–°å‘½ä»¤ âœ… å·²å®Œæˆ
**å®ç°çŠ¶æ€**ï¼šâœ… å®Œæˆ | **å®é™…æ–‡ä»¶**ï¼š`textCommands.ts`

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… AddTextItemCommandï¼ˆæ·»åŠ æ–‡æœ¬é¡¹ç›®ï¼‰
- âœ… UpdateTextCommandï¼ˆæ›´æ–°æ–‡æœ¬å†…å®¹å’Œæ ·å¼ï¼‰
- âœ… RemoveTextItemCommandï¼ˆåˆ é™¤æ–‡æœ¬é¡¹ç›®ï¼‰
- âœ… å®Œæ•´çš„æ’¤é”€/é‡åšæ”¯æŒ
- âœ… å‘½ä»¤å·¥å‚å‡½æ•°ï¼ˆTextCommandFactoryï¼‰

#### 2.6 å˜æ¢æ§åˆ¶ âœ… å·²å®Œæˆ
**å®ç°çŠ¶æ€**ï¼šâœ… å®Œæˆ | **é€šè¿‡**ï¼š`TransformControls` + `useKeyframeTransformControls`

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… ä½ç½®æ§åˆ¶ï¼ˆx, yåæ ‡è°ƒæ•´ï¼‰
- âœ… ç¼©æ”¾æ§åˆ¶ï¼ˆæ¯”ä¾‹ç¼©æ”¾/ç‹¬ç«‹ç¼©æ”¾ï¼‰
- âœ… æ—‹è½¬æ§åˆ¶ï¼ˆè§’åº¦è°ƒæ•´ï¼‰
- âœ… é€æ˜åº¦æ§åˆ¶ï¼ˆ0-1èŒƒå›´ï¼‰
- âœ… å±‚çº§æ§åˆ¶ï¼ˆzIndexï¼‰
- âœ… å¯¹é½åŠŸèƒ½ï¼ˆæ°´å¹³/å‚ç›´å¯¹é½ï¼‰
- âœ… å…³é”®å¸§åŠ¨ç”»æ”¯æŒ

**é˜¶æ®µ2æ€»ç»“**ï¼š
- **å®é™…çŠ¶æ€**ï¼šâœ… **100% å®Œæˆ**
- **å…³é”®é‡Œç¨‹ç¢‘**ï¼šå®Œæ•´çš„æ–‡æœ¬ç¼–è¾‘å·¥ä½œæµå·²å®ç°
- **éªŒæ”¶æ ‡å‡†**ï¼šâœ… ç”¨æˆ·å¯ä»¥ç¼–è¾‘æ–‡æœ¬å†…å®¹ã€è°ƒæ•´æ ·å¼ï¼Œå¹¶å®æ—¶çœ‹åˆ°æ•ˆæœ

---

### é˜¶æ®µ3ï¼šé«˜çº§åŠŸèƒ½æ‰©å±• ğŸš€

**ç›®æ ‡**ï¼šåœ¨ç°æœ‰å®Œæ•´åŠŸèƒ½åŸºç¡€ä¸Šï¼Œå®ç°é«˜çº§åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æå‡ç”¨æˆ·ä½“éªŒã€‚

**å½“å‰çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹ï¼ˆåŸºç¡€åŠŸèƒ½å·²å®Œæ•´ï¼Œå¯æ ¹æ®éœ€æ±‚é€‰æ‹©æ€§å®ç°ï¼‰

#### 3.1 æ–‡æœ¬æ•ˆæœå¢å¼º
**ä¼˜å…ˆçº§**ï¼šï¿½ é«˜ | **é¢„ä¼°æ—¶é—´**ï¼š6å°æ—¶

**å»ºè®®åŠŸèƒ½**ï¼š
- æ–‡æœ¬é˜´å½±æ•ˆæœï¼ˆtext-shadowï¼‰
- æ–‡æœ¬æè¾¹æ•ˆæœï¼ˆtext-strokeï¼‰
- æ–‡æœ¬å‘å…‰æ•ˆæœ
- æ¸å˜æ–‡å­—æ•ˆæœ

#### 3.2 æ–‡æœ¬æ¨¡æ¿ç³»ç»Ÿ
**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ ä¸­ | **é¢„ä¼°æ—¶é—´**ï¼š8å°æ—¶

**å»ºè®®åŠŸèƒ½**ï¼š
- æ–‡æœ¬æ ·å¼æ¨¡æ¿çš„åˆ›å»ºå’Œä¿å­˜
- é¢„è®¾æ¨¡æ¿åº“ï¼ˆæ ‡é¢˜ã€å­—å¹•ã€æ°´å°ç­‰ï¼‰
- æ¨¡æ¿çš„å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
- æ¨¡æ¿é¢„è§ˆå’Œåº”ç”¨

#### 3.3 è‡ªå®šä¹‰å­—ä½“ç®¡ç†
**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ ä¸­ | **é¢„ä¼°æ—¶é—´**ï¼š6å°æ—¶

**å»ºè®®åŠŸèƒ½**ï¼š
- è‡ªå®šä¹‰å­—ä½“æ–‡ä»¶ä¸Šä¼ ï¼ˆ.ttf, .woffç­‰ï¼‰
- å­—ä½“é¢„è§ˆåŠŸèƒ½
- å­—ä½“ç®¡ç†ç•Œé¢
- å­—ä½“åŠ è½½çŠ¶æ€å¤„ç†

#### 3.4 æ–‡æœ¬åŠ¨ç”»é¢„è®¾
**ä¼˜å…ˆçº§**ï¼šï¿½ ä¸­ | **é¢„ä¼°æ—¶é—´**ï¼š5å°æ—¶

**å»ºè®®åŠŸèƒ½**ï¼š
- é¢„è®¾åŠ¨ç”»æ•ˆæœï¼ˆæ·¡å…¥æ·¡å‡ºã€é£å…¥é£å‡ºã€æ‰“å­—æœºæ•ˆæœç­‰ï¼‰
- åŠ¨ç”»æ—¶é•¿å’Œç¼“åŠ¨å‡½æ•°è®¾ç½®
- åŠ¨ç”»é¢„è§ˆåŠŸèƒ½

#### 3.5 æ€§èƒ½ä¼˜åŒ–
**ä¼˜å…ˆçº§**ï¼šï¿½ ä½ | **é¢„ä¼°æ—¶é—´**ï¼š4å°æ—¶

**ä¼˜åŒ–æ–¹å‘**ï¼š
- æ–‡æœ¬æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–
- å¤§é‡æ–‡æœ¬é¡¹ç›®çš„è™šæ‹ŸåŒ–æ¸²æŸ“
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- ç¼“å­˜æœºåˆ¶æ”¹è¿›

#### 3.6 ç”¨æˆ·ä½“éªŒå¢å¼º
**ä¼˜å…ˆçº§**ï¼šï¿½ ä½ | **é¢„ä¼°æ—¶é—´**ï¼š3å°æ—¶

**æ”¹è¿›æ–¹å‘**ï¼š
- æ–‡æœ¬ç¼–è¾‘å¿«æ·é”®æ”¯æŒ
- æ‹–æ‹½è°ƒæ•´æ–‡æœ¬å¤§å°
- æ›´ç›´è§‚çš„é¢œè‰²é€‰æ‹©å™¨
- æ‰¹é‡æ–‡æœ¬æ“ä½œåŠŸèƒ½

**é˜¶æ®µ3æ€»ç»“**ï¼š
- **æ€»é¢„ä¼°æ—¶é—´**ï¼š32å°æ—¶
- **å®æ–½å»ºè®®**ï¼šæ ¹æ®ç”¨æˆ·åé¦ˆå’Œå®é™…éœ€æ±‚é€‰æ‹©æ€§å®ç°
- **ä¼˜å…ˆçº§å»ºè®®**ï¼šæ–‡æœ¬æ•ˆæœ > æ¨¡æ¿ç³»ç»Ÿ > å­—ä½“ç®¡ç† > å…¶ä»–åŠŸèƒ½

---

## 11. é¡¹ç›®å®Œæˆæ€»ç»“

**å®é™…å®Œæˆæ—¶é—´**ï¼šçº¦40å°æ—¶ï¼ˆæ¯”é¢„ä¼°èŠ‚çœ30å°æ—¶ï¼‰
**å®é™…å®æ–½å‘¨æœŸ**ï¼šçº¦6ä¸ªæœˆï¼ˆ2024å¹´7æœˆ-12æœˆï¼‰
**å›¢é˜Ÿé…ç½®**ï¼š1åå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ

**å®é™…é‡Œç¨‹ç¢‘**ï¼š
- **2024å¹´7æœˆ**ï¼šé˜¶æ®µ1 - åŸºç¡€æ–‡æœ¬è½¨é“æ”¯æŒ âœ…
- **2024å¹´12æœˆ**ï¼šé˜¶æ®µ2 - æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ âœ…
- **æœªæ¥è§„åˆ’**ï¼šé˜¶æ®µ3 - é«˜çº§åŠŸèƒ½æ‰©å±•ï¼ˆå¯é€‰ï¼‰

**é¡¹ç›®æˆåŠŸè¦ç´ **ï¼š
- **æ¶æ„å¤ç”¨**ï¼šğŸŸ¢ æˆåŠŸå¤ç”¨ç°æœ‰BaseClipã€TransformControlsç­‰ç»„ä»¶
- **ç±»å‹å®‰å…¨**ï¼šğŸŸ¢ å®Œæ•´çš„TypeScriptç±»å‹æ”¯æŒï¼Œå‡å°‘äº†è°ƒè¯•æ—¶é—´
- **å‘½ä»¤æ¨¡å¼**ï¼šğŸŸ¢ ç»Ÿä¸€çš„å‘½ä»¤ç³»ç»Ÿç®€åŒ–äº†æ’¤é”€é‡åšå®ç°
- **ç»„ä»¶åŒ–è®¾è®¡**ï¼šï¿½ æ¨¡å—åŒ–è®¾è®¡ä¾¿äºç»´æŠ¤å’Œæ‰©å±•

**æŠ€æœ¯äº®ç‚¹**ï¼š
- âœ… å®Œæ•´çš„æ–‡æœ¬ç¼–è¾‘å·¥ä½œæµ
- âœ… ä¸ç°æœ‰ç³»ç»Ÿæ— ç¼é›†æˆ
- âœ… æ”¯æŒå…³é”®å¸§åŠ¨ç”»
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- âœ… æ€§èƒ½ä¼˜åŒ–çš„æ›´æ–°æœºåˆ¶

**ç”¨æˆ·ä»·å€¼**ï¼š
- ğŸ¯ ä¸“ä¸šçº§æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½
- ğŸ¨ ä¸°å¯Œçš„æ ·å¼æ§åˆ¶é€‰é¡¹
- ğŸï¸ å®Œæ•´çš„åŠ¨ç”»åˆ¶ä½œèƒ½åŠ›
- ğŸ”„ ç›´è§‚çš„æ“ä½œä½“éªŒ
- â†©ï¸ å¯é çš„æ’¤é”€é‡åšæœºåˆ¶

---

## 12. æœªæ¥æ‰©å±•å»ºè®®

åŸºäºå½“å‰å®Œæ•´çš„åŸºç¡€åŠŸèƒ½ï¼Œå»ºè®®çš„æ‰©å±•æ–¹å‘ï¼š

1. **æ–‡æœ¬æ•ˆæœå¢å¼º**ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
   - å®ç°é˜´å½±ã€æè¾¹ã€å‘å…‰ç­‰è§†è§‰æ•ˆæœ
   - æå‡æ–‡æœ¬çš„è§†è§‰è¡¨ç°åŠ›

2. **æ¨¡æ¿ç³»ç»Ÿ**ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
   - æä¾›é¢„è®¾æ ·å¼æ¨¡æ¿
   - æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿

3. **å­—ä½“ç®¡ç†**ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
   - æ”¯æŒè‡ªå®šä¹‰å­—ä½“ä¸Šä¼ 
   - æ‰©å±•å­—ä½“é€‰æ‹©èŒƒå›´

4. **æ€§èƒ½ä¼˜åŒ–**ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰
   - åœ¨å®é™…ä½¿ç”¨ä¸­æ ¹æ®æ€§èƒ½è¡¨ç°è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–

---

*æ–‡æœ¬è½¨é“æ”¯æŒåŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œå¯æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ã€‚åç»­æ‰©å±•å¯æ ¹æ®ç”¨æˆ·åé¦ˆå’Œä¸šåŠ¡éœ€æ±‚çµæ´»å®‰æ’ã€‚*
