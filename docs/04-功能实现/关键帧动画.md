# å…³é”®å¸§åŠ¨ç”»ç³»ç»Ÿ

## ğŸ“‹ æ¦‚è¿°

å…³é”®å¸§åŠ¨ç”»ç³»ç»Ÿæ˜¯è§†é¢‘ç¼–è¾‘å™¨çš„é«˜çº§åŠŸèƒ½ï¼ŒåŸºäºWebAVåŸç”Ÿçš„setAnimation APIå®ç°ä¸“ä¸šçº§çš„å±æ€§åŠ¨ç”»ç¼–è¾‘ã€‚ç³»ç»Ÿå®Œå…¨ä¾èµ–WebAVçš„30FPSæ¸²æŸ“å¾ªç¯å’Œçº¿æ€§æ’å€¼ç®—æ³•ï¼Œæä¾›é«˜æ€§èƒ½çš„å®æ—¶åŠ¨ç”»æ•ˆæœã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒåŠŸèƒ½
- **WebAVåŸç”Ÿé©±åŠ¨**ï¼šç›´æ¥ä½¿ç”¨WebAVçš„setAnimation APIï¼Œæ— éœ€è‡ªå»ºæ’å€¼ç³»ç»Ÿ
- **å…³é”®å¸§ç¼–è¾‘**ï¼šåœ¨æ—¶é—´è½´ä¸Šè®¾ç½®å’Œç¼–è¾‘å…³é”®å¸§
- **å±æ€§åŠ¨ç”»**ï¼šæ”¯æŒä½ç½®ã€å¤§å°ã€æ—‹è½¬ã€é€æ˜åº¦ç­‰å±æ€§çš„åŠ¨ç”»
- **æ—¶é—´è½´åŒæ­¥**ï¼šåŠ¨ç”»durationä¸clipæ—¶é•¿ä¿æŒä¸€è‡´
- **å®æ—¶é¢„è§ˆ**ï¼šåŸºäºWebAV 30FPSæ¸²æŸ“å¾ªç¯çš„å®æ—¶åŠ¨ç”»æ•ˆæœ

### ç”¨æˆ·ä½“éªŒ
- **ç›´è§‚æ“ä½œ**ï¼šç±»ä¼¼ä¸“ä¸šè§†é¢‘ç¼–è¾‘è½¯ä»¶çš„æ“ä½œä½“éªŒ
- **å¯è§†åŒ–ç¼–è¾‘**ï¼šå›¾å½¢åŒ–çš„å…³é”®å¸§æ—¶é—´è½´
- **ç²¾ç¡®æ§åˆ¶**ï¼šç²¾ç¡®åˆ°å¸§çš„æ—¶é—´æ§åˆ¶
- **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒå¤šä¸ªå…³é”®å¸§çš„æ‰¹é‡ç¼–è¾‘

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### WebAVåŠ¨ç”»ç³»ç»Ÿåˆ†æ

#### WebAVæ ¸å¿ƒç±»å‹
```typescript
// WebAVåŠ¨ç”»é…ç½®æ¥å£
interface IAnimationOpts {
  duration: number;  // åŠ¨ç”»æŒç»­æ—¶é—´ï¼ˆå¾®ç§’ï¼‰
  delay?: number;    // å»¶è¿Ÿæ—¶é—´ï¼ˆå¾®ç§’ï¼‰
  iterCount?: number; // è¿­ä»£æ¬¡æ•°
}

// WebAVå¯åŠ¨ç”»å±æ€§
type TAnimateProps = IRectBaseProps & { opacity: number };
// IRectBaseProps åŒ…å«: x, y, w, h, angle

// WebAVå…³é”®å¸§æ ¼å¼
type TKeyFrameOpts = Partial<
  Record<`${number}%` | 'from' | 'to', Partial<TAnimateProps>>
>;
```

#### WebAVåŠ¨ç”»æ‰§è¡ŒåŸç†
```typescript
// 1. è®¾ç½®åŠ¨ç”»
sprite.setAnimation({
  '0%': { x: 0, y: 0 },
  '50%': { x: 500, y: 300 },
  '100%': { x: 1000, y: 0 }
}, {
  duration: 4e6,    // 4ç§’
  iterCount: 1      // æ‰§è¡Œä¸€æ¬¡
});

// 2. WebAVè‡ªåŠ¨æ‰§è¡Œï¼ˆ30FPSæ¸²æŸ“å¾ªç¯ï¼‰
// - æ¯å¸§è°ƒç”¨ sprite.animate(time)
// - çº¿æ€§æ’å€¼è®¡ç®—å½“å‰å±æ€§å€¼
// - è‡ªåŠ¨æ›´æ–°spriteçš„rectå’Œopacity
// - Canvasé‡æ–°ç»˜åˆ¶
```

#### å…³é”®å¸§æ•°æ®ç»“æ„
```typescript
interface Keyframe {
  id: string
  time: number        // æ—¶é—´ï¼ˆç§’ï¼‰
  value: any         // å±æ€§å€¼
  easing: EasingType // ç¼“åŠ¨å‡½æ•°
  property: string   // å±æ€§åç§°
  spriteId: string   // æ‰€å±ç²¾çµID
}

interface AnimationTrack {
  id: string
  property: string   // åŠ¨ç”»å±æ€§ï¼ˆx, y, scaleX, scaleY, rotation, opacityï¼‰
  keyframes: Keyframe[]
  isVisible: boolean
  isLocked: boolean
}

interface AnimationClip {
  id: string
  spriteId: string
  tracks: AnimationTrack[]
  duration: number
  isEnabled: boolean
}
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•°æ®å±‚è®¾è®¡

#### é¡¹ç›®å…³é”®å¸§æ•°æ®ç»“æ„
```typescript
// é¡¹ç›®å†…éƒ¨å…³é”®å¸§æ ¼å¼ï¼ˆå¯¹æ ‡WebAVæ ¼å¼ï¼‰
interface ProjectKeyFrame {
  id: string
  time: number  // ç›¸å¯¹æ—¶é—´ï¼ˆ0-1ä¹‹é—´ï¼Œå¯¹åº”WebAVçš„0%-100%ï¼‰
  properties: {
    x?: number
    y?: number
    width?: number
    height?: number
    rotation?: number
    opacity?: number
  }
}

// é¡¹ç›®åŠ¨ç”»é…ç½®ï¼ˆå¯¹æ ‡WebAV IAnimationOptsï¼‰
interface ProjectAnimationConfig {
  keyFrames: ProjectKeyFrame[]
  duration: number      // åŠ¨ç”»å‘¨æœŸæ—¶é•¿ï¼ˆå¾®ç§’ï¼‰
  delay?: number        // å»¶è¿Ÿæ—¶é—´ï¼ˆå¾®ç§’ï¼‰
  iterCount?: number    // è¿­ä»£æ¬¡æ•°ï¼Œé»˜è®¤1
  isEnabled: boolean
}
```

#### TimelineItemé›†æˆ
```typescript
// æ‰©å±•ç°æœ‰çš„TimelineItem
interface TimelineItem {
  // ... ç°æœ‰å±æ€§
  animationConfig?: ProjectAnimationConfig // åŠ¨ç”»é…ç½®
}
```

### WebAVæ ¼å¼è½¬æ¢å™¨

#### æ ¸å¿ƒè½¬æ¢é€»è¾‘
```typescript
class WebAVAnimationConverter {
  // é¡¹ç›®å…³é”®å¸§ â†’ WebAV TKeyFrameOptsæ ¼å¼
  static convertToWebAVKeyFrames(keyFrames: ProjectKeyFrame[]): TKeyFrameOpts {
    const webavKeyFrames: TKeyFrameOpts = {}

    keyFrames.forEach(kf => {
      const timeKey = kf.time === 0 ? 'from' :
                     kf.time === 1 ? 'to' :
                     `${Math.round(kf.time * 100)}%`

      webavKeyFrames[timeKey] = {
        x: kf.properties.x,
        y: kf.properties.y,
        w: kf.properties.width,   // width â†’ w
        h: kf.properties.height,  // height â†’ h
        angle: kf.properties.rotation,  // rotation â†’ angle
        opacity: kf.properties.opacity
      }
    })

    return webavKeyFrames
  }

  // é¡¹ç›®åŠ¨ç”»é…ç½® â†’ WebAV IAnimationOptsæ ¼å¼
  static convertToWebAVOpts(config: ProjectAnimationConfig): IAnimationOpts {
    return {
      duration: config.duration,
      delay: config.delay || 0,
      iterCount: config.iterCount || 1
    }
  }
}
```

### å…³é”®å¸§åŠ¨ç”»ç®¡ç†å™¨

#### æ ¸å¿ƒç®¡ç†ç±»
```typescript
class KeyFrameAnimationManager {
  // åº”ç”¨åŠ¨ç”»åˆ°WebAV Sprite
  applyAnimationToSprite(
    sprite: VideoVisibleSprite | ImageVisibleSprite,
    config: ProjectAnimationConfig
  ): void {
    if (!config.isEnabled || config.keyFrames.length < 2) {
      return
    }

    const webavKeyFrames = WebAVAnimationConverter.convertToWebAVKeyFrames(config.keyFrames)
    const webavOpts = WebAVAnimationConverter.convertToWebAVOpts(config)

    // ç›´æ¥è°ƒç”¨WebAVçš„setAnimation
    sprite.setAnimation(webavKeyFrames, webavOpts)
  }

  // æ¸…é™¤åŠ¨ç”»
  clearSpriteAnimation(sprite: VideoVisibleSprite | ImageVisibleSprite): void {
    // WebAVæ¸…é™¤åŠ¨ç”»çš„æ–¹å¼
    sprite.setAnimation({}, { duration: 0 })
  }

  // åˆ›å»ºå…³é”®å¸§
  createKeyFrame(
    timelineItem: TimelineItem,
    property: AnimatableProperty,
    time: number,  // å½“å‰æ’­æ”¾æ—¶é—´ï¼ˆç§’ï¼‰
    value: number
  ): void {
    if (!timelineItem.animationConfig) {
      // ä½¿ç”¨clipæ—¶é•¿ä½œä¸ºåŠ¨ç”»duration
      const clipDurationMicroseconds = getClipDuration(timelineItem) * 1_000_000
      timelineItem.animationConfig = {
        keyFrames: [],
        duration: clipDurationMicroseconds, // åŠ¨ç”»æ—¶é•¿ç­‰äºclipæ—¶é•¿
        iterCount: 1, // å›ºå®šä¸º1æ¬¡è¿­ä»£
        isEnabled: true
      }
    }

    // è®¡ç®—ç›¸å¯¹æ—¶é—´ï¼ˆ0-1ï¼‰
    const relativeTime = this.calculateRelativeTime(time, timelineItem)

    // æŸ¥æ‰¾æˆ–åˆ›å»ºå…³é”®å¸§
    let keyFrame = timelineItem.animationConfig.keyFrames.find(kf =>
      Math.abs(kf.time - relativeTime) < 0.01 // 1%å®¹å·®
    )

    if (!keyFrame) {
      keyFrame = {
        id: generateId(),
        time: relativeTime,
        properties: {}
      }
      timelineItem.animationConfig.keyFrames.push(keyFrame)
    }

    // è®¾ç½®å±æ€§å€¼
    keyFrame.properties[property] = value

    // é‡æ–°åº”ç”¨åŠ¨ç”»
    this.applyAnimationToSprite(timelineItem.sprite, timelineItem.animationConfig)
  }

  // è®¡ç®—ç›¸å¯¹æ—¶é—´ï¼ˆå…³é”®é€»è¾‘ï¼‰
  private calculateRelativeTime(currentTime: number, timelineItem: TimelineItem): number {
    const config = timelineItem.animationConfig!
    const animationDurationSeconds = config.duration / 1_000_000

    // ç›´æ¥è®¡ç®—ç›¸å¯¹æ—¶é—´ï¼Œä¸ä½¿ç”¨å–æ¨¡è¿ç®—
    // å› ä¸ºåŠ¨ç”»durationç°åœ¨ç­‰äºclipæ—¶é•¿ï¼Œä¸”åªè¿­ä»£ä¸€æ¬¡
    return Math.max(0, Math.min(1, currentTime / animationDurationSeconds))
  }
}
```

## ğŸ® MVPç”¨æˆ·æ“ä½œæµç¨‹

### ğŸ“ æ ¸å¿ƒæ“ä½œï¼šè®¾ç½®å…³é”®å¸§

#### ç®€åŒ–æ“ä½œæ­¥éª¤
1. **é€‰æ‹©ç‰‡æ®µ** - åœ¨æ—¶é—´è½´ä¸Šé€‰æ‹©è¦æ·»åŠ åŠ¨ç”»çš„ç‰‡æ®µ
2. **ç§»åŠ¨æ’­æ”¾å¤´** - æ‹–æ‹½åˆ°æƒ³è¦è®¾ç½®å…³é”®å¸§çš„æ—¶é—´ç‚¹
3. **ç‚¹å‡»å…³é”®å¸§æŒ‰é’®** - ç‚¹å‡»å±æ€§æ—è¾¹çš„é’»çŸ³æŒ‰é’® â—†

#### é¢„æœŸæ•ˆæœ
- **æŒ‰é’®å˜åŒ–**ï¼šç©ºå¿ƒ â—‡ â†’ å®å¿ƒ â—†ï¼ˆæ©™è‰²ï¼‰
- **åŠ¨ç”»ç”Ÿæ•ˆ**ï¼šå¦‚æœå·²æœ‰å…¶ä»–å…³é”®å¸§ï¼ŒåŠ¨ç”»ç«‹å³æ’­æ”¾

```typescript
// MVPç‰ˆæœ¬çš„å…³é”®å¸§åˆ‡æ¢é€»è¾‘
const handleKeyFrameToggle = (property: AnimatableProperty) => {
  const currentTime = videoStore.currentTime
  const currentValue = selectedTimelineItem.value[property]

  if (hasKeyFrameAtCurrentTime(property, currentTime)) {
    // åˆ é™¤å…³é”®å¸§
    keyFrameManager.removeKeyFrame(selectedTimelineItem.value, property, currentTime)
  } else {
    // åˆ›å»ºå…³é”®å¸§ï¼ˆä½¿ç”¨å½“å‰å±æ€§å€¼ï¼‰
    keyFrameManager.createKeyFrame(selectedTimelineItem.value, property, currentTime, currentValue)
  }
}
```

## ğŸ”„ åŠ¨ç”»ç³»ç»Ÿä¸æ“ä½œå†å²ç³»ç»Ÿé›†æˆ

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

#### 1. æ™ºèƒ½æ“ä½œè·¯ç”±
æ ¹æ®clipçš„åŠ¨ç”»çŠ¶æ€ï¼Œè‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„æ“ä½œæ–¹å¼ï¼š
- **æ— åŠ¨ç”»clip**ï¼šç›´æ¥ä¿®æ”¹TimelineItemå±æ€§ â†’ è§¦å‘setter â†’ æ›´æ–°sprite
- **æœ‰åŠ¨ç”»clip**ï¼šåˆ›å»º/æ›´æ–°å…³é”®å¸§ â†’ ä¸ç›´æ¥ä¿®æ”¹TimelineItemå±æ€§

#### 2. ç»Ÿä¸€å†å²è®°å½•
æ‰€æœ‰æ“ä½œï¼ˆåŒ…æ‹¬å…³é”®å¸§æ“ä½œï¼‰éƒ½é€šè¿‡Commandæ¨¡å¼é›†æˆåˆ°æ“ä½œå†å²ç³»ç»Ÿä¸­ï¼Œç¡®ä¿å®Œæ•´çš„æ’¤é”€/é‡åšæ”¯æŒã€‚

#### 3. åˆ¤æ–­æ ‡å‡†
```typescript
// åˆ¤æ–­æ˜¯å¦ä¸ºæœ‰åŠ¨ç”»çš„clip
const hasAnimation = computed(() => {
  return selectedTimelineItem.value?.animationConfig !== null &&
         selectedTimelineItem.value?.animationConfig !== undefined
})
```

### æ“ä½œåˆ†ç±»æ¶æ„

#### æ— åŠ¨ç”»clipæ“ä½œ
```typescript
UpdateTransformCommand // å·²å­˜åœ¨ï¼Œç›´æ¥ä¿®æ”¹TimelineItemå±æ€§
```

#### æœ‰åŠ¨ç”»clipæ“ä½œï¼ˆæ–°å¢ï¼‰
```typescript
CreateKeyFrameCommand    // åˆ›å»ºå…³é”®å¸§
RemoveKeyFrameCommand    // åˆ é™¤å…³é”®å¸§
UpdateKeyFrameCommand    // æ›´æ–°å…³é”®å¸§å€¼
ToggleAnimationCommand   // å¯ç”¨/ç¦ç”¨åŠ¨ç”»
ClearAnimationCommand    // æ¸…é™¤æ‰€æœ‰åŠ¨ç”»
```

### æ™ºèƒ½å±æ€§æ›´æ–°ç³»ç»Ÿ

#### æ ¸å¿ƒè·¯ç”±é€»è¾‘
```typescript
// å±æ€§é¢æ¿çš„æ™ºèƒ½æ›´æ–°æ–¹æ³•
const updatePropertySmart = async (property: AnimatableProperty, newValue: number) => {
  if (!selectedTimelineItem.value) return

  const oldValue = getCurrentPropertyValue(selectedTimelineItem.value, property)
  if (oldValue === newValue) return

  if (hasAnimation.value) {
    // æœ‰åŠ¨ç”»ï¼šé€šè¿‡å…³é”®å¸§å‘½ä»¤æ›´æ–°
    await videoStore.createKeyFrameWithHistory(
      selectedTimelineItem.value.id,
      property,
      newValue
    )
  } else {
    // æ— åŠ¨ç”»ï¼šé€šè¿‡å˜æ¢å‘½ä»¤æ›´æ–°
    await updatePropertyWithHistory(property, newValue)
  }
}
```

#### æ™ºèƒ½å±æ€§å€¼æ˜¾ç¤º
```typescript
// è®¡ç®—å±æ€§ï¼šæ ¹æ®åŠ¨ç”»çŠ¶æ€æ™ºèƒ½æ˜¾ç¤ºå½“å‰å€¼
const transformX = computed({
  get: () => {
    if (!selectedTimelineItem.value) return 0

    if (hasAnimation.value) {
      // æœ‰åŠ¨ç”»ï¼šæ˜¾ç¤ºå½“å‰æ—¶é—´ç‚¹çš„æ’å€¼
      return getPropertyValueAtTime(
        selectedTimelineItem.value,
        'x',
        videoStore.currentTime
      )
    } else {
      // æ— åŠ¨ç”»ï¼šæ˜¾ç¤ºTimelineItemå±æ€§
      return selectedTimelineItem.value.x
    }
  },
  set: (value: number) => {
    updatePropertySmart('x', value)
  }
})
```

### å…³é”®å¸§å‘½ä»¤ç±»è®¾è®¡

#### CreateKeyFrameCommand
```typescript
export class CreateKeyFrameCommand implements SimpleCommand {
  id: string
  type = 'CREATE_KEYFRAME'
  description: string
  timestamp: number

  constructor(
    private timelineItemId: string,
    private property: AnimatableProperty,
    private time: number,
    private value: number,
    private timelineModule: TimelineModule,
    private videoResolution: { width: number; height: number }
  ) {
    this.id = generateCommandId()
    this.timestamp = Date.now()
    this.description = `åˆ›å»ºå…³é”®å¸§: ${property} = ${value} (${time}s)`
  }

  async execute(): Promise<void> {
    const timelineItem = this.timelineModule.getTimelineItem(this.timelineItemId)
    if (!timelineItem) return

    KeyFrameAnimationManager.createKeyFrame(
      timelineItem,
      this.property,
      this.time,
      this.value,
      this.videoResolution
    )
  }

  async undo(): Promise<void> {
    const timelineItem = this.timelineModule.getTimelineItem(this.timelineItemId)
    if (!timelineItem) return

    KeyFrameAnimationManager.removeKeyFrameProperty(
      timelineItem,
      this.property,
      this.time
    )
  }
}
```

#### RemoveKeyFrameCommand
```typescript
export class RemoveKeyFrameCommand implements SimpleCommand {
  id: string
  type = 'REMOVE_KEYFRAME'
  description: string
  timestamp: number
  private removedKeyFrameData: {
    value: number
    videoResolution: { width: number; height: number }
  } | null = null

  constructor(
    private timelineItemId: string,
    private property: AnimatableProperty,
    private time: number,
    private timelineModule: TimelineModule,
    private videoResolution: { width: number; height: number }
  ) {
    this.id = generateCommandId()
    this.timestamp = Date.now()
    this.description = `åˆ é™¤å…³é”®å¸§: ${property} (${time}s)`

    // ä¿å­˜è¦åˆ é™¤çš„å…³é”®å¸§æ•°æ®ç”¨äºæ’¤é”€
    const timelineItem = this.timelineModule.getTimelineItem(timelineItemId)
    if (timelineItem) {
      const currentValue = getPropertyValueAtTime(timelineItem, property, time)
      this.removedKeyFrameData = {
        value: currentValue,
        videoResolution: { ...videoResolution }
      }
    }
  }

  async execute(): Promise<void> {
    const timelineItem = this.timelineModule.getTimelineItem(this.timelineItemId)
    if (!timelineItem) return

    KeyFrameAnimationManager.removeKeyFrameProperty(
      timelineItem,
      this.property,
      this.time
    )
  }

  async undo(): Promise<void> {
    const timelineItem = this.timelineModule.getTimelineItem(this.timelineItemId)
    if (!timelineItem || !this.removedKeyFrameData) return

    // æ¢å¤è¢«åˆ é™¤çš„å…³é”®å¸§
    KeyFrameAnimationManager.createKeyFrame(
      timelineItem,
      this.property,
      this.time,
      this.removedKeyFrameData.value,
      this.removedKeyFrameData.videoResolution
    )
  }
}
```

#### ClearAnimationCommand
```typescript
export class ClearAnimationCommand implements SimpleCommand {
  id: string
  type = 'CLEAR_ANIMATION'
  description: string
  timestamp: number
  private savedAnimationConfig: AnimationConfig | null = null

  constructor(
    private timelineItemId: string,
    private timelineModule: TimelineModule
  ) {
    this.id = generateCommandId()
    this.timestamp = Date.now()
    this.description = 'æ¸…é™¤åŠ¨ç”»'

    // ä¿å­˜å½“å‰åŠ¨ç”»é…ç½®ç”¨äºæ’¤é”€
    const timelineItem = this.timelineModule.getTimelineItem(timelineItemId)
    if (timelineItem?.animationConfig) {
      this.savedAnimationConfig = JSON.parse(JSON.stringify(timelineItem.animationConfig))
    }
  }

  async execute(): Promise<void> {
    const timelineItem = this.timelineModule.getTimelineItem(this.timelineItemId)
    if (!timelineItem) return

    // æ¸…é™¤åŠ¨ç”»é…ç½®
    timelineItem.animationConfig = undefined
    KeyFrameAnimationManager.clearSpriteAnimation(timelineItem.sprite)
  }

  async undo(): Promise<void> {
    const timelineItem = this.timelineModule.getTimelineItem(this.timelineItemId)
    if (!timelineItem || !this.savedAnimationConfig) return

    // æ¢å¤åŠ¨ç”»é…ç½®
    timelineItem.animationConfig = this.savedAnimationConfig
    KeyFrameAnimationManager.applyAnimationToSprite(
      timelineItem.sprite,
      this.savedAnimationConfig,
      timelineItem,
      videoStore.videoResolution
    )
  }
}
```

### VideoStoreé›†æˆæ–¹æ³•

#### å¸¦å†å²è®°å½•çš„å…³é”®å¸§æ“ä½œæ–¹æ³•
```typescript
// åœ¨videoStoreä¸­æ–°å¢æ–¹æ³•

/**
 * å¸¦å†å²è®°å½•çš„åˆ›å»ºå…³é”®å¸§æ–¹æ³•
 */
async function createKeyFrameWithHistory(
  timelineItemId: string,
  property: AnimatableProperty,
  value?: number,
  time?: number
): Promise<void> {
  const timelineItem = timelineModule.getTimelineItem(timelineItemId)
  if (!timelineItem) return

  const targetTime = time ?? currentTime.value
  const targetValue = value ?? getCurrentPropertyValue(timelineItem, property)

  const command = new CreateKeyFrameCommand(
    timelineItemId,
    property,
    targetTime,
    targetValue,
    { getTimelineItem: timelineModule.getTimelineItem },
    videoResolution.value
  )

  await historyModule.executeCommand(command)
}

/**
 * å¸¦å†å²è®°å½•çš„åˆ é™¤å…³é”®å¸§æ–¹æ³•
 */
async function removeKeyFrameWithHistory(
  timelineItemId: string,
  property: AnimatableProperty,
  time?: number
): Promise<void> {
  const targetTime = time ?? currentTime.value

  const command = new RemoveKeyFrameCommand(
    timelineItemId,
    property,
    targetTime,
    { getTimelineItem: timelineModule.getTimelineItem },
    videoResolution.value
  )

  await historyModule.executeCommand(command)
}

/**
 * å¸¦å†å²è®°å½•çš„æ¸…é™¤åŠ¨ç”»æ–¹æ³•
 */
async function clearAnimationWithHistory(timelineItemId: string): Promise<void> {
  const command = new ClearAnimationCommand(
    timelineItemId,
    { getTimelineItem: timelineModule.getTimelineItem }
  )

  await historyModule.executeCommand(command)
}
```

### å±æ€§é¢æ¿é‡æ„

#### å…³é”®å¸§æŒ‰é’®è¡Œä¸º
```typescript
const handleToggleKeyFrame = async (property: AnimatableProperty) => {
  if (!selectedTimelineItem.value) return

  if (hasKeyFrameAtTime(property)) {
    // åˆ é™¤å…³é”®å¸§
    await videoStore.removeKeyFrameWithHistory(
      selectedTimelineItem.value.id,
      property
    )
  } else {
    // åˆ›å»ºå…³é”®å¸§
    await videoStore.createKeyFrameWithHistory(
      selectedTimelineItem.value.id,
      property
    )
  }
}
```

#### é¦–æ¬¡åˆ›å»ºå…³é”®å¸§çš„ç‰¹æ®Šå¤„ç†
```typescript
const handleFirstKeyFrame = async (property: AnimatableProperty) => {
  if (!selectedTimelineItem.value) return

  // å¦‚æœæ˜¯é¦–æ¬¡åˆ›å»ºå…³é”®å¸§ï¼Œéœ€è¦ï¼š
  // 1. åˆå§‹åŒ–animationConfig
  // 2. åœ¨æ—¶é—´0åˆ›å»ºåˆå§‹å…³é”®å¸§ï¼ˆå½“å‰å€¼ï¼‰
  // 3. åœ¨å½“å‰æ—¶é—´åˆ›å»ºç›®æ ‡å…³é”®å¸§

  if (!hasAnimation.value) {
    const currentValue = getCurrentPropertyValue(selectedTimelineItem.value, property)

    // æ‰¹é‡æ“ä½œï¼šåˆ›å»ºåˆå§‹å…³é”®å¸§ + å½“å‰å…³é”®å¸§
    const batch = videoStore.startBatch('åˆå§‹åŒ–åŠ¨ç”»')

    // åœ¨æ—¶é—´0åˆ›å»ºåˆå§‹å…³é”®å¸§
    batch.addCommand(new CreateKeyFrameCommand(
      selectedTimelineItem.value.id,
      property,
      0,
      currentValue,
      timelineModule,
      videoStore.videoResolution
    ))

    // åœ¨å½“å‰æ—¶é—´åˆ›å»ºå…³é”®å¸§
    batch.addCommand(new CreateKeyFrameCommand(
      selectedTimelineItem.value.id,
      property,
      videoStore.currentTime,
      currentValue,
      timelineModule,
      videoStore.videoResolution
    ))

    await videoStore.executeBatchCommand(batch.build())
  }
}
```

### è¾¹ç•Œæƒ…å†µå¤„ç†

#### 1. åŠ¨ç”»çŠ¶æ€è½¬æ¢
```typescript
// ä»æ— åŠ¨ç”»è½¬ä¸ºæœ‰åŠ¨ç”»
const initializeAnimation = async (property: AnimatableProperty) => {
  if (!selectedTimelineItem.value || hasAnimation.value) return

  // åˆ›å»ºåˆå§‹å…³é”®å¸§ï¼Œä¿æŒå½“å‰å±æ€§å€¼
  const currentValue = getCurrentPropertyValue(selectedTimelineItem.value, property)
  await videoStore.createKeyFrameWithHistory(
    selectedTimelineItem.value.id,
    property,
    currentValue,
    0 // åœ¨æ—¶é—´0åˆ›å»ºåˆå§‹å…³é”®å¸§
  )
}

// ä»æœ‰åŠ¨ç”»è½¬ä¸ºæ— åŠ¨ç”»
const finalizeToStaticValue = async () => {
  if (!selectedTimelineItem.value || !hasAnimation.value) return

  // è·å–å½“å‰æ—¶é—´ç‚¹çš„æ’å€¼ä½œä¸ºæœ€ç»ˆé™æ€å€¼
  const finalValues: Record<string, number> = {}
  const animatableProperties: AnimatableProperty[] = ['x', 'y', 'width', 'height', 'rotation', 'opacity']

  animatableProperties.forEach(property => {
    finalValues[property] = getPropertyValueAtTime(
      selectedTimelineItem.value!,
      property,
      videoStore.currentTime
    )
  })

  // æ‰¹é‡æ“ä½œï¼šæ¸…é™¤åŠ¨ç”» + è®¾ç½®æœ€ç»ˆå€¼
  const batch = videoStore.startBatch('è½¬æ¢ä¸ºé™æ€å±æ€§')

  // æ¸…é™¤åŠ¨ç”»
  batch.addCommand(new ClearAnimationCommand(
    selectedTimelineItem.value.id,
    timelineModule
  ))

  // è®¾ç½®æœ€ç»ˆé™æ€å€¼
  batch.addCommand(new UpdateTransformCommand(
    selectedTimelineItem.value.id,
    'transform',
    {}, // æ—§å€¼ï¼ˆå°†åœ¨å‘½ä»¤ä¸­è·å–ï¼‰
    finalValues,
    timelineModule,
    mediaModule,
    clipOperationsModule
  ))

  await videoStore.executeBatchCommand(batch.build())
}
```

#### 2. å¤šé€‰çŠ¶æ€å¤„ç†
```typescript
// å¤šé€‰æ—¶ç¦ç”¨åŠ¨ç”»åŠŸèƒ½
const isAnimationDisabled = computed(() => {
  return videoStore.isMultiSelectMode || !selectedTimelineItem.value
})

// åœ¨å±æ€§é¢æ¿ä¸­
const showAnimationControls = computed(() => {
  return !isAnimationDisabled.value && selectedTimelineItem.value
})
```

#### 3. å±æ€§åŒæ­¥å¤„ç†
```typescript
// ç›‘å¬å½“å‰æ—¶é—´å˜åŒ–ï¼Œæ›´æ–°åŠ¨ç”»å±æ€§æ˜¾ç¤º
watch(
  () => videoStore.currentTime,
  (newTime) => {
    if (selectedTimelineItem.value?.animationConfig?.isEnabled) {
      // è§¦å‘è®¡ç®—å±æ€§é‡æ–°è®¡ç®—ï¼Œæ›´æ–°UIæ˜¾ç¤º
      // Vueçš„å“åº”å¼ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†
    }
  }
)

// ç›‘å¬é€‰ä¸­é¡¹ç›®å˜åŒ–ï¼ŒåŒæ­¥åŠ¨ç”»ç®¡ç†å™¨
watch(selectedTimelineItem, (newItem) => {
  setSelectedTimelineItem(newItem)
}, { immediate: true })
```

### å®ç°æ­¥éª¤

#### é˜¶æ®µ1ï¼šåŸºç¡€æ¶æ„ï¼ˆç¬¬1-2å‘¨ï¼‰
1. **åˆ›å»ºå…³é”®å¸§Commandç±»**
   - CreateKeyFrameCommand
   - RemoveKeyFrameCommand
   - ClearAnimationCommand

2. **æ‰©å±•VideoStoreæ–¹æ³•**
   - createKeyFrameWithHistory()
   - removeKeyFrameWithHistory()
   - clearAnimationWithHistory()

#### é˜¶æ®µ2ï¼šå±æ€§é¢æ¿é‡æ„ï¼ˆç¬¬3å‘¨ï¼‰
3. **é‡æ„å±æ€§æ›´æ–°é€»è¾‘**
   - å®ç°updatePropertySmart()
   - ä¿®æ”¹æ‰€æœ‰å±æ€§è¾“å…¥ç»„ä»¶ç»‘å®š

4. **ä¼˜åŒ–å±æ€§å€¼æ˜¾ç¤º**
   - å®ç°æ™ºèƒ½è®¡ç®—å±æ€§
   - å¤„ç†åŠ¨ç”»æ’å€¼æ˜¾ç¤º

#### é˜¶æ®µ3ï¼šè¾¹ç•Œæƒ…å†µå¤„ç†ï¼ˆç¬¬4å‘¨ï¼‰
5. **åŠ¨ç”»çŠ¶æ€è½¬æ¢**
   - é¦–æ¬¡åˆ›å»ºå…³é”®å¸§çš„æ‰¹é‡æ“ä½œ
   - æ¸…é™¤åŠ¨ç”»æ—¶çš„çŠ¶æ€å¤„ç†

6. **å®Œå–„ç”¨æˆ·ä½“éªŒ**
   - å¤šé€‰çŠ¶æ€çš„åŠ¨ç”»æ§åˆ¶ç¦ç”¨
   - è§†è§‰åé¦ˆå’ŒçŠ¶æ€æŒ‡ç¤ºå™¨

#### é˜¶æ®µ4ï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆç¬¬5å‘¨ï¼‰
7. **å…¨é¢æµ‹è¯•**
   - æ’¤é”€/é‡åšåŠŸèƒ½æµ‹è¯•
   - åŠ¨ç”»çŠ¶æ€è½¬æ¢æµ‹è¯•
   - è¾¹ç•Œæƒ…å†µæµ‹è¯•

8. **æ€§èƒ½ä¼˜åŒ–**
   - æ‰¹é‡æ“ä½œä¼˜åŒ–
   - å†…å­˜ç®¡ç†ä¼˜åŒ–

### é¢„æœŸæ•ˆæœ

#### 1. ç»Ÿä¸€çš„æ“ä½œä½“éªŒ
- æ‰€æœ‰å±æ€§ä¿®æ”¹æ“ä½œéƒ½æ”¯æŒæ’¤é”€/é‡åš
- åŠ¨ç”»å’ŒéåŠ¨ç”»clipçš„æ“ä½œä½“éªŒä¸€è‡´
- æ™ºèƒ½çš„æ“ä½œè·¯ç”±ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒåº•å±‚å®ç°

#### 2. å®Œæ•´çš„å†å²è®°å½•
- å…³é”®å¸§çš„åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹éƒ½æœ‰å†å²è®°å½•
- åŠ¨ç”»çŠ¶æ€çš„å¯ç”¨/ç¦ç”¨å¯ä»¥æ’¤é”€
- æ‰¹é‡æ“ä½œä½œä¸ºå•ä¸ªå†å²è®°å½•é¡¹

#### 3. æ¸…æ™°çš„çŠ¶æ€ç®¡ç†
- æ˜ç¡®çš„åŠ¨ç”»/éåŠ¨ç”»çŠ¶æ€åˆ¤æ–­
- æ­£ç¡®çš„å±æ€§å€¼æ˜¾ç¤ºï¼ˆé™æ€å€¼ vs æ’å€¼ï¼‰
- åˆç†çš„è¾¹ç•Œæƒ…å†µå¤„ç†

è¿™ä¸ªé›†æˆæ–¹æ¡ˆç¡®ä¿äº†åŠ¨ç”»ç³»ç»Ÿä¸æ“ä½œå†å²ç³»ç»Ÿçš„å®Œç¾ç»“åˆï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€è‡´ã€å¯é çš„ç¼–è¾‘ä½“éªŒã€‚

### ğŸ”„ è°ƒæ•´å±æ€§çš„æ•ˆæœ

#### åœ¨å…³é”®å¸§æ—¶é—´ç‚¹è°ƒæ•´
**æ“ä½œ**ï¼šç§»åŠ¨åˆ°å…³é”®å¸§æ—¶é—´ç‚¹ï¼Œè°ƒæ•´å±æ€§å€¼

**æ•ˆæœ**ï¼š
- å…³é”®å¸§å€¼ç«‹å³æ›´æ–°
- åŠ¨ç”»é‡æ–°è®¡ç®—å¹¶ç”Ÿæ•ˆ

#### åœ¨éå…³é”®å¸§æ—¶é—´ç‚¹è°ƒæ•´
**æ“ä½œ**ï¼šç§»åŠ¨åˆ°éå…³é”®å¸§æ—¶é—´ç‚¹ï¼Œè°ƒæ•´å±æ€§å€¼

**æ•ˆæœ**ï¼š
- å±æ€§å€¼ç«‹å³æ”¹å˜ï¼ˆä¸´æ—¶æ•ˆæœï¼‰
- ç°æœ‰åŠ¨ç”»ä¸å—å½±å“

### ğŸ¯ MVPç‰ˆæœ¬ï¼šå…³é”®å¸§å¯¼èˆª

#### åŸºç¡€å¯¼èˆªï¼ˆMVPæ ¸å¿ƒåŠŸèƒ½ï¼‰
**æ“ä½œ**ï¼šæ‰‹åŠ¨æ‹–æ‹½æ’­æ”¾å¤´åˆ°å…³é”®å¸§æ—¶é—´ç‚¹

**æ•ˆæœ**ï¼š
- å±æ€§é¢æ¿è‡ªåŠ¨æ›´æ–°æ˜¾ç¤ºè¯¥æ—¶é—´ç‚¹çš„å±æ€§å€¼
- å…³é”®å¸§æŒ‰é’®çŠ¶æ€è‡ªåŠ¨æ›´æ–°ï¼ˆæœ‰å…³é”®å¸§æ—¶æ˜¾ç¤ºå®å¿ƒï¼‰

```typescript
// MVPç‰ˆæœ¬ï¼šç®€å•çš„æ—¶é—´ç‚¹æ£€æŸ¥
const updateKeyFrameButtonStates = (currentTime: number) => {
  ['x', 'y', 'width', 'height', 'rotation', 'opacity'].forEach(property => {
    const hasKeyFrame = hasKeyFrameAtCurrentTime(property, currentTime)
    updateKeyFrameButtonState(property, hasKeyFrame)
  })
}
```

### ğŸ” MVPç‰ˆæœ¬ï¼šæ‰¾å›å…³é”®å¸§

#### æ–¹æ³•1ï¼šæ’­æ”¾å¤´æ‹–æ‹½ï¼ˆMVPæ ¸å¿ƒåŠŸèƒ½ï¼‰
**æ“ä½œ**ï¼šæ‹–æ‹½æ’­æ”¾å¤´ï¼Œè§‚å¯Ÿå…³é”®å¸§æŒ‰é’®çŠ¶æ€å˜åŒ–

**æ•ˆæœ**ï¼š
- å½“æ’­æ”¾å¤´ç§»åŠ¨åˆ°æœ‰å…³é”®å¸§çš„æ—¶é—´ç‚¹æ—¶ï¼Œå¯¹åº”æŒ‰é’®å˜ä¸ºå®å¿ƒ
- å±æ€§é¢æ¿æ˜¾ç¤ºè¯¥å…³é”®å¸§çš„å±æ€§å€¼

#### æ–¹æ³•2ï¼šæ’­æ”¾é¢„è§ˆï¼ˆMVPè¾…åŠ©åŠŸèƒ½ï¼‰
**æ“ä½œ**ï¼šç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼Œè§‚å¯ŸåŠ¨ç”»æ•ˆæœ

**æ•ˆæœ**ï¼š
- å¯ä»¥çœ‹åˆ°åŠ¨ç”»åœ¨å“ªäº›æ—¶é—´ç‚¹æœ‰å˜åŒ–
- æš‚åœåå¯ä»¥åœ¨å˜åŒ–ç‚¹è®¾ç½®æ–°çš„å…³é”®å¸§

### ğŸ”§ MVPç‰ˆæœ¬ï¼šå¢é‡å±æ€§è®¾ç½®

#### åœ¨å…³é”®å¸§æ—¶é—´ç‚¹è°ƒæ•´å±æ€§
**æ“ä½œ**ï¼šç§»åŠ¨æ’­æ”¾å¤´åˆ°å…³é”®å¸§æ—¶é—´ç‚¹ï¼Œè°ƒæ•´å±æ€§å€¼

**æ•ˆæœ**ï¼š
- å…³é”®å¸§å€¼ç«‹å³æ›´æ–°
- åŠ¨ç”»é‡æ–°è®¡ç®—å¹¶ç”Ÿæ•ˆ
- å±æ€§é¢æ¿æ˜¾ç¤ºæ–°å€¼

```typescript
// MVPç‰ˆæœ¬ï¼šç®€å•çš„å…³é”®å¸§å±æ€§æ›´æ–°
const updateKeyFrameProperty = (property: AnimatableProperty, newValue: number) => {
  const currentTime = videoStore.currentTime
  const keyFrame = findKeyFrameAtTime(currentTime, property)

  if (keyFrame) {
    // æ›´æ–°å…³é”®å¸§å€¼
    keyFrame.properties[property] = newValue
    // é‡æ–°åº”ç”¨åŠ¨ç”»
    applyAnimationToSprite(timelineItem.sprite, timelineItem.animationConfig)
  }
}
```

## ğŸ¯ MVPå®ç°è®¡åˆ’

### é˜¶æ®µ1ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ2-3å¤©ï¼‰
**ç›®æ ‡**ï¼šå®ç°æœ€åŸºç¡€çš„å…³é”®å¸§åŠ¨ç”»åŠŸèƒ½

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®Œå–„`animationTypes.ts`ä¸­çš„ç±»å‹å®šä¹‰
- [ ] å®ç°`WebAVAnimationConverter`è½¬æ¢å™¨
- [ ] å®ç°`KeyFrameAnimationManager`æ ¸å¿ƒé€»è¾‘
- [ ] æ‰©å±•`KeyFrameButton.vue`ç»„ä»¶
- [ ] é›†æˆåˆ°`PropertiesPanel.vue`

**éªŒæ”¶æ ‡å‡†**ï¼š
- èƒ½å¤Ÿç‚¹å‡»å…³é”®å¸§æŒ‰é’®åˆ›å»º/åˆ é™¤å…³é”®å¸§
- å…³é”®å¸§æŒ‰é’®çŠ¶æ€æ­£ç¡®åæ˜ å½“å‰æ—¶é—´ç‚¹çš„å…³é”®å¸§å­˜åœ¨æ€§
- è°ƒæ•´å±æ€§å€¼æ—¶å…³é”®å¸§èƒ½å¤Ÿæ­£ç¡®æ›´æ–°
- æ’­æ”¾æ—¶èƒ½çœ‹åˆ°åŠ¨ç”»æ•ˆæœ

### MVPåŠŸèƒ½èŒƒå›´

#### âœ… åŒ…å«åŠŸèƒ½
1. **åŸºç¡€å…³é”®å¸§æ“ä½œ**
   - ç‚¹å‡»æŒ‰é’®åˆ›å»º/åˆ é™¤å…³é”®å¸§
   - å…³é”®å¸§æŒ‰é’®çŠ¶æ€æ˜¾ç¤ºï¼ˆç©ºå¿ƒ/å®å¿ƒï¼‰
   - åœ¨å…³é”®å¸§æ—¶é—´ç‚¹è°ƒæ•´å±æ€§å€¼

2. **ç®€å•å¯¼èˆª**
   - æ‹–æ‹½æ’­æ”¾å¤´æŸ¥çœ‹å…³é”®å¸§çŠ¶æ€
   - æ’­æ”¾é¢„è§ˆè§‚å¯ŸåŠ¨ç”»æ•ˆæœ

3. **åŸºç¡€åŠ¨ç”»**
   - æ”¯æŒä½ç½®ã€å¤§å°ã€æ—‹è½¬ã€é€æ˜åº¦åŠ¨ç”»
   - WebAVåŸç”Ÿçº¿æ€§æ’å€¼
   - åŸºç¡€çš„åŠ¨ç”»æ’­æ”¾

#### âŒ æš‚ä¸åŒ…å«åŠŸèƒ½
1. **é«˜çº§å¯¼èˆª**
   - å…³é”®å¸§å¯¼èˆªæŒ‰é’®
   - å…³é”®å¸§åˆ—è¡¨é¢æ¿
   - æ—¶é—´è½´å…³é”®å¸§æ ‡è®°

2. **é«˜çº§ç¼–è¾‘**
   - æ‹–æ‹½è°ƒæ•´å…³é”®å¸§æ—¶é—´
   - å…³é”®å¸§æ—¶é—´è½´é¢æ¿
   - æ‰¹é‡å…³é”®å¸§æ“ä½œ

3. **é«˜çº§åŠŸèƒ½**
   - ç¼“åŠ¨å‡½æ•°é€‰æ‹©
   - åŠ¨ç”»é¢„è®¾æ¨¡æ¿
   - å…³é”®å¸§æœç´¢è¿‡æ»¤

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ¶æ„è®¾è®¡](../03-å¼€å‘æ–‡æ¡£/æ¶æ„è®¾è®¡.md) - ç³»ç»Ÿæ¶æ„è®¾è®¡
- [APIæ–‡æ¡£](../03-å¼€å‘æ–‡æ¡£/APIæ–‡æ¡£.md) - WebAV APIæ¥å£
- [æ“ä½œå†å²ç³»ç»Ÿ](æ“ä½œå†å²ç³»ç»Ÿ.md) - æ’¤é”€/é‡åšåŠŸèƒ½
- [WebAVé›†æˆ](../05-é‡æ„è®°å½•/WebAVæ¸…ç†.md) - WebAVé›†æˆæ¶æ„

## ğŸ“ MVPæ€»ç»“

åŸºäºWebAVåŠ¨ç”»ç³»ç»Ÿçš„æ·±åº¦åˆ†æï¼ŒMVPç‰ˆæœ¬çš„å…³é”®å¸§åŠ¨ç”»ç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### ğŸ¯ æ ¸å¿ƒæ“ä½œæµç¨‹
1. **è®¾ç½®å…³é”®å¸§**ï¼šé€‰æ‹©ç‰‡æ®µ â†’ ç§»åŠ¨æ’­æ”¾å¤´ â†’ ç‚¹å‡»å…³é”®å¸§æŒ‰é’® â—†
2. **è°ƒæ•´å±æ€§**ï¼šåœ¨å…³é”®å¸§æ—¶é—´ç‚¹è°ƒæ•´å±æ€§å€¼ï¼Œå…³é”®å¸§ç«‹å³æ›´æ–°
3. **æ‰¾å›å…³é”®å¸§**ï¼šæ‹–æ‹½æ’­æ”¾å¤´è§‚å¯ŸæŒ‰é’®çŠ¶æ€ï¼Œæˆ–æ’­æ”¾é¢„è§ˆè§‚å¯ŸåŠ¨ç”»
4. **å¢é‡è°ƒæ•´**ï¼šåœ¨å…³é”®å¸§æ—¶é—´ç‚¹è¿›è¡Œå±æ€§å€¼çš„å¢é‡ä¿®æ”¹

### ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹
1. **WebAVåŸç”Ÿé©±åŠ¨** - å®Œå…¨ä¾èµ–WebAVçš„setAnimation API
2. **ç®€åŒ–äº¤äº’** - ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½ï¼Œé¿å…å¤æ‚çš„UIç»„ä»¶
3. **æ¸è¿›å®ç°** - ä»æœ€åŸºç¡€åŠŸèƒ½å¼€å§‹ï¼Œé€æ­¥æ‰©å±•
4. **æ¶æ„å…¼å®¹** - å®Œå…¨å…¼å®¹ç°æœ‰çš„TimelineItemæ¶æ„

### ğŸš€ å®ç°ä¼˜åŠ¿
1. **å¿«é€Ÿä¸Šæ‰‹** - ç”¨æˆ·å­¦ä¹ æˆæœ¬ä½ï¼Œæ“ä½œç›´è§‚
2. **å¼€å‘ç®€å•** - é¿å…å¤æ‚çš„æ—¶é—´è½´UIï¼Œä¸“æ³¨æ ¸å¿ƒé€»è¾‘
3. **æ€§èƒ½ä¼˜ç§€** - ç›´æ¥ä½¿ç”¨WebAVçš„30FPSæ¸²æŸ“å’Œçº¿æ€§æ’å€¼
4. **æ‰©å±•æ€§å¼º** - ä¸ºæœªæ¥çš„é«˜çº§åŠŸèƒ½é¢„ç•™äº†æ¶æ„ç©ºé—´

è¿™ä¸ªMVPç‰ˆæœ¬ä¸ºç”¨æˆ·æä¾›äº†åŸºç¡€ä½†å®Œæ•´çš„å…³é”®å¸§åŠ¨ç”»åŠŸèƒ½ï¼Œæ˜¯å‘ä¸“ä¸šè§†é¢‘ç¼–è¾‘è½¯ä»¶å‘å±•çš„é‡è¦ç¬¬ä¸€æ­¥ã€‚

---

**æç¤º**ï¼šMVPç‰ˆæœ¬ä¸“æ³¨äºæ ¸å¿ƒåŠŸèƒ½çš„å¿«é€Ÿå®ç°ï¼Œä¸ºç”¨æˆ·æä¾›åŸºç¡€çš„å…³é”®å¸§åŠ¨ç”»èƒ½åŠ›ï¼Œåç»­å¯æ ¹æ®ç”¨æˆ·åé¦ˆé€æ­¥æ‰©å±•é«˜çº§åŠŸèƒ½ã€‚

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ¶æ„è®¾è®¡](../03-å¼€å‘æ–‡æ¡£/æ¶æ„è®¾è®¡.md) - ç³»ç»Ÿæ¶æ„è®¾è®¡
- [APIæ–‡æ¡£](../03-å¼€å‘æ–‡æ¡£/APIæ–‡æ¡£.md) - WebAV APIæ¥å£
- [æ“ä½œå†å²ç³»ç»Ÿ](æ“ä½œå†å²ç³»ç»Ÿ.md) - æ’¤é”€/é‡åšåŠŸèƒ½
- [WebAVé›†æˆ](../05-é‡æ„è®°å½•/WebAVæ¸…ç†.md) - WebAVé›†æˆæ¶æ„

## ğŸ“ MVPæ€»ç»“

åŸºäºWebAVåŠ¨ç”»ç³»ç»Ÿçš„æ·±åº¦åˆ†æï¼ŒMVPç‰ˆæœ¬çš„å…³é”®å¸§åŠ¨ç”»ç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### ğŸ¯ æ ¸å¿ƒæ“ä½œæµç¨‹
1. **è®¾ç½®å…³é”®å¸§**ï¼šé€‰æ‹©ç‰‡æ®µ â†’ ç§»åŠ¨æ’­æ”¾å¤´ â†’ ç‚¹å‡»å…³é”®å¸§æŒ‰é’® â—†
2. **è°ƒæ•´å±æ€§**ï¼šåœ¨å…³é”®å¸§æ—¶é—´ç‚¹è°ƒæ•´å±æ€§å€¼ï¼Œå…³é”®å¸§ç«‹å³æ›´æ–°
3. **æ‰¾å›å…³é”®å¸§**ï¼šæ‹–æ‹½æ’­æ”¾å¤´è§‚å¯ŸæŒ‰é’®çŠ¶æ€ï¼Œæˆ–æ’­æ”¾é¢„è§ˆè§‚å¯ŸåŠ¨ç”»
4. **å¢é‡è°ƒæ•´**ï¼šåœ¨å…³é”®å¸§æ—¶é—´ç‚¹è¿›è¡Œå±æ€§å€¼çš„å¢é‡ä¿®æ”¹

### ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹
1. **WebAVåŸç”Ÿé©±åŠ¨** - å®Œå…¨ä¾èµ–WebAVçš„setAnimation API
2. **ç®€åŒ–äº¤äº’** - ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½ï¼Œé¿å…å¤æ‚çš„UIç»„ä»¶
3. **æ¸è¿›å®ç°** - ä»æœ€åŸºç¡€åŠŸèƒ½å¼€å§‹ï¼Œé€æ­¥æ‰©å±•
4. **æ¶æ„å…¼å®¹** - å®Œå…¨å…¼å®¹ç°æœ‰çš„TimelineItemæ¶æ„

### ğŸš€ å®ç°ä¼˜åŠ¿
1. **å¿«é€Ÿä¸Šæ‰‹** - ç”¨æˆ·å­¦ä¹ æˆæœ¬ä½ï¼Œæ“ä½œç›´è§‚
2. **å¼€å‘ç®€å•** - é¿å…å¤æ‚çš„æ—¶é—´è½´UIï¼Œä¸“æ³¨æ ¸å¿ƒé€»è¾‘
3. **æ€§èƒ½ä¼˜ç§€** - ç›´æ¥ä½¿ç”¨WebAVçš„30FPSæ¸²æŸ“å’Œçº¿æ€§æ’å€¼
4. **æ‰©å±•æ€§å¼º** - ä¸ºæœªæ¥çš„é«˜çº§åŠŸèƒ½é¢„ç•™äº†æ¶æ„ç©ºé—´

è¿™ä¸ªMVPç‰ˆæœ¬ä¸ºç”¨æˆ·æä¾›äº†åŸºç¡€ä½†å®Œæ•´çš„å…³é”®å¸§åŠ¨ç”»åŠŸèƒ½ï¼Œæ˜¯å‘ä¸“ä¸šè§†é¢‘ç¼–è¾‘è½¯ä»¶å‘å±•çš„é‡è¦ç¬¬ä¸€æ­¥ã€‚

---

**æç¤º**ï¼šMVPç‰ˆæœ¬ä¸“æ³¨äºæ ¸å¿ƒåŠŸèƒ½çš„å¿«é€Ÿå®ç°ï¼Œä¸ºç”¨æˆ·æä¾›åŸºç¡€çš„å…³é”®å¸§åŠ¨ç”»èƒ½åŠ›ï¼Œåç»­å¯æ ¹æ®ç”¨æˆ·åé¦ˆé€æ­¥æ‰©å±•é«˜çº§åŠŸèƒ½ã€‚

