# 关键帧动画调试指南

## 📋 概述

为了方便调试和验证关键帧动画系统，我们在属性面板中添加了调试功能。这个功能可以帮助开发者查看关键帧的详细信息，验证动画配置是否正确。

## 🔍 调试功能

### 调试按钮位置

在属性面板的顶部，有一个新的"动画调试"区域，包含：

- **🔍 打印关键帧信息** 按钮
- **动画状态指示器**（显示是否启用动画）
- **关键帧数量显示**

### 调试信息内容

点击"🔍 打印关键帧信息"按钮后，控制台会输出以下信息：

#### 1. 时间轴项目基本信息
```javascript
🔍 [Debug] 时间轴项目信息: {
  id: "1703123456789abc123def",
  mediaType: "video",
  hasAnimationConfig: true
}
```

#### 2. 动画配置信息
```javascript
🔍 [Debug] 动画配置: {
  isEnabled: true,
  duration: 2000000,           // 微秒
  durationSeconds: 2,          // 秒
  iterCount: 1,
  keyFrameCount: 3
}
```

#### 3. 关键帧详细列表
```javascript
🔍 [Debug] 关键帧列表:
  1. 关键帧 kf_1703123456789: {
    time: 0,                   // 相对时间 (0-1)
    timeSeconds: 0,            // 绝对时间 (秒)
    properties: [
      {
        property: "x",
        value: 0,
        interpolation: "linear"
      },
      {
        property: "opacity",
        value: 1,
        interpolation: "linear"
      }
    ]
  }
  2. 关键帧 kf_1703123456790: {
    time: 0.5,
    timeSeconds: 1,
    properties: [
      {
        property: "x",
        value: 200,
        interpolation: "linear"
      }
    ]
  }
  3. 关键帧 kf_1703123456791: {
    time: 1,
    timeSeconds: 2,
    properties: [
      {
        property: "x",
        value: 400,
        interpolation: "linear"
      },
      {
        property: "opacity",
        value: 0.5,
        interpolation: "linear"
      }
    ]
  }
```

#### 4. 当前属性值
```javascript
🔍 [Debug] 当前属性值: {
  x: 200,
  y: 0,
  width: 640,
  height: 360,
  rotation: 0,
  opacity: 0.75,
  zIndex: 1
}
```

#### 5. WebAV Sprite信息
```javascript
🔍 [Debug] WebAV Sprite信息: {
  rect: { x: 320, y: 180, w: 640, h: 360, angle: 0 },
  opacity: 0.75,
  zIndex: 1,
  visible: true
}
```

## 🎯 使用场景

### 1. 验证关键帧创建

1. 选择一个时间轴项目
2. 点击属性旁边的关键帧按钮（◇ 变为 ◆）
3. 点击调试按钮查看关键帧是否正确创建

### 2. 检查动画配置

1. 创建多个关键帧
2. 点击调试按钮查看：
   - 关键帧数量是否正确
   - 时间点是否符合预期
   - 属性值是否正确

### 3. 验证WebAV集成

1. 创建动画后
2. 查看WebAV Sprite信息
3. 确认项目属性值与WebAV属性值的对应关系

### 4. 排查动画问题

如果动画不工作，检查：
- `isEnabled` 是否为 `true`
- `keyFrameCount` 是否 ≥ 2
- 关键帧的 `time` 值是否在 0-1 范围内
- 属性值是否合理

## 🔧 关键帧按钮状态

属性面板中的关键帧按钮会实时反映当前状态：

- **◇ (空心)**: 当前时间点没有该属性的关键帧
- **◆ (实心橙色)**: 当前时间点有该属性的关键帧

### 支持的属性

- **位置**: X, Y（两个独立的关键帧按钮）
- **尺寸**: 宽度, 高度
- **变换**: 旋转, 透明度

## 📝 调试技巧

### 1. 时间对应关系

- **相对时间 (time)**: 0-1 之间，表示在动画周期中的位置
- **绝对时间 (timeSeconds)**: 实际的秒数，= time × duration / 1,000,000

### 2. 坐标系转换

- **项目坐标系**: 以画布中心为原点，用于UI显示
- **WebAV坐标系**: 以左上角为原点，用于实际渲染

调试信息中可以对比这两个坐标系的值。

### 3. 常见问题排查

**问题**: 关键帧按钮不变色
- 检查是否选中了时间轴项目
- 确认当前播放时间是否在关键帧附近（容差0.01）

**问题**: 动画不播放
- 检查 `isEnabled` 状态
- 确认关键帧数量 ≥ 2
- 验证 WebAV Sprite 的动画是否正确应用

**问题**: 属性值不同步
- 对比项目属性值和 WebAV Sprite 属性值
- 检查坐标系转换是否正确

## 🚀 下一步

使用调试功能验证基础功能后，可以：

1. 测试复杂的多属性动画
2. 验证动画播放效果
3. 测试关键帧的增删改操作
4. 检查性能表现

调试功能将帮助确保动画系统的稳定性和正确性。
