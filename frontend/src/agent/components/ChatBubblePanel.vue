<template>
  <div class="panel">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <div class="panel-header">
      <div class="header-left">
        <RemixIcon name="sparkling-2-fill" size="md" />
        <h3>{{ t('common.chat.agent') }}</h3>
      </div>
      <HoverButton @click="$emit('close')" :title="t('common.close')">
        <template #icon>
          <RemixIcon name="close-line" size="lg" />
        </template>
      </HoverButton>
    </div>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <ChatMessageList :messages="messages" />

    <!-- åº•éƒ¨è¾“å…¥æ¡† -->
    <ChatInput
      :placeholder="t('common.chat.inputPlaceholder')"
      :send-title="t('common.chat.send')"
      @send="handleSendMessage"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import RemixIcon from '@/components/icons/RemixIcon.vue'
import HoverButton from '@/components/HoverButton.vue'
import ChatMessageList from '@/agent/components/ChatMessageList.vue'
import ChatInput from '@/agent/components/ChatInput.vue'
import { useAppI18n } from '@/unified/composables/useI18n'
import type { ChatMessage } from './types'

const { t } = useAppI18n()

// å®šä¹‰äº‹ä»¶
const emit = defineEmits<{
  close: []
}>()

// æ¶ˆæ¯åˆ—è¡¨
const messages = ref<ChatMessage[]>([
  {
    id: '1',
    type: 'ai',
    content: `ä½ å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®åŠ©ä½ åˆ†æè§†é¢‘å†…å®¹ã€æä¾›ç¼–è¾‘å»ºè®®ç­‰ã€‚

## æˆ‘å¯ä»¥å¸®ä½ åšä»€ä¹ˆï¼š

- **è§†é¢‘åˆ†æ**ï¼šè¯†åˆ«è§†é¢‘ä¸­çš„åœºæ™¯ã€ç‰©ä½“å’Œäººç‰©
- **ç¼–è¾‘å»ºè®®**ï¼šæä¾›ä¸“ä¸šçš„è§†é¢‘ç¼–è¾‘å»ºè®®
- **æ•ˆæœæ¨è**ï¼šæ¨èé€‚åˆçš„è¿‡æ¸¡æ•ˆæœå’Œæ»¤é•œ
- **éŸ³é¢‘å¤„ç†**ï¼šéŸ³é¢‘ä¼˜åŒ–å’ŒèƒŒæ™¯éŸ³ä¹å»ºè®®

æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ`,
    timestamp: '10:00'
  },
  {
    id: '2',
    type: 'user',
    content: 'è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªè§†é¢‘çš„ä¸»è¦å†…å®¹',
    timestamp: '10:01'
  },
  {
    id: '3',
    type: 'ai',
    content: `æˆ‘çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªå…³äºåŸå¸‚é£æ™¯çš„è§†é¢‘ï¼ŒåŒ…å«äº†å¤šä¸ªåœºæ™¯åˆ‡æ¢ã€‚

### ä¸»è¦å‘ç°ï¼š

1. **åœºæ™¯æ•°é‡**ï¼šæ£€æµ‹åˆ°5ä¸ªä¸åŒçš„åŸå¸‚åœºæ™¯
2. **æ‹æ‘„è´¨é‡**ï¼šç”»é¢æ¸…æ™°ï¼Œè‰²å½©é¥±å’Œåº¦è‰¯å¥½
3. **èŠ‚å¥æ§åˆ¶**ï¼šåœºæ™¯åˆ‡æ¢è¾ƒä¸ºè‡ªç„¶

### å»ºè®®æ”¹è¿›ï¼š

> å»ºè®®ä½ å¯ä»¥æ·»åŠ ä¸€äº›**è¿‡æ¸¡æ•ˆæœ**æ¥è®©åœºæ™¯è½¬æ¢æ›´åŠ è‡ªç„¶ï¼Œæ¯”å¦‚ï¼š
> - \`æ·¡å…¥æ·¡å‡º\`æ•ˆæœ
> - \`æ»‘åŠ¨åˆ‡æ¢\`æ•ˆæœ
> - \`æº¶è§£è¿‡æ¸¡\`æ•ˆæœ

éœ€è¦æˆ‘è¯¦ç»†è§£é‡Šè¿™äº›æ•ˆæœå—ï¼Ÿ`,
    timestamp: '10:02'
  },
  {
    id: '4',
    type: 'ai',
    content: `## æŠ€æœ¯å‚æ•°åˆ†æ

| å‚æ•° | æ•°å€¼ | è¯„ä»· |
|------|------|------|
| åˆ†è¾¨ç‡ | 1920Ã—1080 | âœ… é«˜æ¸… |
| å¸§ç‡ | 30fps | âœ… æ ‡å‡† |
| æ—¶é•¿ | 2:34 | âœ… é€‚ä¸­ |
| ç ç‡ | 8.5Mbps | âœ… è‰¯å¥½ |

### ä»£ç ç¤ºä¾‹
å¦‚æœä½ éœ€è¦æ·»åŠ è½¬åœºæ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š

\`\`\`javascript
const addTransition = (scene1, scene2, type = 'fade') => {
  return {
    from: scene1,
    to: scene2,
    transition: type,
    duration: '1s'
  };
};
\`\`\`

**æ€»ä½“è¯„ä»·**ï¼šè¿™æ˜¯ä¸€ä¸ªåˆ¶ä½œç²¾è‰¯çš„åŸå¸‚é£æ™¯è§†é¢‘ï¼`,
    timestamp: '10:03'
  }
])

// ç®€å•çš„AIå›å¤é€»è¾‘
const getAIResponse = (userInput: string): string => {
  const responses = [
    `## åˆ†æç»“æœ

è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼è®©æˆ‘ä¸ºä½ åˆ†æä¸€ä¸‹è§†é¢‘å†…å®¹ï¼š

- **ç”»é¢è´¨é‡**ï¼šæ¸…æ™°åº¦è‰¯å¥½
- **è‰²å½©æ­é…**ï¼šè‰²è°ƒåè°ƒ
- **èŠ‚å¥æ§åˆ¶**ï¼šè¿‡æ¸¡è‡ªç„¶

### å»ºè®®æ”¹è¿›ï¼š
1. å¯ä»¥è°ƒæ•´äº®åº¦å¯¹æ¯”åº¦
2. æ·»åŠ ä¸€äº›è¿‡æ¸¡æ•ˆæœ
3. è€ƒè™‘éŸ³é¢‘åŒæ­¥ä¼˜åŒ–`,
    
    `## ç‰¹æ•ˆå»ºè®®

æ ¹æ®è§†é¢‘å†…å®¹ï¼Œæˆ‘å»ºè®®ä½ å¯ä»¥å°è¯•ä»¥ä¸‹ç‰¹æ•ˆï¼š

### è§†è§‰æ•ˆæœï¼š
- **æ¨¡ç³Šè½¬åœº**ï¼šè¥é€ æ¢¦å¹»æ„Ÿ
- **è‰²å½©è°ƒæ•´**ï¼šå¢å¼ºè§†è§‰å†²å‡»åŠ›
- **åŠ¨æ€æ–‡å­—**ï¼šæ·»åŠ è¯´æ˜ä¿¡æ¯

> ğŸ’¡ **ä¸“ä¸šæç¤º**ï¼šç‰¹æ•ˆè¦é€‚åº¦ä½¿ç”¨ï¼Œé¿å…è¿‡åº¦å¤„ç†ã€‚`,
    
    `## éŸ³é¢‘ä¼˜åŒ–å»ºè®®

æˆ‘æ³¨æ„åˆ°è§†é¢‘çš„èŠ‚å¥å¾ˆå¥½ï¼ŒéŸ³é¢‘å¤„ç†å»ºè®®ï¼š

| éŸ³é¢‘å…ƒç´  | å»ºè®® |
|----------|------|
| èƒŒæ™¯éŸ³ä¹ | é€‰æ‹©èŠ‚å¥åŒ¹é…çš„éŸ³ä¹ |
| éŸ³é‡å¹³è¡¡ | ç¡®ä¿å¯¹è¯æ¸…æ™°åº¦ |
| éŸ³æ•ˆæ·»åŠ  | é€‚å½“å¢å¼ºå…³é”®èŠ‚ç‚¹ |

\`\`\`javascript
// éŸ³é¢‘å¤„ç†ç¤ºä¾‹
const optimizeAudio = (audioTrack) => {
  return audioTrack
    .normalize()
    .compress()
    .enhance();
};
\`\`\``,
    
    `## è‰²å½©åˆ†æ

è¿™ä¸ªè§†é¢‘çš„ç”»é¢è´¨é‡å¾ˆä¸é”™ï¼

**è‰²å½©ç»Ÿè®¡**ï¼š
- ä¸»è‰²è°ƒï¼šæš–è‰²ç³» ğŸ”´
- é¥±å’Œåº¦ï¼šé€‚ä¸­ ğŸ“Š
- å¯¹æ¯”åº¦ï¼šè‰¯å¥½ âš¡

å»ºè®®ä½ å¯ä»¥ï¼š
1. ä½¿ç”¨ \`è‰²å½©å¹³è¡¡\` å·¥å…·å¾®è°ƒ
2. æ·»åŠ  \`LUTæ»¤é•œ\` å¢å¼ºæ°›å›´
3. è°ƒæ•´ \`è‰²æ¸©\` è®©ç”»é¢æ›´ç”ŸåŠ¨`,
    
    `## ç¼–è¾‘å»ºè®®

çœ‹èµ·æ¥ä½ åœ¨è§†é¢‘ç¼–è¾‘æ–¹é¢å¾ˆæœ‰ç»éªŒï¼

### ä¸‹ä¸€æ­¥å»ºè®®ï¼š
- [ ] æ·»åŠ è½¬åœºæ•ˆæœ
- [ ] ä¼˜åŒ–éŸ³é¢‘åŒæ­¥
- [ ] è°ƒæ•´è‰²å½©å‚æ•°
- [ ] å¯¼å‡ºæœ€ç»ˆç‰ˆæœ¬

æœ‰ä»€ä¹ˆå…·ä½“çš„ç¼–è¾‘éœ€æ±‚å—ï¼Ÿæˆ‘å¾ˆä¹æ„ä¸ºä½ æä¾›è¯¦ç»†æŒ‡å¯¼ï¼`
  ]
  
  // æ ¹æ®è¾“å…¥å†…å®¹è¿”å›ç›¸å…³å›å¤
  if (userInput.includes('åˆ†æ') || userInput.includes('å†…å®¹')) {
    return `## æ·±åº¦åˆ†ææŠ¥å‘Š

æˆ‘å·²ç»å…¨é¢åˆ†æäº†ä½ çš„è§†é¢‘å†…å®¹ï¼š

### ğŸ“Š å†…å®¹åˆ†æ
- **ä¸»é¢˜è¯†åˆ«**ï¼š${userInput.includes('åŸå¸‚') ? 'åŸå¸‚é£æ™¯' : 'è§†é¢‘å†…å®¹'}
- **åœºæ™¯æ£€æµ‹**ï¼šå‘ç°å¤šä¸ªåœºæ™¯åˆ‡æ¢
- **è´¨é‡è¯„ä¼°**ï¼šåˆ¶ä½œç²¾è‰¯ï¼ŒæŠ€æœ¯å‚æ•°è‰¯å¥½

### ğŸ¯ å…³é”®å‘ç°
1. **è§†è§‰å…ƒç´ ä¸°å¯Œ**ï¼Œæ„å›¾åˆç†
2. **èŠ‚å¥æ§åˆ¶å¾—å½“**ï¼Œè¿‡æ¸¡è‡ªç„¶
3. **æŠ€æœ¯è´¨é‡è¾¾æ ‡**ï¼Œè§‚æ„Ÿè‰¯å¥½

### ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®
å»ºè®®ä½ å¯ä»¥æ·»åŠ ä¸€äº›**æ–‡å­—è¯´æ˜**å’Œ**æ ‡æ³¨**æ¥å¸®åŠ©è§‚ä¼—æ›´å¥½åœ°ç†è§£å†…å®¹ã€‚

éœ€è¦æˆ‘è¯¦ç»†è§£é‡ŠæŸä¸ªæ–¹é¢å—ï¼Ÿ`
  } else if (userInput.includes('æ•ˆæœ') || userInput.includes('ç‰¹æ•ˆ')) {
    return `## ç‰¹æ•ˆæ¨èæ–¹æ¡ˆ

æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œæˆ‘å»ºè®®ä»¥ä¸‹**è¿‡æ¸¡æ•ˆæœ**ï¼š

### ğŸ¬ è§†è§‰è¿‡æ¸¡
- **\`æ·¡å…¥æ·¡å‡º\`**ï¼šæœ€è‡ªç„¶çš„é€‰æ‹©
- **\`æ»‘åŠ¨åˆ‡æ¢\`**ï¼šåŠ¨æ„Ÿåè¶³
- **\`æº¶è§£è¿‡æ¸¡\`**ï¼šæ¢¦å¹»æ•ˆæœ

### âš™ï¸ æŠ€æœ¯å®ç°
\`\`\`css
/* CSSè¿‡æ¸¡æ•ˆæœç¤ºä¾‹ */
.transition-fade {
  transition: opacity 0.5s ease-in-out;
}
\`\`\`

### ğŸ“ˆ æ•ˆæœå¯¹æ¯”
| æ•ˆæœç±»å‹ | é€‚ç”¨åœºæ™¯ | å¼ºåº¦ |
|----------|----------|------|
| æ·¡å…¥æ·¡å‡º | è‡ªç„¶è¿‡æ¸¡ | â­â­â­ |
| æ»‘åŠ¨åˆ‡æ¢ | åŠ¨æ„Ÿåœºæ™¯ | â­â­â­â­ |
| æº¶è§£è¿‡æ¸¡ | æ¢¦å¹»æ•ˆæœ | â­â­â­â­â­ |

éœ€è¦æˆ‘è¯¦ç»†è§£é‡Šè¿™äº›æ•ˆæœå—ï¼Ÿ`
  } else if (userInput.includes('éŸ³ä¹') || userInput.includes('éŸ³é¢‘')) {
    return `## éŸ³é¢‘å¤„ç†ä¸“ä¸šæŒ‡å—

éŸ³é¢‘æ˜¯è§†é¢‘çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼

### ğŸµ éŸ³ä¹é€‰æ‹©åŸåˆ™
- **èŠ‚å¥åŒ¹é…**ï¼šBPMä¸è§†é¢‘èŠ‚å¥åŒæ­¥
- **æƒ…æ„Ÿå¥‘åˆ**ï¼šéŸ³ä¹æƒ…ç»ªä¸å†…å®¹åŒ¹é…
- **ç‰ˆæƒå®‰å…¨**ï¼šä½¿ç”¨æˆæƒéŸ³ä¹

### ğŸ”§ æŠ€æœ¯å¤„ç†
\`\`\`javascript
// éŸ³é¢‘å¤„ç†æµç¨‹
const processAudio = (audioTrack, videoBPM) => {
  return audioTrack
    .matchBPM(videoBPM)     // èŠ‚å¥åŒ¹é…
    .normalize(-14)         // éŸ³é‡æ ‡å‡†åŒ–
    .compress(3:1)          // åŠ¨æ€å‹ç¼©
    .EQ('gentle')           // å‡è¡¡å™¨è°ƒæ•´
    .limit(-1);             // é™å¹…å¤„ç†
};
\`\`\`

### âš–ï¸ éŸ³é‡å¹³è¡¡æŠ€å·§
> **é»„é‡‘æ³•åˆ™**ï¼šèƒŒæ™¯éŸ³ä¹ä¸è¶…è¿‡-18dBï¼Œä¸»è¦éŸ³é¢‘ä¿æŒ-12dBåˆ°-6dB

éœ€è¦æ›´è¯¦ç»†çš„éŸ³é¢‘å¤„ç†æŒ‡å¯¼å—ï¼Ÿ`
  } else {
    return responses[Math.floor(Math.random() * responses.length)]
  }
}

// å¤„ç†å‘é€æ¶ˆæ¯
const handleSendMessage = (message: string) => {
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  const userMessage: ChatMessage = {
    id: Date.now().toString(),
    type: 'user',
    content: message,
    timestamp: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
  }
  
  messages.value.push(userMessage)
  
  // æ¨¡æ‹ŸAIå›å¤
  setTimeout(() => {
    const aiMessage: ChatMessage = {
      id: (Date.now() + 1).toString(),
      type: 'ai',
      content: getAIResponse(message),
      timestamp: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
    }
    messages.value.push(aiMessage)
  }, 1000)
}
</script>

<style scoped>
/* ç¡®ä¿èŠå¤©é¢æ¿å æ»¡æ•´ä¸ªé«˜åº¦ */
.panel {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
}

.header-left {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}
</style>