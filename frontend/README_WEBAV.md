# WebAV 视频预览引擎使用指南

## 快速开始

### 1. 启动开发服务器
```bash
cd frontend
npm install
npm run dev
```

### 2. 打开浏览器
访问 `http://localhost:5174` (或控制台显示的端口)

### 3. 浏览器要求
- Chrome 94+ 或 Edge 94+
- 支持 WebCodecs API

## 功能特性

### ✅ 已实现功能
1. **视频加载**: 支持拖拽或选择视频文件
2. **WebAV渲染**: 使用专业的WebAV引擎进行视频渲染
3. **播放控制**: 播放、暂停、时间跳转
4. **变换支持**: 位置、缩放、旋转、透明度调整
5. **宽高比保持**: 视频始终保持正确的16:9比例，不会变形
6. **响应式布局**: 自动适应容器尺寸变化，保持最佳显示效果
7. **浏览器兼容性检测**: 自动检测并提示不支持的浏览器
8. **错误处理**: 完善的错误提示和恢复机制
9. **性能监控**: 实时显示渲染状态信息

### 🔄 保持不变的UI
- 原有的界面布局和样式
- 媒体库面板
- 时间轴编辑器
- 属性面板
- 播放控制器

## 使用方法

### 添加视频到时间轴
1. 在左侧媒体库中上传视频文件
2. 将视频拖拽到时间轴轨道上
3. WebAV引擎会自动加载并渲染视频

### 播放控制
- **播放/暂停**: 点击播放按钮或空格键
- **时间跳转**: 拖拽时间轴滑块
- **精确控制**: WebAV提供微秒级时间精度

### 视频变换
在右侧属性面板中调整：
- **位置**: X/Y坐标
- **缩放**: 宽度/高度比例
- **旋转**: 角度调整
- **透明度**: 0-1之间的值

### 调试功能
- 点击预览窗口右上角的"调试"按钮
- 查看浏览器控制台的详细日志
- 监控WebAV引擎状态

## 技术细节

### WebAV引擎优势
- **硬件加速**: 使用WebCodecs API进行GPU解码
- **高性能**: 专业视频处理，减少CPU占用
- **精确时间**: 微秒级时间控制
- **流畅播放**: 优化的视频渲染管道

### 架构设计
```
MultiTrackVideoRenderer.vue
    ↓
WebAVRenderer.ts
    ↓
@webav/av-canvas + @webav/av-cliper
    ↓
WebCodecs API (浏览器原生)
```

### 兼容性处理
- 自动检测WebCodecs API支持
- 不支持的浏览器显示升级提示
- 优雅降级处理

## 故障排除

### 常见问题

#### 1. 浏览器不支持
**症状**: 显示"浏览器不支持 WebCodecs API"
**解决**: 使用 Chrome 94+ 或 Edge 94+

#### 2. 视频加载失败
**症状**: 显示"加载视频失败"错误
**可能原因**:
- 视频格式不支持
- 文件损坏
- 网络问题

**解决方法**:
1. 检查视频格式（推荐MP4）
2. 尝试其他视频文件
3. 点击"重试"按钮

#### 3. 播放卡顿
**可能原因**:
- 视频分辨率过高
- 设备性能不足

**解决方法**:
1. 降低视频分辨率
2. 关闭其他占用资源的应用

### 调试步骤
1. 打开浏览器开发者工具 (F12)
2. 查看Console标签页的错误信息
3. 点击预览窗口的"调试"按钮查看状态
4. 检查Network标签页的网络请求

## 开发说明

### 文件结构
```
frontend/src/
├── components/
│   └── MultiTrackVideoRenderer.vue  # 主渲染组件
├── utils/
│   └── webavRenderer.ts            # WebAV渲染器类
└── stores/
    └── counter.ts                   # 视频状态管理
```

### 关键API
```typescript
// WebAV渲染器
const renderer = new WebAVRenderer(container)
await renderer.initAVCanvas()
await renderer.loadVideoClip(clip)
renderer.play({ start: 0, end: duration })
renderer.pause()
renderer.previewFrame(time)
```

### 事件监听
```typescript
avCanvas.on('timeupdate', (time) => {
  // 时间更新处理
})

avCanvas.on('playing', () => {
  // 播放开始处理
})

avCanvas.on('paused', () => {
  // 播放暂停处理
})
```

## 性能优化建议

1. **视频格式**: 使用H.264编码的MP4文件
2. **分辨率**: 根据设备性能选择合适的分辨率
3. **内存管理**: WebAV自动处理，无需手动优化
4. **并发限制**: 避免同时加载过多视频文件

## 未来扩展

基于WebAV引擎，可以轻松扩展以下功能：
- 多轨道视频合成
- 实时视频效果
- 音频处理集成
- 视频导出功能
- 自定义转场效果

## 支持与反馈

如遇到问题或有改进建议，请：
1. 检查浏览器控制台错误信息
2. 使用调试功能收集状态信息
3. 提供详细的复现步骤

---

**注意**: 此引擎基于现代Web标准构建，需要支持WebCodecs API的浏览器。在不支持的环境中会显示相应提示。
