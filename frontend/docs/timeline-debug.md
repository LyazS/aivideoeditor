# 时间轴缩放调试指南

## 概述

为了帮助调试时间轴缩放功能的问题，我们添加了详细的调试信息系统。调试信息按功能分组，可以通过全局开关控制显示。

## 调试开关

### 全局调试开关

在浏览器控制台中，你可以使用以下全局变量来控制调试信息：

```javascript
// 开启所有时间轴调试
window.enableTimelineDebug()

// 关闭所有时间轴调试
window.disableTimelineDebug()

// 单独控制缩放调试（默认开启）
window.DEBUG_TIMELINE_ZOOM = true/false

// 单独控制坐标转换调试（默认关闭，会产生大量日志）
window.DEBUG_TIMELINE_CONVERSION = true/false
```

### 便捷函数

```javascript
// 开启调试模式
enableTimelineDebug()

// 关闭调试模式
disableTimelineDebug()
```

## 调试信息分组

### 🔍 缩放调试 (DEBUG_TIMELINE_ZOOM)

**包含的调试信息：**

1. **🔬 [缩放计算] 计算最大缩放级别**
   - 计算参数：时间轴宽度、帧率、总时长等
   - 计算结果：最大缩放级别、是否受最小值限制

2. **🔍 [缩放计算] 计算最小缩放级别**
   - 计算参数：总时长、最大可见时长
   - 计算结果：最小缩放级别

3. **📜 [滚动计算] 计算最大滚动偏移量**
   - 计算参数：时间轴宽度、缩放级别、时长等
   - 计算过程：有效时长、像素密度、可见时长等

4. **🔍 [缩放调试] 设置缩放级别**
   - 缩放参数：请求的缩放级别、当前级别、最小/最大限制
   - 像素密度计算：新旧像素密度对比、可见时长变化
   - 限制警告：达到最小/最大缩放级别时的提示
   - 更新结果：实际设置的缩放级别、变化百分比

5. **🔍➕ [缩放调试] 放大时间轴**
   - 放大参数：缩放因子、当前和目标缩放级别
   - 放大结果：最终缩放级别、实际缩放因子

6. **🔍➖ [缩放调试] 缩小时间轴**
   - 缩小参数：缩放因子、当前和目标缩放级别
   - 时间轴长度检查：是否需要扩展时间轴
   - 缩小结果：最终缩放级别、实际缩放因子

7. **🎡 [时间刻度] Alt+滚轮缩放事件**
   - 鼠标位置信息：坐标、时间点、容器宽度
   - 缩放前状态：当前缩放级别、滚动偏移量、缩放方向
   - 鼠标位置保持计算：偏移量调整、新的滚动位置
   - 缩放后状态：新的缩放级别、最终滚动偏移量、变化百分比

8. **🎬 [时间轴] Alt+滚轮缩放事件**
   - 类似时间刻度的调试信息，但针对主时间轴区域

### ⏰📐 坐标转换调试 (DEBUG_TIMELINE_CONVERSION)

**包含的调试信息：**

1. **⏰➡️📐 [坐标转换] 时间转像素**
   - 转换参数：时间、时间轴宽度、总时长、缩放级别、滚动偏移量
   - 计算过程：像素密度、最终像素位置

2. **📐➡️⏰ [坐标转换] 像素转时间**
   - 转换参数：像素位置、时间轴宽度、总时长、缩放级别、滚动偏移量
   - 计算过程：像素密度、最终时间

**注意：** 坐标转换调试会产生大量日志，建议只在需要时开启。

## 使用建议

### 调试缩放问题

1. **开启缩放调试：**
   ```javascript
   window.DEBUG_TIMELINE_ZOOM = true
   ```

2. **执行缩放操作：**
   - 使用 Alt + 滚轮进行缩放
   - 观察控制台中的分组调试信息

3. **关注关键信息：**
   - 缩放级别的限制情况
   - 像素密度的变化
   - 鼠标位置保持计算
   - 滚动偏移量的调整

### 调试坐标转换问题

1. **临时开启坐标转换调试：**
   ```javascript
   window.DEBUG_TIMELINE_CONVERSION = true
   ```

2. **执行相关操作后立即关闭：**
   ```javascript
   window.DEBUG_TIMELINE_CONVERSION = false
   ```

### 完整调试流程

1. **开启调试模式：**
   ```javascript
   enableTimelineDebug()
   ```

2. **重现问题操作**

3. **分析调试信息**

4. **关闭调试模式：**
   ```javascript
   disableTimelineDebug()
   ```

## 调试信息解读

### 缩放级别限制

- **⚠️ 已达到最小缩放级别限制：** 无法继续缩小，显示内容范围信息
- **⚠️ 已达到最大缩放级别限制：** 无法继续放大，显示帧宽度信息

### 像素密度计算

- **pixelsPerSecond：** 每秒对应的像素数，影响显示精度
- **visibleDuration：** 当前可见的时间范围

### 鼠标位置保持

- **offsetAdjustment：** 为保持鼠标位置不变而需要的滚动调整量
- **mouseTime：** 鼠标位置对应的时间点

## 常见问题排查

1. **缩放不响应：** 检查是否达到缩放级别限制
2. **缩放后位置偏移：** 检查鼠标位置保持计算是否正确
3. **缩放速度异常：** 检查缩放因子和实际缩放倍数
4. **滚动范围异常：** 检查最大滚动偏移量计算

通过这些详细的调试信息，你可以快速定位时间轴缩放功能中的问题所在。
